<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPATE Deliveries - Fast Nairobi Delivery</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸšš</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary: #FF6B00;
            --secondary: #00A859;
            --accent: #FFD700;
            --dark: #1A1A1A;
            --light: #F5F5F5;
            --gray: #E0E0E0;
            --shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            --success: #00B894;
            --warning: #FBC531;
            --danger: #E84118;
            --info: #0984e3;
            --glass: rgba(255, 255, 255, 0.15);
            --glass-dark: rgba(0, 0, 0, 0.2);
            --blur: blur(15px);
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-primary: linear-gradient(135deg, var(--primary), #FF8C00);
            --gradient-secondary: linear-gradient(135deg, var(--secondary), #00C853);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--gradient);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Glass Effect */
        .glass {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border: 1px solid rgba(255, 255, 255, 0.18);
            border-radius: 20px;
        }

        .glass-dark {
            background: var(--glass-dark);
            backdrop-filter: var(--blur);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
        }

        /* Header Styles */
        header {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-bottom: 1px solid rgba(255, 255, 255, 0.18);
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .header-scrolled {
            background: rgba(26, 26, 26, 0.9);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            color: var(--primary);
            font-size: 28px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .logo-text {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-links {
            display: flex;
            gap: 30px;
        }

        .nav-links a {
            text-decoration: none;
            color: white;
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 12px;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-links a:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .auth-buttons {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 0, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 107, 0, 0.4);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-3px);
        }

        .btn-secondary {
            background: var(--gradient-secondary);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 168, 89, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 168, 89, 0.4);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            box-shadow: 0 4px 15px rgba(232, 65, 24, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(232, 65, 24, 0.4);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 12px;
        }

        .btn-block {
            width: 100%;
        }

        .btn-large {
            padding: 16px 32px;
            font-size: 16px;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: white;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.9), rgba(118, 75, 162, 0.9));
            color: white;
            padding: 150px 0 120px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('https://images.unsplash.com/photo-1556740711-2d67d1252f8f?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80') center/cover;
            opacity: 0.1;
            z-index: -1;
        }

        .hero-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 4rem;
            margin-bottom: 20px;
            font-weight: 800;
            text-shadow: 0 4px 20px rgba(0,0,0,0.3);
            line-height: 1.1;
        }

        .hero p {
            font-size: 1.3rem;
            margin: 0 auto 40px;
            opacity: 0.9;
            max-width: 600px;
        }

        .hero-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        /* Features Section */
        .features {
            padding: 100px 0;
            background: transparent;
        }

        .section-title {
            text-align: center;
            margin-bottom: 60px;
            font-size: 2.5rem;
            color: white;
            font-weight: 700;
        }

        .section-subtitle {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            max-width: 600px;
            margin: 0 auto 60px;
            font-size: 1.1rem;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
        }

        .feature-card {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.18);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: -1;
        }

        .feature-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .feature-card:hover::before {
            opacity: 0.1;
        }

        .feature-icon {
            font-size: 48px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }

        /* Testimonials Section */
        .testimonials {
            padding: 100px 0;
            background: transparent;
        }
        
        .testimonials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 50px;
        }
        
        .testimonial-card {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            color: white;
            position: relative;
        }
        
        .testimonial-card::before {
            content: '"';
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 60px;
            color: var(--primary);
            opacity: 0.3;
            font-family: Georgia, serif;
        }
        
        .testimonial-content {
            margin-bottom: 20px;
            font-style: italic;
            line-height: 1.6;
        }
        
        .testimonial-author {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .author-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }
        
        .author-info h4 {
            margin-bottom: 5px;
            color: white;
        }
        
        .author-info p {
            margin: 0;
            opacity: 0.8;
            font-size: 0.9rem;
        }

        /* FAQ Section */
        .faq-section {
            padding: 100px 0;
            background: transparent;
        }
        
        .faq-container {
            max-width: 800px;
            margin: 50px auto 0;
        }
        
        .faq-item {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .faq-question {
            padding: 20px 25px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: white;
            transition: all 0.3s;
        }
        
        .faq-question:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .faq-question i {
            transition: transform 0.3s;
        }
        
        .faq-answer {
            padding: 0 25px;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .faq-item.active .faq-answer {
            padding: 0 25px 25px;
            max-height: 500px;
        }
        
        .faq-item.active .faq-question i {
            transform: rotate(180deg);
        }

        /* Footer Styles */
        footer {
            background: var(--glass-dark);
            backdrop-filter: var(--blur);
            color: white;
            padding: 60px 0 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }

        .footer-logo {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .footer-links h4 {
            margin-bottom: 20px;
            font-size: 18px;
            color: white;
        }

        .footer-links ul {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 12px;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .footer-links a:hover {
            color: var(--primary);
            transform: translateX(5px);
        }

        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .social-link {
            width: 45px;
            height: 45px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .social-link:hover {
            background: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 107, 0, 0.3);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 40px;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.18);
            color: white;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: white;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .auth-tab {
            padding: 15px 30px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .auth-tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-control {
            width: 100%;
            padding: 15px 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 0, 0.1);
            background: rgba(255, 255, 255, 0.15);
        }

        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        /* Dashboard Styles */
        .dashboard {
            min-height: 100vh;
            padding-top: 80px;
        }

        .dashboard-header {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-bottom: 1px solid rgba(255, 255, 255, 0.18);
            padding: 20px 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .dashboard-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            background-size: cover;
            background-position: center;
        }

        .dashboard-content {
            padding: 40px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.18);
            color: white;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.8);
            font-weight: 600;
        }

        /* Products Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        .product-card {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: white;
        }

        .product-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .product-image {
            height: 200px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .product-image::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8));
        }

        .product-info {
            padding: 25px;
        }

        .product-price {
            font-size: 1.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 15px 0;
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 20px 25px;
            border-radius: 15px;
            background: var(--glass);
            backdrop-filter: var(--blur);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 3000;
            transform: translateX(150%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 400px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            color: white;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-success {
            border-left: 5px solid var(--success);
        }

        .notification-error {
            border-left: 5px solid var(--danger);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .nav-links, .auth-buttons {
                display: none;
            }

            .mobile-menu-btn {
                display: block;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .hero p {
                font-size: 1.1rem;
            }

            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }

            .products-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Page Styles */
        .page {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dashboard Navigation */
        .dashboard-nav-links {
            display: flex;
            gap: 15px;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .dashboard-nav-link {
            padding: 12px 24px;
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 12px;
            text-decoration: none;
            color: white;
            font-weight: 600;
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: all 0.3s;
        }

        .dashboard-nav-link:hover, .dashboard-nav-link.active {
            background: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 0, 0.3);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 80px 30px;
            color: rgba(255, 255, 255, 0.7);
        }

        .empty-state i {
            font-size: 80px;
            margin-bottom: 25px;
            opacity: 0.5;
        }

        /* Loading Spinner */
        .loading-spinner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Seller Dashboard Styles */
        .seller-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .product-form {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            color: white;
        }

        .product-form h3 {
            margin-bottom: 20px;
            color: white;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* Rider Dashboard Styles */
        .delivery-card {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            color: white;
            transition: all 0.3s;
        }

        .delivery-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .delivery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .delivery-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-pending {
            background: rgba(251, 197, 49, 0.2);
            color: var(--warning);
        }

        .status-accepted {
            background: rgba(0, 184, 148, 0.2);
            color: var(--success);
        }

        .status-picked_up {
            background: rgba(116, 185, 255, 0.2);
            color: var(--info);
        }

        .status-delivered {
            background: rgba(0, 184, 148, 0.2);
            color: var(--success);
        }

        .status-cancelled {
            background: rgba(232, 65, 24, 0.2);
            color: var(--danger);
        }

        /* Legal Pages */
        .legal-page {
            padding: 120px 0 80px;
            color: white;
        }

        .legal-content {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            padding: 40px;
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .legal-content h1 {
            margin-bottom: 30px;
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .legal-content h2 {
            margin: 30px 0 15px;
            color: white;
        }

        .legal-content p {
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .legal-content ul {
            margin-bottom: 15px;
            padding-left: 20px;
        }

        .legal-content li {
            margin-bottom: 8px;
        }

        /* Contact Page */
        .contact-page {
            padding: 120px 0 80px;
            color: white;
        }

        .contact-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        @media (max-width: 768px) {
            .contact-grid {
                grid-template-columns: 1fr;
            }
        }

        .contact-info {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .contact-form {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .contact-icon {
            width: 50px;
            height: 50px;
            background: var(--gradient-primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        /* Chat Styles */
        .chat-container {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            height: 500px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            padding-right: 10px;
        }

        .chat-message {
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 15px;
            max-width: 80%;
        }

        .message-sent {
            background: var(--gradient-primary);
            margin-left: auto;
        }

        .message-received {
            background: rgba(255, 255, 255, 0.1);
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .chat-input button {
            padding: 15px 25px;
            background: var(--gradient-primary);
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
        }

        /* Cart and Order Styles */
        .cart-item, .order-item {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-item-info, .order-item-info {
            flex: 1;
        }

        .cart-item-actions, .order-item-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: none;
            background: var(--gradient-primary);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Map Styles */
        .map-container {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-bottom: 30px;
        }

        /* Animation for floating elements */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .floating {
            animation: float 5s ease-in-out infinite;
        }

        /* Enhanced Dashboard Styles */
        .dashboard-section {
            display: none;
        }

        .dashboard-section.active {
            display: block;
        }

        .dashboard-welcome {
            margin-bottom: 30px;
        }

        .dashboard-welcome h2 {
            color: white;
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .dashboard-welcome p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1rem;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .quick-action-card {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.18);
            color: white;
            transition: all 0.3s;
            cursor: pointer;
        }

        .quick-action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .quick-action-icon {
            font-size: 40px;
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .order-timeline {
            margin-top: 30px;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .timeline-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            font-size: 20px;
        }

        .timeline-content {
            flex: 1;
        }

        .timeline-content h4 {
            color: white;
            margin-bottom: 5px;
        }

        .timeline-content p {
            color: rgba(255, 255, 255, 0.8);
            margin: 0;
        }

        .timeline-time {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        /* Enhanced Product Cards */
        .product-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--gradient-primary);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 2;
        }

        .product-rating {
            display: flex;
            align-items: center;
            gap: 5px;
            margin: 10px 0;
        }

        .product-rating i {
            color: var(--accent);
        }

        .product-stock {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .stock-low {
            color: var(--danger);
        }

        .stock-medium {
            color: var(--warning);
        }

        .stock-high {
            color: var(--success);
        }

        /* Enhanced Order Cards */
        .order-card {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: all 0.3s;
        }

        .order-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .order-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .order-card-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .order-items {
            margin-top: 15px;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .order-item:last-child {
            border-bottom: none;
        }

        /* Enhanced Delivery Cards */
        .delivery-map {
            height: 200px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.7);
        }

        .delivery-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }

        @media (max-width: 768px) {
            .delivery-info {
                grid-template-columns: 1fr;
            }
        }

        .delivery-info-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .delivery-info-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Enhanced Forms */
        .form-section {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .form-section h3 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        /* Enhanced Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
        }

        .data-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        /* Enhanced Search and Filter */
        .search-filter-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
        }

        .filter-select {
            min-width: 150px;
        }

        /* Enhanced Progress Bars */
        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 10px;
            transition: width 0.3s;
        }

        /* Enhanced Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 25px;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
        }

        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Verification Styles */
        .verification-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .verification-pending {
            background: rgba(251, 197, 49, 0.2);
            color: var(--warning);
        }

        .verification-approved {
            background: rgba(0, 184, 148, 0.2);
            color: var(--success);
        }

        .verification-rejected {
            background: rgba(232, 65, 24, 0.2);
            color: var(--danger);
        }

        .verification-steps {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .verification-step {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .verification-step.completed {
            background: rgba(0, 184, 148, 0.1);
        }

        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .step-content {
            flex: 1;
        }

        /* Emergency Button */
        .emergency-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: var(--danger);
            color: white;
            border: none;
            box-shadow: 0 8px 25px rgba(232, 65, 24, 0.4);
            cursor: pointer;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s;
        }

        .emergency-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 30px rgba(232, 65, 24, 0.6);
        }

        /* Tracking Progress */
        .tracking-progress {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
            position: relative;
        }

        .tracking-progress::before {
            content: '';
            position: absolute;
            top: 25px;
            left: 0;
            right: 0;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            z-index: 1;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .step-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .progress-step.active .step-icon {
            background: var(--gradient-primary);
        }

        .progress-step.completed .step-icon {
            background: var(--success);
        }

        .step-label {
            font-size: 12px;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
        }

        .progress-step.active .step-label {
            color: white;
            font-weight: 600;
        }

        /* File Upload */
        .file-upload {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:hover {
            border-color: var(--primary);
        }

        .file-upload input {
            display: none;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 15px;
            color: rgba(255, 255, 255, 0.5);
        }

        .upload-text {
            color: rgba(255, 255, 255, 0.7);
        }

        /* About Section */
        .about-section {
            padding: 100px 0;
            background: transparent;
        }

        .about-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            align-items: center;
        }

        @media (max-width: 768px) {
            .about-content {
                grid-template-columns: 1fr;
            }
        }

        .about-text h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: white;
        }

        .about-text p {
            margin-bottom: 20px;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
        }

        .about-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 30px;
        }

        .about-stat {
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        /* Team Section */
        .team-section {
            padding: 100px 0;
            background: transparent;
        }

        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 50px;
        }

        .team-member {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: all 0.3s;
        }

        .team-member:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .member-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: white;
            background-size: cover;
            background-position: center;
        }

        .member-name {
            font-size: 1.3rem;
            margin-bottom: 5px;
            color: white;
        }

        .member-role {
            color: var(--primary);
            margin-bottom: 15px;
            font-weight: 600;
        }

        .member-bio {
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
        <p>Processing your request...</p>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <div>
            <h4 id="notificationTitle">Success</h4>
            <p id="notificationMessage">Operation completed successfully</p>
        </div>
    </div>

    <!-- Emergency Button (Riders Only) -->
    <button class="emergency-btn" id="emergencyBtn" style="display: none;">
        <i class="fas fa-exclamation-triangle"></i>
    </button>

    <!-- Landing Page -->
    <div class="page active" id="landingPage">
        <!-- Header -->
        <header id="mainHeader">
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <i class="fas fa-truck-fast logo-icon"></i>
                        <span class="logo-text">IPATE Deliveries</span>
                    </div>
                    <nav class="nav-links">
                        <a href="#features">Features</a>
                        <a href="#about">About Us</a>
                        <a href="#testimonials">Testimonials</a>
                        <a href="#faq">FAQ</a>
                        <a href="#" id="contactLink">Contact</a>
                    </nav>
                    <div class="auth-buttons">
                        <button class="btn btn-outline" id="loginBtn">Login</button>
                        <button class="btn btn-primary" id="signupBtn">Sign Up</button>
                    </div>
                    <button class="mobile-menu-btn" id="mobileMenuBtn">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Hero Section -->
        <section class="hero">
            <div class="container">
                <div class="hero-content">
                    <h1>Fast & Reliable Deliveries in Nairobi</h1>
                    <p>Get your goods delivered quickly and safely with our trusted network of verified riders. From food to documents, we've got you covered.</p>
                    <div class="hero-buttons">
                        <button class="btn btn-primary btn-large" id="getStartedBtn">
                            <i class="fas fa-rocket"></i> Get Started Now
                        </button>
                        <button class="btn btn-outline btn-large" id="aboutUsBtn">
                            <i class="fas fa-info-circle"></i> Learn More About Us
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section class="features" id="features">
            <div class="container">
                <h2 class="section-title">Why Choose IPATE Deliveries?</h2>
                <p class="section-subtitle">We provide the fastest, most reliable delivery service in Nairobi with cutting-edge technology and dedicated professionals.</p>
                <div class="features-grid">
                    <div class="feature-card floating">
                        <i class="fas fa-bolt feature-icon"></i>
                        <h3>Lightning Fast</h3>
                        <p>Our riders are strategically located across Nairobi to ensure your deliveries arrive in record time.</p>
                    </div>
                    <div class="feature-card floating" style="animation-delay: 0.5s;">
                        <i class="fas fa-shield-alt feature-icon"></i>
                        <h3>Secure & Safe</h3>
                        <p>All our riders are verified and your items are insured for complete peace of mind.</p>
                    </div>
                    <div class="feature-card floating" style="animation-delay: 1s;">
                        <i class="fas fa-map-marker-alt feature-icon"></i>
                        <h3>Real-Time Tracking</h3>
                        <p>Track your delivery in real-time from pickup to drop-off with our advanced tracking system.</p>
                    </div>
                    <div class="feature-card floating" style="animation-delay: 1.5s;">
                        <i class="fas fa-money-bill-wave feature-icon"></i>
                        <h3>Affordable Pricing</h3>
                        <p>Competitive pricing with no hidden fees. Pay only for the distance your delivery travels.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section class="about-section" id="about">
            <div class="container">
                <h2 class="section-title">About IPATE Deliveries</h2>
                <div class="about-content">
                    <div class="about-text">
                        <h2>Revolutionizing Delivery Services in Nairobi</h2>
                        <p>IPATE Deliveries was founded in 2023 with a mission to transform the delivery industry in Nairobi. We recognized the growing need for reliable, fast, and affordable delivery services for both businesses and individuals.</p>
                        <p>Our platform connects verified sellers with professional riders and customers, creating a seamless ecosystem that benefits everyone involved. We're committed to supporting local businesses while providing employment opportunities for riders.</p>
                        <p>With advanced technology, rigorous verification processes, and a customer-first approach, we're setting new standards for delivery services in Kenya.</p>
                        
                        <div class="about-stats">
                            <div class="about-stat">
                                <div class="stat-number">5000+</div>
                                <div class="stat-label">Deliveries Completed</div>
                            </div>
                            <div class="about-stat">
                                <div class="stat-number">200+</div>
                                <div class="stat-label">Verified Riders</div>
                            </div>
                            <div class="about-stat">
                                <div class="stat-number">98%</div>
                                <div class="stat-label">Customer Satisfaction</div>
                            </div>
                        </div>
                    </div>
                    <div class="about-image">
                        <div style="background: var(--glass); backdrop-filter: var(--blur); border-radius: 20px; padding: 30px; border: 1px solid rgba(255, 255, 255, 0.18); text-align: center;">
                            <i class="fas fa-truck-fast" style="font-size: 120px; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 20px;"></i>
                            <h3 style="color: white; margin-bottom: 15px;">Our Mission</h3>
                            <p style="color: rgba(255, 255, 255, 0.8);">To provide fast, reliable, and affordable delivery services while creating economic opportunities for our community.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Team Section -->
        <section class="team-section">
            <div class="container">
                <h2 class="section-title">Meet Our Team</h2>
                <p class="section-subtitle">The passionate individuals behind IPATE Deliveries</p>
                <div class="team-grid">
                    <div class="team-member">
                        <div class="member-avatar" style="background-image: url('https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80');"></div>
                        <h3 class="member-name">John Kamau</h3>
                        <div class="member-role">CEO & Founder</div>
                        <p class="member-bio">Former logistics manager with 10+ years experience in supply chain management.</p>
                    </div>
                    <div class="team-member">
                        <div class="member-avatar" style="background-image: url('https://images.unsplash.com/photo-1494790108755-2616b612b786?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80');"></div>
                        <h3 class="member-name">Sarah Wanjiku</h3>
                        <div class="member-role">Operations Director</div>
                        <p class="member-bio">Expert in process optimization and rider management with background in tech startups.</p>
                    </div>
                    <div class="team-member">
                        <div class="member-avatar" style="background-image: url('https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80');"></div>
                        <h3 class="member-name">David Ochieng</h3>
                        <div class="member-role">Technology Lead</div>
                        <p class="member-bio">Full-stack developer specializing in real-time tracking systems and mobile applications.</p>
                    </div>
                    <div class="team-member">
                        <div class="member-avatar" style="background-image: url('https://images.unsplash.com/photo-1489424731084-a5d8b219a5bb?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80');"></div>
                        <h3 class="member-name">Grace Akinyi</h3>
                        <div class="member-role">Customer Success</div>
                        <p class="member-bio">Dedicated to ensuring every customer has an exceptional experience with our service.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Testimonials Section -->
        <section class="testimonials" id="testimonials">
            <div class="container">
                <h2 class="section-title">What Our Customers Say</h2>
                <p class="section-subtitle">Hear from our satisfied customers, sellers, and riders about their experience with IPATE Deliveries.</p>
                <div class="testimonials-grid">
                    <div class="testimonial-card">
                        <div class="testimonial-content">
                            "IPATE Deliveries has revolutionized how I run my small business. My products reach customers faster than ever before!"
                        </div>
                        <div class="testimonial-author">
                            <div class="author-avatar">S</div>
                            <div class="author-info">
                                <h4>Sarah Kimani</h4>
                                <p>Small Business Owner</p>
                            </div>
                        </div>
                    </div>
                    <div class="testimonial-card">
                        <div class="testimonial-content">
                            "As a rider, I love the flexibility and fair earnings. The app makes it easy to manage deliveries and track my income."
                        </div>
                        <div class="testimonial-author">
                            <div class="author-avatar">J</div>
                            <div class="author-info">
                                <h4>John Otieno</h4>
                                <p>Delivery Rider</p>
                            </div>
                        </div>
                    </div>
                    <div class="testimonial-card">
                        <div class="testimonial-content">
                            "The real-time tracking feature gives me peace of mind. I always know exactly when my delivery will arrive."
                        </div>
                        <div class="testimonial-author">
                            <div class="author-avatar">M</div>
                            <div class="author-info">
                                <h4>Mary Wanjiku</h4>
                                <p>Regular Customer</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- FAQ Section -->
        <section class="faq-section" id="faq">
            <div class="container">
                <h2 class="section-title">Frequently Asked Questions</h2>
                <p class="section-subtitle">Find answers to the most common questions about our delivery services.</p>
                <div class="faq-container">
                    <div class="faq-item">
                        <div class="faq-question">
                            How fast can I get my delivery?
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="faq-answer">
                            Most deliveries within Nairobi are completed within 1-3 hours, depending on distance and traffic conditions. We offer express delivery options for urgent packages.
                        </div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question">
                            What areas do you serve?
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="faq-answer">
                            We currently serve all major areas in Nairobi including CBD, Westlands, Karen, Lang'ata, Kileleshwa, Kilimani, Lavington, Parklands, and many more. We're continuously expanding our coverage.
                        </div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question">
                            How do I become a rider?
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="faq-answer">
                            To become a rider, sign up for a rider account, complete the verification process, provide your vehicle details and license information, and complete our orientation. Once approved, you can start accepting delivery requests.
                        </div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question">
                            What payment methods do you accept?
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="faq-answer">
                            We primarily accept M-PESA payments for seamless transactions. We're working on adding more payment options including credit/debit cards in the near future.
                        </div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question">
                            Are my items insured during delivery?
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="faq-answer">
                            Yes, all items are covered by our basic insurance during transit. For high-value items, we recommend additional insurance coverage which can be arranged through our customer service.
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer>
            <div class="container">
                <div class="footer-grid">
                    <div class="footer-logo">
                        <i class="fas fa-truck-fast"></i>
                        IPATE Deliveries
                    </div>
                    <div class="footer-links">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href="#features"><i class="fas fa-chevron-right"></i> Features</a></li>
                            <li><a href="#about"><i class="fas fa-chevron-right"></i> About Us</a></li>
                            <li><a href="#testimonials"><i class="fas fa-chevron-right"></i> Testimonials</a></li>
                            <li><a href="#faq"><i class="fas fa-chevron-right"></i> FAQ</a></li>
                            <li><a href="#" id="footerContactLink"><i class="fas fa-chevron-right"></i> Contact</a></li>
                        </ul>
                    </div>
                    <div class="footer-links">
                        <h4>Legal</h4>
                        <ul>
                            <li><a href="#" id="privacyPolicyLink"><i class="fas fa-chevron-right"></i> Privacy Policy</a></li>
                            <li><a href="#" id="termsLink"><i class="fas fa-chevron-right"></i> Terms of Service</a></li>
                        </ul>
                    </div>
                    <div class="footer-links">
                        <h4>Contact Info</h4>
                        <ul>
                            <li><a href="tel:+254748894671"><i class="fas fa-phone"></i> +254 748 894 671</a></li>
                            <li><a href="mailto:info@ipatedeliveries.com"><i class="fas fa-envelope"></i> info@ipatedeliveries.com</a></li>
                            <li><a href="#"><i class="fas fa-map-marker-alt"></i> Nairobi, Kenya</a></li>
                        </ul>
                        <div class="social-links">
                            <a href="#" class="social-link"><i class="fab fa-facebook-f"></i></a>
                            <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
                            <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
                            <a href="#" class="social-link"><i class="fab fa-linkedin-in"></i></a>
                        </div>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p>&copy; 2025 IPATE Deliveries. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Customer Dashboard -->
    <div class="page dashboard" id="customerDashboard">
        <div class="dashboard-header">
            <div class="container">
                <div class="dashboard-nav">
                    <div class="logo">
                        <i class="fas fa-truck-fast logo-icon"></i>
                        <span class="logo-text">IPATE Deliveries</span>
                    </div>
                    <div class="user-info">
                        <div class="user-avatar" id="customerAvatar">U</div>
                        <div>
                            <div id="customerName">User</div>
                            <div style="font-size: 12px; opacity: 0.8;">Customer</div>
                        </div>
                        <button class="btn btn-outline btn-sm" id="customerLogoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="dashboard-content">
                <div class="dashboard-welcome">
                    <h2>Welcome back, <span id="customerWelcomeName">User</span>!</h2>
                    <p>Here's what's happening with your orders today.</p>
                </div>
                
                <div class="dashboard-nav-links">
                    <a href="#" class="dashboard-nav-link active" data-section="overview">Overview</a>
                    <a href="#" class="dashboard-nav-link" data-section="products">Products</a>
                    <a href="#" class="dashboard-nav-link" data-section="cart">My Cart</a>
                    <a href="#" class="dashboard-nav-link" data-section="orders">My Orders</a>
                    <a href="#" class="dashboard-nav-link" data-section="tracking">Order Tracking</a>
                    <a href="#" class="dashboard-nav-link" data-section="profile">Profile</a>
                </div>

                <!-- Overview Section -->
                <div class="dashboard-section active" id="overviewSection">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="customerTotalOrders">0</div>
                            <div class="stat-label">Total Orders</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="customerPendingOrders">0</div>
                            <div class="stat-label">Pending Orders</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="customerDeliveredOrders">0</div>
                            <div class="stat-label">Delivered Orders</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="customerCartItems">0</div>
                            <div class="stat-label">Items in Cart</div>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <div class="quick-action-card" onclick="switchDashboardSection('products')">
                            <div class="quick-action-icon">
                                <i class="fas fa-shopping-bag"></i>
                            </div>
                            <h3>Browse Products</h3>
                            <p>Shop from our wide selection</p>
                        </div>
                        <div class="quick-action-card" onclick="switchDashboardSection('tracking')">
                            <div class="quick-action-icon">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <h3>Track Order</h3>
                            <p>Check your delivery status</p>
                        </div>
                        <div class="quick-action-card" onclick="switchDashboardSection('orders')">
                            <div class="quick-action-icon">
                                <i class="fas fa-history"></i>
                            </div>
                            <h3>Order History</h3>
                            <p>View your past orders</p>
                        </div>
                        <div class="quick-action-card" onclick="switchDashboardSection('profile')">
                            <div class="quick-action-icon">
                                <i class="fas fa-user-cog"></i>
                            </div>
                            <h3>Account Settings</h3>
                            <p>Manage your profile</p>
                        </div>
                    </div>

                    <div class="order-timeline">
                        <h3 style="color: white; margin-bottom: 20px;">Recent Activity</h3>
                        <div id="customerRecentActivity">
                            <!-- Recent activity will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Products Section -->
                <div class="dashboard-section" id="productsSection">
                    <div class="search-filter-bar">
                        <div class="search-box">
                            <input type="text" class="form-control" id="productSearch" placeholder="Search products...">
                        </div>
                        <div class="filter-select">
                            <select class="form-control" id="categoryFilter">
                                <option value="">All Categories</option>
                                <option value="food">Food</option>
                                <option value="electronics">Electronics</option>
                                <option value="clothing">Clothing</option>
                                <option value="home">Home & Garden</option>
                            </select>
                        </div>
                        <div class="filter-select">
                            <select class="form-control" id="sortFilter">
                                <option value="">Sort By</option>
                                <option value="price-low">Price: Low to High</option>
                                <option value="price-high">Price: High to Low</option>
                                <option value="name">Name</option>
                                <option value="rating">Rating</option>
                            </select>
                        </div>
                    </div>

                    <h3 style="color: white; margin-bottom: 20px;">Available Products</h3>
                    <div class="products-grid" id="customerProductsGrid">
                        <!-- Products will be loaded here -->
                    </div>
                </div>

                <!-- Cart Section -->
                <div class="dashboard-section" id="cartSection">
                    <h3 style="color: white; margin-bottom: 20px;">My Cart</h3>
                    <div class="cart-items" id="customerCartItems">
                        <!-- Cart items will be loaded here -->
                    </div>
                    <div class="cart-summary" id="customerCartSummary">
                        <!-- Cart summary will be loaded here -->
                    </div>
                </div>

                <!-- Orders Section -->
                <div class="dashboard-section" id="ordersSection">
                    <div class="tabs">
                        <div class="tab active" data-tab="all">All Orders</div>
                        <div class="tab" data-tab="pending">Pending</div>
                        <div class="tab" data-tab="delivered">Delivered</div>
                        <div class="tab" data-tab="cancelled">Cancelled</div>
                    </div>

                    <div class="tab-content active" id="allOrders">
                        <h3 style="color: white; margin-bottom: 20px;">All Orders</h3>
                        <div class="orders-list" id="customerOrdersList">
                            <!-- Orders will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Order Tracking Section -->
                <div class="dashboard-section" id="trackingSection">
                    <h3 style="color: white; margin-bottom: 20px;">Order Tracking</h3>
                    <div class="map-container" id="trackingMap">
                        <i class="fas fa-map-marked-alt" style="font-size: 48px; margin-bottom: 15px;"></i>
                        <p>Real-time order tracking will be displayed here</p>
                    </div>
                    
                    <div id="activeDeliveryTracking">
                        <!-- Active delivery tracking will be loaded here -->
                    </div>
                </div>

                <!-- Profile Section -->
                <div class="dashboard-section" id="profileSection">
                    <h3 style="color: white; margin-bottom: 20px;">My Profile</h3>
                    <div class="form-section">
                        <h3>Personal Information</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="customerProfileName">Full Name</label>
                                <input type="text" id="customerProfileName" class="form-control" placeholder="Enter your full name">
                            </div>
                            <div class="form-group">
                                <label for="customerProfileEmail">Email</label>
                                <input type="email" id="customerProfileEmail" class="form-control" placeholder="Enter your email" readonly>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="customerProfilePhone">Phone Number</label>
                                <input type="tel" id="customerProfilePhone" class="form-control" placeholder="Enter your phone number">
                            </div>
                            <div class="form-group">
                                <label for="customerProfileAddress">Default Delivery Address</label>
                                <input type="text" id="customerProfileAddress" class="form-control" placeholder="Enter your delivery address">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Profile Photo</label>
                            <div class="file-upload" id="customerPhotoUpload">
                                <i class="fas fa-cloud-upload-alt upload-icon"></i>
                                <div class="upload-text">Click to upload profile photo</div>
                                <input type="file" id="customerPhotoInput" accept="image/*">
                            </div>
                        </div>
                        <button class="btn btn-primary" id="customerProfileSaveBtn">Save Changes</button>
                    </div>

                    <div class="form-section">
                        <h3>Delivery Preferences</h3>
                        <div class="form-group">
                            <label for="deliveryInstructions">Delivery Instructions</label>
                            <textarea id="deliveryInstructions" class="form-control" placeholder="Any special instructions for delivery" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="preferredTime">Preferred Delivery Time</label>
                            <select id="preferredTime" class="form-control">
                                <option value="any">Any Time</option>
                                <option value="morning">Morning (8AM - 12PM)</option>
                                <option value="afternoon">Afternoon (12PM - 5PM)</option>
                                <option value="evening">Evening (5PM - 9PM)</option>
                            </select>
                        </div>
                        <button class="btn btn-outline" id="updatePreferencesBtn">Update Preferences</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Seller Dashboard -->
    <div class="page dashboard" id="sellerDashboard">
        <div class="dashboard-header">
            <div class="container">
                <div class="dashboard-nav">
                    <div class="logo">
                        <i class="fas fa-truck-fast logo-icon"></i>
                        <span class="logo-text">IPATE Deliveries</span>
                    </div>
                    <div class="user-info">
                        <div class="user-avatar" id="sellerAvatar">S</div>
                        <div>
                            <div id="sellerName">Seller</div>
                            <div style="font-size: 12px; opacity: 0.8;">Seller Account</div>
                        </div>
                        <button class="btn btn-outline btn-sm" id="sellerLogoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="dashboard-content">
                <div class="dashboard-welcome">
                    <h2>Seller Dashboard</h2>
                    <p>Manage your products and track your sales performance.</p>
                </div>
                
                <div class="dashboard-nav-links">
                    <a href="#" class="dashboard-nav-link active" data-section="sellerOverview">Overview</a>
                    <a href="#" class="dashboard-nav-link" data-section="sellerProducts">Products</a>
                    <a href="#" class="dashboard-nav-link" data-section="addProduct">Add Product</a>
                    <a href="#" class="dashboard-nav-link" data-section="sellerOrders">Orders</a>
                    <a href="#" class="dashboard-nav-link" data-section="sellerAnalytics">Analytics</a>
                    <a href="#" class="dashboard-nav-link" data-section="sellerProfile">Profile</a>
                </div>

                <!-- Seller Overview Section -->
                <div class="dashboard-section active" id="sellerOverviewSection">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="sellerTotalProducts">0</div>
                            <div class="stat-label">Total Products</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="sellerLowStock">0</div>
                            <div class="stat-label">Low Stock</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="sellerTotalOrders">0</div>
                            <div class="stat-label">Total Orders</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="sellerPendingOrders">0</div>
                            <div class="stat-label">Pending Orders</div>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <div class="quick-action-card" onclick="switchDashboardSection('addProduct')">
                            <div class="quick-action-icon">
                                <i class="fas fa-plus-circle"></i>
                            </div>
                            <h3>Add Product</h3>
                            <p>List a new product for sale</p>
                        </div>
                        <div class="quick-action-card" onclick="switchDashboardSection('sellerProducts')">
                            <div class="quick-action-icon">
                                <i class="fas fa-boxes"></i>
                            </div>
                            <h3>Manage Products</h3>
                            <p>View and edit your products</p>
                        </div>
                        <div class="quick-action-card" onclick="switchDashboardSection('sellerOrders')">
                            <div class="quick-action-icon">
                                <i class="fas fa-clipboard-list"></i>
                            </div>
                            <h3>View Orders</h3>
                            <p>Check and manage orders</p>
                        </div>
                        <div class="quick-action-card" onclick="switchDashboardSection('sellerAnalytics')">
                            <div class="quick-action-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h3>Sales Analytics</h3>
                            <p>View performance metrics</p>
                        </div>
                    </div>

                    <div class="order-timeline">
                        <h3 style="color: white; margin-bottom: 20px;">Recent Orders</h3>
                        <div id="sellerRecentOrders">
                            <!-- Recent orders will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Products Section -->
                <div class="dashboard-section" id="sellerProductsSection">
                    <div class="seller-actions">
                        <button class="btn btn-primary" id="addProductBtn">
                            <i class="fas fa-plus"></i> Add New Product
                        </button>
                        <button class="btn btn-outline" id="refreshProductsBtn">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                    </div>

                    <h3 style="color: white; margin-bottom: 20px;">My Products</h3>
                    <div class="products-grid" id="sellerProductsGrid">
                        <!-- Seller products will be loaded here -->
                    </div>
                </div>

                <!-- Add Product Section -->
                <div class="dashboard-section" id="addProductSection">
                    <h3 style="color: white; margin-bottom: 20px;">Add New Product</h3>
                    <div class="product-form">
                        <form id="addProductForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="productName">Product Name</label>
                                    <input type="text" id="productName" class="form-control" placeholder="Enter product name" required>
                                </div>
                                <div class="form-group">
                                    <label for="productPrice">Price (KSh)</label>
                                    <input type="number" id="productPrice" class="form-control" placeholder="Enter price" min="0" step="0.01" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="productCategory">Category</label>
                                    <select id="productCategory" class="form-control" required>
                                        <option value="">Select category</option>
                                        <option value="food">Food</option>
                                        <option value="electronics">Electronics</option>
                                        <option value="clothing">Clothing</option>
                                        <option value="home">Home & Garden</option>
                                        <option value="health">Health & Beauty</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="productStock">Stock Quantity</label>
                                    <input type="number" id="productStock" class="form-control" placeholder="Enter stock quantity" min="0" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="productDescription">Description</label>
                                <textarea id="productDescription" class="form-control" placeholder="Enter product description" rows="3" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="productImage">Product Image</label>
                                <div class="file-upload" id="productImageUpload">
                                    <i class="fas fa-cloud-upload-alt upload-icon"></i>
                                    <div class="upload-text">Click to upload product image</div>
                                    <input type="file" id="productImageInput" accept="image/*">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Add Product</button>
                        </form>
                    </div>
                </div>

                <!-- Orders Section -->
                <div class="dashboard-section" id="sellerOrdersSection">
                    <h3 style="color: white; margin-bottom: 20px;">Order Management</h3>
                    <div class="orders-list" id="sellerOrdersList">
                        <!-- Seller orders will be loaded here -->
                    </div>
                </div>

                <!-- Analytics Section -->
                <div class="dashboard-section" id="sellerAnalyticsSection">
                    <h3 style="color: white; margin-bottom: 20px;">Sales Analytics</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="sellerTotalRevenue">0</div>
                            <div class="stat-label">Total Revenue</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="sellerMonthlyRevenue">0</div>
                            <div class="stat-label">Monthly Revenue</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="sellerAvgOrder">0</div>
                            <div class="stat-label">Avg Order Value</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="sellerConversion">0%</div>
                            <div class="stat-label">Conversion Rate</div>
                        </div>
                    </div>
                    <div style="background: var(--glass); backdrop-filter: var(--blur); border-radius: 20px; padding: 30px; margin-top: 30px; border: 1px solid rgba(255, 255, 255, 0.18); color: white; text-align: center;">
                        <h4 style="margin-bottom: 15px;">Sales Chart</h4>
                        <p>Sales visualization will be displayed here</p>
                        <div style="height: 200px; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.05); border-radius: 10px;">
                            <i class="fas fa-chart-line" style="font-size: 48px; opacity: 0.5;"></i>
                        </div>
                    </div>
                </div>

                <!-- Profile Section -->
                <div class="dashboard-section" id="sellerProfileSection">
                    <h3 style="color: white; margin-bottom: 20px;">Seller Profile</h3>
                    
                    <!-- Verification Status -->
                    <div class="form-section">
                        <h3>Verification Status</h3>
                        <div id="sellerVerificationStatus">
                            <!-- Verification status will be loaded here -->
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>Business Information</h3>
                        <div class="form-group">
                            <label for="sellerProfileName">Business Name</label>
                            <input type="text" id="sellerProfileName" class="form-control" placeholder="Enter your business name">
                        </div>
                        <div class="form-group">
                            <label for="sellerProfileEmail">Email</label>
                            <input type="email" id="sellerProfileEmail" class="form-control" placeholder="Enter your email" readonly>
                        </div>
                        <div class="form-group">
                            <label for="sellerProfilePhone">Phone Number</label>
                            <input type="tel" id="sellerProfilePhone" class="form-control" placeholder="Enter your phone number">
                        </div>
                        <div class="form-group">
                            <label for="sellerProfileAddress">Business Address</label>
                            <textarea id="sellerProfileAddress" class="form-control" placeholder="Enter your business address" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="sellerBusinessType">Business Type</label>
                            <select id="sellerBusinessType" class="form-control">
                                <option value="">Select business type</option>
                                <option value="individual">Individual</option>
                                <option value="partnership">Partnership</option>
                                <option value="corporation">Corporation</option>
                                <option value="llc">LLC</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Business Registration Document</label>
                            <div class="file-upload" id="businessDocUpload">
                                <i class="fas fa-cloud-upload-alt upload-icon"></i>
                                <div class="upload-text">Upload business registration document</div>
                                <input type="file" id="businessDocInput" accept=".pdf,.jpg,.jpeg,.png">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Profile Photo</label>
                            <div class="file-upload" id="sellerPhotoUpload">
                                <i class="fas fa-cloud-upload-alt upload-icon"></i>
                                <div class="upload-text">Click to upload profile photo</div>
                                <input type="file" id="sellerPhotoInput" accept="image/*">
                            </div>
                        </div>
                        <button class="btn btn-primary" id="sellerProfileSaveBtn">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Rider Dashboard -->
    <div class="page dashboard" id="riderDashboard">
        <div class="dashboard-header">
            <div class="container">
                <div class="dashboard-nav">
                    <div class="logo">
                        <i class="fas fa-truck-fast logo-icon"></i>
                        <span class="logo-text">IPATE Deliveries</span>
                    </div>
                    <div class="user-info">
                        <div class="user-avatar" id="riderAvatar">R</div>
                        <div>
                            <div id="riderName">Rider</div>
                            <div style="font-size: 12px; opacity: 0.8;">Rider Account</div>
                        </div>
                        <button class="btn btn-outline btn-sm" id="riderLogoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="dashboard-content">
                <div class="dashboard-welcome">
                    <h2>Rider Dashboard</h2>
                    <p>Manage your deliveries and track your earnings.</p>
                </div>
                
                <div class="dashboard-nav-links">
                    <a href="#" class="dashboard-nav-link active" data-section="riderOverview">Overview</a>
                    <a href="#" class="dashboard-nav-link" data-section="availableDeliveries">Available Deliveries</a>
                    <a href="#" class="dashboard-nav-link" data-section="myDeliveries">My Deliveries</a>
                    <a href="#" class="dashboard-nav-link" data-section="riderEarnings">Earnings</a>
                    <a href="#" class="dashboard-nav-link" data-section="riderProfile">Profile</a>
                </div>

                <!-- Rider Overview Section -->
                <div class="dashboard-section active" id="riderOverviewSection">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="availableDeliveries">0</div>
                            <div class="stat-label">Available Deliveries</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="activeDeliveries">0</div>
                            <div class="stat-label">Active Deliveries</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="completedDeliveries">0</div>
                            <div class="stat-label">Completed Today</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="riderRating">0.0</div>
                            <div class="stat-label">Your Rating</div>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <div class="quick-action-card" onclick="switchDashboardSection('availableDeliveries')">
                            <div class="quick-action-icon">
                                <i class="fas fa-list"></i>
                            </div>
                            <h3>Available Deliveries</h3>
                            <p>View new delivery requests</p>
                        </div>
                        <div class="quick-action-card" onclick="switchDashboardSection('myDeliveries')">
                            <div class="quick-action-icon">
                                <i class="fas fa-truck"></i>
                            </div>
                            <h3>My Deliveries</h3>
                            <p>Manage active deliveries</p>
                        </div>
                        <div class="quick-action-card" onclick="switchDashboardSection('riderEarnings')">
                            <div class="quick-action-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <h3>Earnings</h3>
                            <p>View your earnings</p>
                        </div>
                        <div class="quick-action-card" onclick="switchDashboardSection('riderProfile')">
                            <div class="quick-action-icon">
                                <i class="fas fa-user-cog"></i>
                            </div>
                            <h3>Profile</h3>
                            <p>Update your information</p>
                        </div>
                    </div>

                    <div class="order-timeline">
                        <h3 style="color: white; margin-bottom: 20px;">Recent Deliveries</h3>
                        <div id="riderRecentDeliveries">
                            <!-- Recent deliveries will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Available Deliveries Section -->
                <div class="dashboard-section" id="availableDeliveriesSection">
                    <h3 style="color: white; margin-bottom: 20px;">Available Deliveries</h3>
                    <div class="deliveries-list" id="availableDeliveriesList">
                        <!-- Available deliveries will be loaded here -->
                    </div>
                </div>

                <!-- My Deliveries Section -->
                <div class="dashboard-section" id="myDeliveriesSection">
                    <h3 style="color: white; margin-bottom: 20px;">My Active Deliveries</h3>
                    <div class="deliveries-list" id="myDeliveriesList">
                        <!-- Rider's active deliveries will be loaded here -->
                    </div>
                </div>

                <!-- Earnings Section -->
                <div class="dashboard-section" id="riderEarningsSection">
                    <h3 style="color: white; margin-bottom: 20px;">Earnings Overview</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">KSh <span id="todayEarnings">0</span></div>
                            <div class="stat-label">Today's Earnings</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">KSh <span id="weekEarnings">0</span></div>
                            <div class="stat-label">This Week</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">KSh <span id="monthEarnings">0</span></div>
                            <div class="stat-label">This Month</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalDeliveries">0</div>
                            <div class="stat-label">Total Deliveries</div>
                        </div>
                    </div>
                    <div style="background: var(--glass); backdrop-filter: var(--blur); border-radius: 20px; padding: 30px; margin-top: 30px; border: 1px solid rgba(255, 255, 255, 0.18); color: white;">
                        <h4 style="margin-bottom: 15px;">Earnings History</h4>
                        <div class="earnings-history" id="riderEarningsHistory">
                            <!-- Earnings history will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Profile Section -->
                <div class="dashboard-section" id="riderProfileSection">
                    <h3 style="color: white; margin-bottom: 20px;">Rider Profile</h3>
                    
                    <!-- Verification Status -->
                    <div class="form-section">
                        <h3>Verification Status</h3>
                        <div id="riderVerificationStatus">
                            <!-- Verification status will be loaded here -->
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>Personal Information</h3>
                        <div class="form-group">
                            <label for="riderProfileName">Full Name</label>
                            <input type="text" id="riderProfileName" class="form-control" placeholder="Enter your full name">
                        </div>
                        <div class="form-group">
                            <label for="riderProfileEmail">Email</label>
                            <input type="email" id="riderProfileEmail" class="form-control" placeholder="Enter your email" readonly>
                        </div>
                        <div class="form-group">
                            <label for="riderProfilePhone">Phone Number</label>
                            <input type="tel" id="riderProfilePhone" class="form-control" placeholder="Enter your phone number">
                        </div>
                        <div class="form-group">
                            <label for="riderIdNumber">National ID Number</label>
                            <input type="text" id="riderIdNumber" class="form-control" placeholder="Enter your national ID number">
                        </div>
                        <div class="form-group">
                            <label>Profile Photo</label>
                            <div class="file-upload" id="riderPhotoUpload">
                                <i class="fas fa-cloud-upload-alt upload-icon"></i>
                                <div class="upload-text">Click to upload profile photo</div>
                                <input type="file" id="riderPhotoInput" accept="image/*">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>Vehicle Information</h3>
                        <div class="form-group">
                            <label for="riderVehicle">Vehicle Type</label>
                            <select id="riderVehicle" class="form-control">
                                <option value="motorcycle">Motorcycle</option>
                                <option value="bicycle">Bicycle</option>
                                <option value="car">Car</option>
                                <option value="truck">Truck</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="riderLicense">License Number</label>
                            <input type="text" id="riderLicense" class="form-control" placeholder="Enter your license number">
                        </div>
                        <div class="form-group">
                            <label for="riderVehicleReg">Vehicle Registration</label>
                            <input type="text" id="riderVehicleReg" class="form-control" placeholder="Enter vehicle registration number">
                        </div>
                        <div class="form-group">
                            <label>License Photo</label>
                            <div class="file-upload" id="licensePhotoUpload">
                                <i class="fas fa-cloud-upload-alt upload-icon"></i>
                                <div class="upload-text">Upload photo of your license</div>
                                <input type="file" id="licensePhotoInput" accept="image/*">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Vehicle Photo</label>
                            <div class="file-upload" id="vehiclePhotoUpload">
                                <i class="fas fa-cloud-upload-alt upload-icon"></i>
                                <div class="upload-text">Upload photo of your vehicle</div>
                                <input type="file" id="vehiclePhotoInput" accept="image/*">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>Emergency Contact</h3>
                        <div class="form-group">
                            <label for="emergencyContactName">Emergency Contact Name</label>
                            <input type="text" id="emergencyContactName" class="form-control" placeholder="Enter emergency contact name">
                        </div>
                        <div class="form-group">
                            <label for="emergencyContactPhone">Emergency Contact Phone</label>
                            <input type="tel" id="emergencyContactPhone" class="form-control" placeholder="Enter emergency contact phone">
                        </div>
                        <div class="form-group">
                            <label for="emergencyContactRelation">Relationship</label>
                            <input type="text" id="emergencyContactRelation" class="form-control" placeholder="Enter relationship">
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" id="riderProfileSaveBtn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Page -->
    <div class="page contact-page" id="contactPage">
        <div class="container">
            <div class="legal-content">
                <h1>Contact Us</h1>
                <div class="contact-grid">
                    <div class="contact-info">
                        <h3>Get In Touch</h3>
                        <div class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-phone"></i>
                            </div>
                            <div>
                                <h4>Phone</h4>
                                <p>+254 748 894 671</p>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <div>
                                <h4>Email</h4>
                                <p>info@ipatedeliveries.com</p>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <div>
                                <h4>Address</h4>
                                <p>Nairobi, Kenya</p>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div>
                                <h4>Business Hours</h4>
                                <p>Mon - Sun: 6:00 AM - 10:00 PM</p>
                            </div>
                        </div>
                    </div>
                    <div class="contact-form">
                        <h3>Send us a Message</h3>
                        <form id="contactForm">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Your Name" required>
                            </div>
                            <div class="form-group">
                                <input type="email" class="form-control" placeholder="Your Email" required>
                            </div>
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Subject" required>
                            </div>
                            <div class="form-group">
                                <textarea class="form-control" placeholder="Your Message" rows="5" required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary btn-block">Send Message</button>
                        </form>
                    </div>
                </div>
                
                <div class="chat-container" style="margin-top: 40px;">
                    <h3 style="margin-bottom: 20px;">Live Chat Support</h3>
                    <div class="chat-messages" id="chatMessages">
                        <div class="chat-message message-received">
                            <p>Hello! How can we help you today?</p>
                            <small>10:30 AM</small>
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" placeholder="Type your message here...">
                        <button><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy Policy Page -->
 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Privacy Policy - iPate Deliveries</title>
    <style>
        /* Base Styles */
        :root {
            --primary: #2E7D32;
            --primary-dark: #1B5E20;
            --primary-light: #4CAF50;
            --text: #333333;
            --text-light: #666666;
            --background: #F9F9F9;
            --white: #FFFFFF;
            --border: #E0E0E0;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text);
            background-color: var(--background);
        }
        
        /* Header Styles */
        header {
            background-color: var(--white);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 5%;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }
        
        .logo-icon {
            width: 32px;
            height: 32px;
            background-color: var(--primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        /* Main Content */
        .container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 0 1.5rem;
        }
        
        .policy-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .policy-header h1 {
            font-size: 2.5rem;
            color: var(--primary-dark);
            margin-bottom: 1rem;
        }
        
        .last-updated {
            color: var(--text-light);
            font-style: italic;
            margin-bottom: 1.5rem;
        }
        
        .policy-content {
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 2.5rem;
        }
        
        .section {
            margin-bottom: 2.5rem;
        }
        
        .section:last-child {
            margin-bottom: 0;
        }
        
        .section h2 {
            color: var(--primary-dark);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }
        
        .section h3 {
            color: var(--primary);
            margin: 1.5rem 0 0.5rem 0;
        }
        
        .section p, .section ul {
            margin-bottom: 1rem;
        }
        
        .section ul {
            padding-left: 1.5rem;
        }
        
        .section li {
            margin-bottom: 0.5rem;
        }
        
        /* Footer */
        footer {
            background-color: var(--primary-dark);
            color: var(--white);
            padding: 2rem 0;
            margin-top: 3rem;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
        }
        
        .contact-info {
            text-align: center;
        }
        
        .contact-info p {
            margin-bottom: 0.5rem;
        }
        
        .copyright {
            text-align: center;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .policy-content {
                padding: 1.5rem;
            }
            
            .policy-header h1 {
                font-size: 2rem;
            }
            
            .section h2 {
                font-size: 1.5rem;
            }
        }
        
        @media (max-width: 480px) {
            .navbar {
                padding: 1rem;
            }
            
            .logo-text {
                font-size: 1.2rem;
            }
            
            .policy-header h1 {
                font-size: 1.8rem;
            }
            
            .policy-content {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar">
            <a href="#" class="logo">
                <div class="logo-icon">iP</div>
                <div class="logo-text">iPate Deliveries</div>
            </a>
        </nav>
    </header>
    
    <main class="container">
        <div class="policy-header">
            <h1>Privacy Policy</h1>
            <p class="last-updated">Last Updated: <span id="current-date"></span></p>
        </div>
        
        <div class="policy-content">
            <section class="section">
                <h2>1. Introduction</h2>
                <p>Welcome to iPate Deliveries ("we," "our," "us"). We are committed to protecting your privacy and ensuring the security of your personal information. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our mobile application, website, and related services (collectively, the "Services").</p>
                <p>By accessing or using our Services, you signify that you have read, understood, and agree to our collection, storage, use, and disclosure of your personal information as described in this Privacy Policy and our Terms of Service.</p>
            </section>
            
            <section class="section">
                <h2>2. Information We Collect</h2>
                <p>We collect several types of information to provide and improve our Services to you.</p>
                
                <h3>A. Information You Provide Directly to Us:</h3>
                <ul>
                    <li><strong>Account Information:</strong> When you create an account, we collect your name, email address, phone number, and a hashed version of your password.</li>
                    <li><strong>Delivery Details:</strong> We collect precise delivery addresses (including drop-off instructions), recipient names and phone numbers (for group orders or gifts), and your current location.</li>
                    <li><strong>Order Information:</strong> We collect the details of the orders you place, including the restaurant or store, items purchased, special instructions, and payment method.</li>
                    <li><strong>Payment Information:</strong> When you make a purchase, we collect payment information through our secure third-party payment processors.</li>
                    <li><strong>Communications:</strong> When you contact our customer support team, we collect the content of your messages and any other information you provide.</li>
                </ul>
                
                <h3>B. Information We Collect Automatically:</h3>
                <ul>
                    <li><strong>Device Information:</strong> We collect information about the device you use to access our Services.</li>
                    <li><strong>Usage Data:</strong> We automatically collect information about your interaction with our Services.</li>
                    <li><strong>Location Data:</strong> With your permission, we collect precise (GPS-level) location data from your mobile device.</li>
                    <li><strong>Cookies and Tracking Technologies:</strong> We use cookies and similar technologies to collect information about your browsing and ordering behavior.</li>
                </ul>
                
                <h3>C. Information from Third Parties:</h3>
                <ul>
                    <li><strong>Restaurants and Retail Partners:</strong> We may receive information about your orders from the restaurants and stores you order from.</li>
                    <li><strong>Social Media Platforms:</strong> If you create an account through a social media platform, we may receive certain information from that platform.</li>
                    <li><strong>Background Check Providers:</strong> For our delivery drivers, we receive the results of background checks.</li>
                </ul>
            </section>
            
            <section class="section">
                <h2>3. How We Use Your Information</h2>
                <p>We use the information we collect for the following business purposes:</p>
                <ul>
                    <li><strong>To Provide and Maintain Our Services:</strong> To create and manage your account, process your orders and payments, facilitate delivery, and provide customer support.</li>
                    <li><strong>To Personalize Your Experience:</strong> To suggest restaurants and items you might like and customize the content we show you.</li>
                    <li><strong>To Improve and Develop Our Services:</strong> To analyze usage trends, troubleshoot issues, and develop new features.</li>
                    <li><strong>To Communicate With You:</strong> To send you transactional messages and respond to your inquiries.</li>
                    <li><strong>For Marketing and Advertising:</strong> To send you promotional communications, subject to your preferences.</li>
                    <li><strong>For Security and Fraud Prevention:</strong> To verify accounts, monitor for suspicious activity, and protect our users and services.</li>
                </ul>
            </section>
            
            <section class="section">
                <h2>4. How We Share Your Information</h2>
                <p>We do not sell your personal information to third parties. We may share your information in the following limited circumstances:</p>
                <ul>
                    <li><strong>With Delivery Drivers:</strong> We share your delivery address, name, phone number, and order details with the assigned delivery driver.</li>
                    <li><strong>With Restaurants and Retail Partners:</strong> We share your name and order details with the restaurant or store.</li>
                    <li><strong>With Service Providers:</strong> We share information with trusted third-party vendors who perform services on our behalf.</li>
                    <li><strong>For Legal Reasons:</strong> We may disclose your information if required by law or in response to valid requests by public authorities.</li>
                    <li><strong>Business Transfers:</strong> In connection with a merger, acquisition, or sale of company assets.</li>
                    <li><strong>With Your Consent:</strong> We may share your information for any other purpose disclosed to you with your consent.</li>
                </ul>
            </section>
            
            <section class="section">
                <h2>5. Your Privacy Rights and Choices</h2>
                <p>Depending on your location, you may have the following rights regarding your personal information:</p>
                <ul>
                    <li><strong>Access and Portability:</strong> You can request a copy of the personal information we hold about you.</li>
                    <li><strong>Correction:</strong> You can update or correct inaccurate information in your account settings.</li>
                    <li><strong>Deletion:</strong> You can request the deletion of your personal information.</li>
                    <li><strong>Opt-Out of Marketing:</strong> You can unsubscribe from our marketing communications.</li>
                    <li><strong>Restrict Processing:</strong> You can object to or restrict the processing of your personal information.</li>
                </ul>
                <p>To exercise any of these rights, please contact us at <strong>privacy@ipatedeliveries.com</strong>.</p>
            </section>
            
            <section class="section">
                <h2>6. Data Security</h2>
                <p>We implement a variety of security measures designed to protect your personal information from unauthorized access, alteration, disclosure, or destruction. These include encryption for data in transit, secure servers for data at rest, and strict access controls. However, no method of transmission over the Internet is 100% secure, and we cannot guarantee absolute security.</p>
            </section>
            
            <section class="section">
                <h2>7. Data Retention</h2>
                <p>We will retain your personal information only for as long as is necessary for the purposes set out in this Privacy Policy, or as needed to comply with our legal obligations. When we no longer have a legitimate business need to process your personal information, we will securely delete or anonymize it.</p>
            </section>
            
            <section class="section">
                <h2>8. Children's Privacy</h2>
                <p>Our Services are not directed to individuals under the age of 16. We do not knowingly collect personal information from children. If we become aware that a child under 16 has provided us with personal information, we will take steps to delete such information.</p>
            </section>
            
            <section class="section">
                <h2>9. Changes to This Privacy Policy</h2>
                <p>We may update this Privacy Policy from time to time. The updated version will be indicated by a revised "Last Updated" date at the top of this page. We will notify you of any material changes by posting the new Privacy Policy on this page and/or through in-app notifications. You are advised to review this Privacy Policy periodically for any changes.</p>
            </section>
            
            <section class="section">
                <h2>10. Contact Us</h2>
                <p>If you have any questions, concerns, or complaints about this Privacy Policy or our data practices, please contact us at:</p>
                <p><strong>iPate Deliveries</strong><br>
                Email: privacy@ipatedeliveries.com<br>
                Mailing Address: [Your Company's Physical Address]<br>
                Phone: [Your Customer Support Phone Number]</p>
                <p>For users in the European Union, you have the right to lodge a complaint with a supervisory authority.</p>
            </section>
        </div>
    </main>
    
    <footer>
        <div class="footer-content">
            <div class="contact-info">
                <p><strong>iPate Deliveries</strong></p>
                <p>Delivering your favorites with care and privacy</p>
            </div>
            <div class="copyright">
                <p>&copy; <span id="current-year"></span> iPate Deliveries. All rights reserved.</p>
            </div>
        </div>
    </footer>
    
    <script>
        // Set current date and year
        document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
        
        document.getElementById('current-year').textContent = new Date().getFullYear();
    </script>
</body>
</html>
    <!-- Terms of Service Page -->
    <div class="page legal-page" id="termsPage">
        <div class="container">
            <div class="legal-content">
                <h1>Terms of Service</h1>
                <p>Last updated: January 1, 2025</p>
                
                <h2>1. Acceptance of Terms</h2>
                <p>By accessing and using IPATE Deliveries, you accept and agree to be bound by the terms and provision of this agreement.</p>
                
                <h2>2. Use License</h2>
                <p>Permission is granted to temporarily use IPATE Deliveries for personal, non-commercial transitory viewing only.</p>
                
                <h2>3. Delivery Services</h2>
                <p>We strive to provide timely delivery services, but we cannot guarantee specific delivery times due to factors beyond our control.</p>
                
                <h2>4. User Accounts</h2>
                <p>You are responsible for maintaining the confidentiality of your account and password.</p>
                
                <h2>5. Payments</h2>
                <p>All payments are processed securely through our payment partners. Refunds are subject to our refund policy.</p>
                
                <h2>6. Limitations</h2>
                <p>In no event shall IPATE Deliveries or its suppliers be liable for any damages arising out of the use or inability to use our services.</p>
                
                <h2>7. Governing Law</h2>
                <p>These terms and conditions are governed by and construed in accordance with the laws of Kenya.</p>
            </div>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <span class="close-modal" id="closeAuthModal">&times;</span>
            <div class="auth-tabs">
                <div class="auth-tab active" id="loginTab">Login</div>
                <div class="auth-tab" id="signupTab">Sign Up</div>
            </div>
            <form class="auth-form active" id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <<input type="email" id="loginEmail" class="form-control" placeholder="Enter your email" required autocomplete="email">>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" class="form-control" placeholder="Enter your password" required autocomplete="current-password">
                </div>
                <button type="submit" class="btn btn-primary btn-block">Login</button>
            </form>
            <form class="auth-form" id="signupForm">
                <div class="form-group">
                    <label for="signupName">Full Name</label>
                    <<input type="email" id="signupEmail" class="form-control" placeholder="Enter your email" required autocomplete="email">>
                </div>
                <div class="form-group">
                    <label for="signupEmail">Email</label>
                    <input type="email"id="signupEmail2" class="form-control" placeholder="Enter your email" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" class="form-control" placeholder="Create a password" required autocomplete="new-password">
                </div>
                <div class="form-group">
                    <label for="userRole">Account Type</label>
                    <select id="userRole" class="form-control" required>
                        <option value="">Select account type</option>
                        <option value="customer">Customer</option>
                        <option value="seller">Seller</option>
                        <option value="rider">Rider</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Create Account</button>
            </form>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://xbwvsswycdskxkorharu.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhid3Zzc3d5Y2Rza3hrb3JoYXJ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIyNDI4MjcsImV4cCI6MjA3NzgxODgyN30.8PWNCjErZ4194dBT48ph4PyMWTO0EqLsZIDK8j2O1yc';
        
        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Global State
        let currentUser = null;
        let userRole = null;
        let deliverySubscription = null;
        
        // DOM Elements
        const elements = {
            // Pages
            landingPage: document.getElementById('landingPage'),
            customerDashboard: document.getElementById('customerDashboard'),
            sellerDashboard: document.getElementById('sellerDashboard'),
            riderDashboard: document.getElementById('riderDashboard'),
            contactPage: document.getElementById('contactPage'),
            privacyPolicyPage: document.getElementById('privacyPolicyPage'),
            termsPage: document.getElementById('termsPage'),
            
            // Authentication
            authModal: document.getElementById('authModal'),
            loginTab: document.getElementById('loginTab'),
            signupTab: document.getElementById('signupTab'),
            loginForm: document.getElementById('loginForm'),
            signupForm: document.getElementById('signupForm'),
            closeAuthModal: document.getElementById('closeAuthModal'),
            loginBtn: document.getElementById('loginBtn'),
            signupBtn: document.getElementById('signupBtn'),
            getStartedBtn: document.getElementById('getStartedBtn'),
            aboutUsBtn: document.getElementById('aboutUsBtn'),
            
            // Customer Dashboard
            customerProductsGrid: document.getElementById('customerProductsGrid'),
            customerCartItems: document.getElementById('customerCartItems'),
            customerCartSummary: document.getElementById('customerCartSummary'),
            customerOrdersList: document.getElementById('customerOrdersList'),
            customerLogoutBtn: document.getElementById('customerLogoutBtn'),
            customerWelcomeName: document.getElementById('customerWelcomeName'),
            customerName: document.getElementById('customerName'),
            customerAvatar: document.getElementById('customerAvatar'),
            customerTotalOrders: document.getElementById('customerTotalOrders'),
            customerPendingOrders: document.getElementById('customerPendingOrders'),
            customerDeliveredOrders: document.getElementById('customerDeliveredOrders'),
            customerCartItemsCount: document.getElementById('customerCartItems'),
            customerProfileSaveBtn: document.getElementById('customerProfileSaveBtn'),
            customerRecentActivity: document.getElementById('customerRecentActivity'),
            customerPhotoUpload: document.getElementById('customerPhotoUpload'),
            customerPhotoInput: document.getElementById('customerPhotoInput'),
            updatePreferencesBtn: document.getElementById('updatePreferencesBtn'),
            productSearch: document.getElementById('productSearch'),
            categoryFilter: document.getElementById('categoryFilter'),
            sortFilter: document.getElementById('sortFilter'),
            trackingMap: document.getElementById('trackingMap'),
            activeDeliveryTracking: document.getElementById('activeDeliveryTracking'),
            
            // Seller Dashboard
            sellerProductsGrid: document.getElementById('sellerProductsGrid'),
            sellerOrdersList: document.getElementById('sellerOrdersList'),
            sellerLogoutBtn: document.getElementById('sellerLogoutBtn'),
            sellerName: document.getElementById('sellerName'),
            sellerAvatar: document.getElementById('sellerAvatar'),
            sellerTotalProducts: document.getElementById('sellerTotalProducts'),
            sellerLowStock: document.getElementById('sellerLowStock'),
            sellerTotalOrders: document.getElementById('sellerTotalOrders'),
            sellerPendingOrders: document.getElementById('sellerPendingOrders'),
            sellerTotalRevenue: document.getElementById('sellerTotalRevenue'),
            sellerMonthlyRevenue: document.getElementById('sellerMonthlyRevenue'),
            sellerAvgOrder: document.getElementById('sellerAvgOrder'),
            sellerConversion: document.getElementById('sellerConversion'),
            addProductForm: document.getElementById('addProductForm'),
            sellerProfileSaveBtn: document.getElementById('sellerProfileSaveBtn'),
            addProductBtn: document.getElementById('addProductBtn'),
            refreshProductsBtn: document.getElementById('refreshProductsBtn'),
            sellerRecentOrders: document.getElementById('sellerRecentOrders'),
            sellerVerificationStatus: document.getElementById('sellerVerificationStatus'),
            sellerPhotoUpload: document.getElementById('sellerPhotoUpload'),
            sellerPhotoInput: document.getElementById('sellerPhotoInput'),
            businessDocUpload: document.getElementById('businessDocUpload'),
            businessDocInput: document.getElementById('businessDocInput'),
            productImageUpload: document.getElementById('productImageUpload'),
            productImageInput: document.getElementById('productImageInput'),
            
            // Rider Dashboard
            riderLogoutBtn: document.getElementById('riderLogoutBtn'),
            riderName: document.getElementById('riderName'),
            riderAvatar: document.getElementById('riderAvatar'),
            availableDeliveries: document.getElementById('availableDeliveries'),
            activeDeliveries: document.getElementById('activeDeliveries'),
            completedDeliveries: document.getElementById('completedDeliveries'),
            riderRating: document.getElementById('riderRating'),
            todayEarnings: document.getElementById('todayEarnings'),
            weekEarnings: document.getElementById('weekEarnings'),
            monthEarnings: document.getElementById('monthEarnings'),
            totalDeliveries: document.getElementById('totalDeliveries'),
            availableDeliveriesList: document.getElementById('availableDeliveriesList'),
            myDeliveriesList: document.getElementById('myDeliveriesList'),
            riderEarningsHistory: document.getElementById('riderEarningsHistory'),
            riderProfileSaveBtn: document.getElementById('riderProfileSaveBtn'),
            riderRecentDeliveries: document.getElementById('riderRecentDeliveries'),
            riderVerificationStatus: document.getElementById('riderVerificationStatus'),
            riderPhotoUpload: document.getElementById('riderPhotoUpload'),
            riderPhotoInput: document.getElementById('riderPhotoInput'),
            licensePhotoUpload: document.getElementById('licensePhotoUpload'),
            licensePhotoInput: document.getElementById('licensePhotoInput'),
            vehiclePhotoUpload: document.getElementById('vehiclePhotoUpload'),
            vehiclePhotoInput: document.getElementById('vehiclePhotoInput'),
            
            // Emergency Button
            emergencyBtn: document.getElementById('emergencyBtn'),
            
            // Legal and Contact Links
            contactLink: document.getElementById('contactLink'),
            footerContactLink: document.getElementById('footerContactLink'),
            privacyPolicyLink: document.getElementById('privacyPolicyLink'),
            termsLink: document.getElementById('termsLink'),
            contactForm: document.getElementById('contactForm'),
            
            // Loading Spinner
            loadingSpinner: document.getElementById('loadingSpinner'),
            
            // Notification
            notification: document.getElementById('notification'),
            notificationTitle: document.getElementById('notificationTitle'),
            notificationMessage: document.getElementById('notificationMessage')
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            checkAuthState();
            initializeDatabase();
            setupFAQ();
            setupHeaderScroll();
            setupTabs();
        });

        // Set up event listeners
        function setupEventListeners() {
            // Authentication
            elements.loginBtn.addEventListener('click', () => showAuthModal('login'));
            elements.signupBtn.addEventListener('click', () => showAuthModal('signup'));
            elements.getStartedBtn.addEventListener('click', () => showAuthModal('signup'));
            elements.aboutUsBtn.addEventListener('click', scrollToAbout);
            elements.closeAuthModal.addEventListener('click', () => hideAuthModal());
            elements.loginTab.addEventListener('click', () => switchAuthTab('login'));
            elements.signupTab.addEventListener('click', () => switchAuthTab('signup'));
            elements.loginForm.addEventListener('submit', handleLogin);
            elements.signupForm.addEventListener('submit', handleSignup);
            
            // Dashboard Navigation
            document.querySelectorAll('.dashboard-nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    switchDashboardSection(section);
                });
            });
            
            // Logout buttons
            elements.customerLogoutBtn.addEventListener('click', handleLogout);
            elements.sellerLogoutBtn.addEventListener('click', handleLogout);
            elements.riderLogoutBtn.addEventListener('click', handleLogout);
            
            // Profile Save Buttons
            elements.customerProfileSaveBtn.addEventListener('click', saveCustomerProfile);
            elements.sellerProfileSaveBtn.addEventListener('click', saveSellerProfile);
            elements.riderProfileSaveBtn.addEventListener('click', saveRiderProfile);
            
            // Customer Actions
            elements.updatePreferencesBtn.addEventListener('click', updateCustomerPreferences);
            elements.productSearch.addEventListener('input', filterProducts);
            elements.categoryFilter.addEventListener('change', filterProducts);
            elements.sortFilter.addEventListener('change', filterProducts);
            
            // Seller Actions
            elements.addProductBtn.addEventListener('click', () => switchDashboardSection('addProduct'));
            elements.refreshProductsBtn.addEventListener('click', loadSellerProducts);
            elements.addProductForm.addEventListener('submit', handleAddProduct);
            
            // File Uploads
            elements.customerPhotoUpload.addEventListener('click', () => elements.customerPhotoInput.click());
            elements.customerPhotoInput.addEventListener('change', handleCustomerPhotoUpload);
            
            elements.sellerPhotoUpload.addEventListener('click', () => elements.sellerPhotoInput.click());
            elements.sellerPhotoInput.addEventListener('change', handleSellerPhotoUpload);
            elements.businessDocUpload.addEventListener('click', () => elements.businessDocInput.click());
            elements.businessDocInput.addEventListener('change', handleBusinessDocUpload);
            elements.productImageUpload.addEventListener('click', () => elements.productImageInput.click());
            elements.productImageInput.addEventListener('change', handleProductImageUpload);
            
            elements.riderPhotoUpload.addEventListener('click', () => elements.riderPhotoInput.click());
            elements.riderPhotoInput.addEventListener('change', handleRiderPhotoUpload);
            elements.licensePhotoUpload.addEventListener('click', () => elements.licensePhotoInput.click());
            elements.licensePhotoInput.addEventListener('change', handleLicensePhotoUpload);
            elements.vehiclePhotoUpload.addEventListener('click', () => elements.vehiclePhotoInput.click());
            elements.vehiclePhotoInput.addEventListener('change', handleVehiclePhotoUpload);
            
            // Emergency Button
            elements.emergencyBtn.addEventListener('click', handleEmergency);
            
            // Legal and Contact Links
            elements.contactLink.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('contactPage');
            });
            elements.footerContactLink.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('contactPage');
            });
            elements.privacyPolicyLink.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('privacyPolicyPage');
            });
            elements.termsLink.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('termsPage');
            });
            elements.contactForm.addEventListener('submit', handleContactForm);
            
            // Close modals when clicking outside
            document.addEventListener('click', (e) => {
                if (e.target === elements.authModal) {
                    hideAuthModal();
                }
            });

            // Smooth scrolling for navigation links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        }

        // Setup header scroll effect
        function setupHeaderScroll() {
            const header = document.getElementById('mainHeader');
            window.addEventListener('scroll', () => {
                if (window.scrollY > 100) {
                    header.classList.add('header-scrolled');
                } else {
                    header.classList.remove('header-scrolled');
                }
            });
        }

        // Setup tabs
        function setupTabs() {
            // Customer orders tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Update active tab
                    document.querySelectorAll('.tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Show corresponding content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(tabId + 'Orders').classList.add('active');
                    
                    // Load orders for this tab
                    if (userRole === 'customer') {
                        loadCustomerOrders(tabId);
                    }
                });
            });
        }

        // FAQ functionality
        function setupFAQ() {
            const faqItems = document.querySelectorAll('.faq-item');
            
            faqItems.forEach(item => {
                const question = item.querySelector('.faq-question');
                
                question.addEventListener('click', () => {
                    // Close all other FAQ items
                    faqItems.forEach(otherItem => {
                        if (otherItem !== item) {
                            otherItem.classList.remove('active');
                        }
                    });
                    
                    // Toggle current item
                    item.classList.toggle('active');
                });
            });
        }

        // Scroll to about section
        function scrollToAbout() {
            document.getElementById('about').scrollIntoView({
                behavior: 'smooth'
            });
        }

        // Initialize database tables
        async function initializeDatabase() {
            try {
                // Check if required tables exist, if not create them
                const requiredTables = ['profiles', 'products', 'orders', 'order_items', 'cart_items', 'deliveries', 'verifications'];
                
                for (const table of requiredTables) {
                    const { error } = await supabase
                        .from(table)
                        .select('*')
                        .limit(1);
                    
                    if (error && error.code === 'PGRST116') {
                        // Table doesn't exist, we need to create it
                        console.log(`Table ${table} doesn't exist. Creating sample data...`);
                        await createSampleData();
                        break;
                    }
                }
            } catch (error) {
                console.error('Error initializing database:', error);
            }
        }

        // Create sample data
        async function createSampleData() {
            try {
                // Create sample products
                const sampleProducts = [
                    {
                        name: 'Fresh Groceries Package',
                        description: 'A package of fresh vegetables and fruits from local farmers.',
                        price: 1500,
                        category: 'food',
                        stock: 20,
                        seller_id: '00000000-0000-0000-0000-000000000000',
                        image_url: 'https://images.unsplash.com/photo-1542838132-92c53300491e?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'
                    },
                    {
                        name: 'Smartphone',
                        description: 'Latest smartphone with advanced features and camera.',
                        price: 25000,
                        category: 'electronics',
                        stock: 10,
                        seller_id: '00000000-0000-0000-0000-000000000000',
                        image_url: 'https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'
                    },
                    {
                        name: 'Fashion T-Shirt',
                        description: 'Comfortable and stylish cotton t-shirt for everyday wear.',
                        price: 800,
                        category: 'clothing',
                        stock: 50,
                        seller_id: '00000000-0000-0000-0000-000000000000',
                        image_url: 'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'
                    },
                    {
                        name: 'Home Decor Set',
                        description: 'Beautiful home decoration items to enhance your living space.',
                        price: 3500,
                        category: 'home',
                        stock: 15,
                        seller_id: '00000000-0000-0000-0000-000000000000',
                        image_url: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'
                    },
                    {
                        name: 'Beauty Kit',
                        description: 'Complete beauty and skincare kit for daily routine.',
                        price: 2200,
                        category: 'health',
                        stock: 25,
                        seller_id: '00000000-0000-0000-0000-000000000000',
                        image_url: 'https://images.unsplash.com/photo-1596462502278-27bfdc403348?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'
                    },
                    {
                        name: 'Office Supplies',
                        description: 'Essential office supplies for your workspace.',
                        price: 1200,
                        category: 'other',
                        stock: 30,
                        seller_id: '00000000-0000-0000-0000-000000000000',
                        image_url: 'https://images.unsplash.com/photo-1587334944162-7c0f7a2dff5d?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'
                    }
                ];
                
                const { data: products, error } = await supabase
                    .from('products')
                    .insert(sampleProducts)
                    .select();
                
                if (error) {
                    console.error('Error creating sample products:', error);
                } else {
                    console.log('Sample products created successfully');
                }
            } catch (error) {
                console.error('Error creating sample data:', error);
            }
        }

        // Check authentication state
        async function checkAuthState() {
            try {
                const { data: { user } } = await supabase.auth.getUser();
                
                if (user) {
                    currentUser = user;
                    
                    // Get user profile from database
                    const { data: profile, error } = await supabase
                        .from('profiles')
                        .select('*')
                        .eq('id', user.id)
                        .single();
                    
                    if (error) {
                        console.error('Error fetching user profile:', error);
                        return;
                    }
                    
                    userRole = profile.role;
                    
                    // Update UI based on role
                    const userName = profile?.name || user.email;
                    
                    switch (userRole) {
                        case 'customer':
                            showCustomerDashboard();
                            elements.customerWelcomeName.textContent = userName;
                            elements.customerName.textContent = userName;
                            updateUserAvatar(elements.customerAvatar, profile.avatar_url, userName);
                            loadCustomerData();
                            break;
                        case 'seller':
                            showSellerDashboard();
                            elements.sellerName.textContent = userName;
                            updateUserAvatar(elements.sellerAvatar, profile.avatar_url, userName);
                            loadSellerData();
                            break;
                        case 'rider':
                            showRiderDashboard();
                            elements.riderName.textContent = userName;
                            updateUserAvatar(elements.riderAvatar, profile.avatar_url, userName);
                            loadRiderData();
                            // Show emergency button for riders
                            elements.emergencyBtn.style.display = 'flex';
                            break;
                    }
                }
            } catch (error) {
                console.error('Error checking auth state:', error);
            }
        }

        // Update user avatar
        function updateUserAvatar(element, avatarUrl, userName) {
            if (avatarUrl) {
                element.style.backgroundImage = `url('${avatarUrl}')`;
                element.textContent = '';
            } else {
                element.style.backgroundImage = '';
                element.textContent = userName.charAt(0).toUpperCase();
            }
        }

        // Show authentication modal
        function showAuthModal(tab) {
            elements.authModal.style.display = 'flex';
            switchAuthTab(tab);
        }

        // Hide authentication modal
        function hideAuthModal() {
            elements.authModal.style.display = 'none';
        }

        // Switch authentication tab
        function switchAuthTab(tab) {
            // Update tabs
            elements.loginTab.classList.toggle('active', tab === 'login');
            elements.signupTab.classList.toggle('active', tab === 'signup');
            
            // Update forms
            elements.loginForm.classList.toggle('active', tab === 'login');
            elements.signupForm.classList.toggle('active', tab === 'signup');
        }

        // Handle login
        async function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showNotification('Error', 'Please enter both email and password', 'error');
                return;
            }
            
            showLoading();
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email,
                    password
                });
                
                if (error) {
                    throw error;
                }
                
                currentUser = data.user;
                
                // Get user profile
                const { data: profile, error: profileError } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', data.user.id)
                    .single();
                
                if (profileError) {
                    console.error('Error fetching profile:', profileError);
                    return;
                }
                
                userRole = profile.role;
                
                hideLoading();
                hideAuthModal();
                showNotification('Success', 'Logged in successfully!', 'success');
                
                // Update UI based on role
                const userName = profile?.name || data.user.email;
                
                switch (userRole) {
                    case 'customer':
                        showCustomerDashboard();
                        elements.customerWelcomeName.textContent = userName;
                        elements.customerName.textContent = userName;
                        updateUserAvatar(elements.customerAvatar, profile.avatar_url, userName);
                        loadCustomerData();
                        break;
                    case 'seller':
                        showSellerDashboard();
                        elements.sellerName.textContent = userName;
                        updateUserAvatar(elements.sellerAvatar, profile.avatar_url, userName);
                        loadSellerData();
                        break;
                    case 'rider':
                        showRiderDashboard();
                        elements.riderName.textContent = userName;
                        updateUserAvatar(elements.riderAvatar, profile.avatar_url, userName);
                        loadRiderData();
                        // Show emergency button for riders
                        elements.emergencyBtn.style.display = 'flex';
                        break;
                }
                
            } catch (error) {
                hideLoading();
                showNotification('Error', error.message, 'error');
            }
        }

        // Handle signup
        async function handleSignup(e) {
            e.preventDefault();
            
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const role = document.getElementById('userRole').value;
            
            if (!name || !email || !password || !role) {
                showNotification('Error', 'Please fill in all fields', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Error', 'Password must be at least 6 characters', 'error');
                return;
            }
            
            showLoading();
            
            try {
                // Create user in Supabase Auth
                const { data, error } = await supabase.auth.signUp({
                    email,
                    password,
                    options: {
                        data: {
                            name: name,
                            role: role
                        }
                    }
                });
                
                if (error) {
                    throw error;
                }
                
                // Create user profile in database
                if (data.user) {
                    await createUserProfile(data.user, role, name);
                }
                
                hideLoading();
                hideAuthModal();
                
                if (data.user && data.user.identities && data.user.identities.length === 0) {
                    showNotification('Error', 'User already exists with this email', 'error');
                } else {
                    showNotification('Success', 'Account created successfully! Please check your email for verification.', 'success');
                    document.getElementById('signupForm').reset();
                    
                    // Auto-login after successful signup
                    if (data.user) {
                        currentUser = data.user;
                        userRole = role;
                        
                        // Show appropriate dashboard based on selected role
                        const userName = name || data.user.email;
                        
                        switch (userRole) {
                            case 'customer':
                                showCustomerDashboard();
                                elements.customerWelcomeName.textContent = userName;
                                elements.customerName.textContent = userName;
                                elements.customerAvatar.textContent = userName.charAt(0).toUpperCase();
                                loadCustomerData();
                                break;
                            case 'seller':
                                showSellerDashboard();
                                elements.sellerName.textContent = userName;
                                elements.sellerAvatar.textContent = userName.charAt(0).toUpperCase();
                                loadSellerData();
                                break;
                            case 'rider':
                                showRiderDashboard();
                                elements.riderName.textContent = userName;
                                elements.riderAvatar.textContent = userName.charAt(0).toUpperCase();
                                loadRiderData();
                                // Show emergency button for riders
                                elements.emergencyBtn.style.display = 'flex';
                                break;
                        }
                    }
                }
                
            } catch (error) {
                hideLoading();
                showNotification('Error', error.message, 'error');
            }
        }

        // Create user profile - fixed version
        async function createUserProfile(user, role, name) {
            try {
                const profileData = {
                    id: user.id,
                    name: name,
                    email: user.email,
                    role: role,
                    created_at: new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };
                
                // Add role-specific fields
                if (role === 'seller') {
                    profileData.verification_status = 'pending';
                    profileData.business_type = '';
                } else if (role === 'rider') {
                    profileData.verification_status = 'pending';
                    profileData.vehicle_type = 'motorcycle';
                    profileData.is_available = true;
                }
                
                console.log('Creating profile for user:', user.id);
                
                const { data, error } = await supabase
                    .from('profiles')
                    .insert([profileData])
                    .select()
                    .single();
                
                if (error) {
                    console.error('Error creating user profile:', error);
                    
                    // If profile already exists, try to fetch it
                    if (error.code === '23505') {
                        console.log('Profile already exists, fetching...');
                        const { data: existingProfile } = await supabase
                            .from('profiles')
                            .select('*')
                            .eq('id', user.id)
                            .single();
                        
                        if (existingProfile) {
                            return existingProfile;
                        }
                    }
                    
                    throw error;
                }
                
                console.log('Profile created successfully:', data);
                return data;
            } catch (error) {
                console.error('Failed to create user profile:', error);
                showNotification('Error', 'Failed to create user profile: ' + error.message, 'error');
                throw error;
            }
        }

        // Handle logout
        async function handleLogout() {
            showLoading();
            
            try {
                // Unsubscribe from real-time updates
                if (deliverySubscription) {
                    supabase.removeChannel(deliverySubscription);
                }
                
                const { error } = await supabase.auth.signOut();
                
                if (error) {
                    throw error;
                }
                
                currentUser = null;
                userRole = null;
                
                // Hide emergency button
                elements.emergencyBtn.style.display = 'none';
                
                hideLoading();
                showPage('landingPage');
                showNotification('Success', 'Logged out successfully!', 'success');
            } catch (error) {
                hideLoading();
                showNotification('Error', error.message, 'error');
            }
        }

        // Show page
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show target page
            document.getElementById(pageId).classList.add('active');
            
            // Scroll to top when switching pages
            window.scrollTo(0, 0);
        }

        // Show customer dashboard
        function showCustomerDashboard() {
            showPage('customerDashboard');
            switchDashboardSection('overview');
        }

        // Show seller dashboard
        function showSellerDashboard() {
            showPage('sellerDashboard');
            switchDashboardSection('sellerOverview');
        }

        // Show rider dashboard
        function showRiderDashboard() {
            showPage('riderDashboard');
            switchDashboardSection('riderOverview');
        }

        // Switch dashboard section
        function switchDashboardSection(section) {
            // Get the parent dashboard
            const dashboard = document.querySelector('.page.active');
            
            // Hide all sections in this dashboard
            dashboard.querySelectorAll('.dashboard-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show target section
            const targetSection = document.getElementById(section + 'Section');
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // Update active nav link
            const navLinks = dashboard.querySelectorAll('.dashboard-nav-link');
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-section') === section) {
                    link.classList.add('active');
                }
            });
            
            // Load section-specific data
            switch (section) {
                case 'overview':
                    updateCustomerStats();
                    loadCustomerRecentActivity();
                    break;
                case 'products':
                    loadCustomerProducts();
                    break;
                case 'cart':
                    loadCustomerCart();
                    break;
                case 'orders':
                    loadCustomerOrders('all');
                    break;
                case 'tracking':
                    loadCustomerTracking();
                    break;
                case 'profile':
                    loadCustomerProfile();
                    break;
                case 'sellerOverview':
                    updateSellerStats();
                    loadSellerRecentOrders();
                    break;
                case 'sellerProducts':
                    loadSellerProducts();
                    break;
                case 'addProduct':
                    // Reset form
                    document.getElementById('addProductForm').reset();
                    break;
                case 'sellerOrders':
                    loadSellerOrders();
                    break;
                case 'sellerAnalytics':
                    loadSellerAnalytics();
                    break;
                case 'sellerProfile':
                    loadSellerProfile();
                    break;
                case 'riderOverview':
                    updateRiderStats();
                    loadRiderRecentDeliveries();
                    break;
                case 'availableDeliveries':
                    loadAvailableDeliveries();
                    break;
                case 'myDeliveries':
                    loadMyDeliveries();
                    break;
                case 'riderEarnings':
                    loadRiderEarnings();
                    break;
                case 'riderProfile':
                    loadRiderProfile();
                    break;
            }
        }

        // Load customer data
        async function loadCustomerData() {
            await updateCustomerStats();
            await loadCustomerProducts();
            await loadCustomerRecentActivity();
        }

        // Update customer stats
        async function updateCustomerStats() {
            try {
                // Get customer orders
                const { data: orders, error } = await supabase
                    .from('orders')
                    .select('*')
                    .eq('customer_id', currentUser.id);
                
                if (error) throw error;
                
                const pendingOrders = orders ? orders.filter(order => order.status === 'pending' || order.status === 'accepted').length : 0;
                const deliveredOrders = orders ? orders.filter(order => order.status === 'delivered').length : 0;
                
                // Get cart items count
                const { data: cartItems, error: cartError } = await supabase
                    .from('cart_items')
                    .select('*')
                    .eq('user_id', currentUser.id);
                
                if (cartError) throw cartError;
                
                elements.customerTotalOrders.textContent = orders ? orders.length : 0;
                elements.customerPendingOrders.textContent = pendingOrders;
                elements.customerDeliveredOrders.textContent = deliveredOrders;
                elements.customerCartItemsCount.textContent = cartItems ? cartItems.length : 0;
            } catch (error) {
                console.error('Error updating customer stats:', error);
            }
        }

        // Load customer recent activity
        async function loadCustomerRecentActivity() {
            try {
                const { data: orders, error } = await supabase
                    .from('orders')
                    .select('*')
                    .eq('customer_id', currentUser.id)
                    .order('created_at', { ascending: false })
                    .limit(3);
                
                if (error) throw error;
                
                elements.customerRecentActivity.innerHTML = '';
                
                if (!orders || orders.length === 0) {
                    elements.customerRecentActivity.innerHTML = `
                        <div class="empty-state" style="padding: 20px;">
                            <i class="fas fa-history"></i>
                            <p>No recent activity</p>
                        </div>
                    `;
                    return;
                }
                
                orders.forEach(order => {
                    let icon = 'fas fa-shopping-cart';
                    let title = 'Order Placed';
                    let description = `Your order #${order.id.substring(0, 8)} has been placed`;
                    
                    if (order.status === 'delivered') {
                        icon = 'fas fa-check-circle';
                        title = 'Order Delivered';
                        description = `Your order #${order.id.substring(0, 8)} has been delivered`;
                    } else if (order.status === 'accepted' || order.status === 'picked_up') {
                        icon = 'fas fa-truck';
                        title = 'Out for Delivery';
                        description = `Your order #${order.id.substring(0, 8)} is on the way`;
                    }
                    
                    const activityItem = document.createElement('div');
                    activityItem.className = 'timeline-item';
                    activityItem.innerHTML = `
                        <div class="timeline-icon">
                            <i class="${icon}"></i>
                        </div>
                        <div class="timeline-content">
                            <h4>${title}</h4>
                            <p>${description}</p>
                            <div class="timeline-time">${formatTimeAgo(order.created_at)}</div>
                        </div>
                    `;
                    
                    elements.customerRecentActivity.appendChild(activityItem);
                });
            } catch (error) {
                console.error('Error loading customer recent activity:', error);
            }
        }

        // Format time ago
        function formatTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins} minutes ago`;
            if (diffHours < 24) return `${diffHours} hours ago`;
            if (diffDays < 7) return `${diffDays} days ago`;
            
            return date.toLocaleDateString();
        }

        // Load customer products
        async function loadCustomerProducts() {
            try {
                const { data: products, error } = await supabase
                    .from('products')
                    .select('*')
                    .gt('stock', 0);
                
                if (error) throw error;
                
                elements.customerProductsGrid.innerHTML = '';
                
                if (!products || products.length === 0) {
                    elements.customerProductsGrid.innerHTML = `
                        <div class="empty-state" style="grid-column: 1 / -1;">
                            <i class="fas fa-box-open"></i>
                            <h3>No Products Available</h3>
                            <p>Check back later for new products.</p>
                        </div>
                    `;
                    return;
                }
                
                products.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';
                    
                    // Determine stock status
                    let stockStatus = 'stock-high';
                    let stockText = 'In Stock';
                    if (product.stock < 5) {
                        stockStatus = 'stock-low';
                        stockText = 'Low Stock';
                    } else if (product.stock < 15) {
                        stockStatus = 'stock-medium';
                        stockText = 'Limited Stock';
                    }
                    
                    productCard.innerHTML = `
                        <div class="product-image" style="background-image: url('${product.image_url || 'https://images.unsplash.com/photo-1542838132-92c53300491e?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'}')">
                            <div style="position: relative; z-index: 2; text-align: center;">
                                <i class="fas fa-box" style="font-size: 48px; margin-bottom: 10px;"></i>
                                <div>${product.category}</div>
                            </div>
                            <div class="product-badge">${stockText}</div>
                        </div>
                        <div class="product-info">
                            <h4>${product.name}</h4>
                            <p>${product.description}</p>
                            <div class="product-rating">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i>
                                <span>(24)</span>
                            </div>
                            <div class="product-price">KSh ${product.price.toLocaleString()}</div>
                            <div class="product-stock ${stockStatus}">${product.stock} items available</div>
                            <div class="customer-product-actions" style="margin-top: 15px;">
                                <button class="btn btn-primary btn-sm add-to-cart-btn" data-product-id="${product.id}">
                                    <i class="fas fa-cart-plus"></i> Add to Cart
                                </button>
                            </div>
                        </div>
                    `;
                    
                    elements.customerProductsGrid.appendChild(productCard);
                });
                
                // Add event listeners to add to cart buttons
                document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const productId = this.getAttribute('data-product-id');
                        addToCart(productId);
                    });
                });
            } catch (error) {
                console.error('Error loading customer products:', error);
                showNotification('Error', 'Failed to load products', 'error');
            }
        }

        // Filter products
        async function filterProducts() {
            try {
                const searchTerm = elements.productSearch.value.toLowerCase();
                const category = elements.categoryFilter.value;
                const sort = elements.sortFilter.value;
                
                let query = supabase
                    .from('products')
                    .select('*')
                    .gt('stock', 0);
                
                // Apply search filter
                if (searchTerm) {
                    query = query.or(`name.ilike.%${searchTerm}%,description.ilike.%${searchTerm}%`);
                }
                
                // Apply category filter
                if (category) {
                    query = query.eq('category', category);
                }
                
                // Apply sorting
                if (sort === 'price-low') {
                    query = query.order('price', { ascending: true });
                } else if (sort === 'price-high') {
                    query = query.order('price', { ascending: false });
                } else if (sort === 'name') {
                    query = query.order('name', { ascending: true });
                } else {
                    query = query.order('created_at', { ascending: false });
                }
                
                const { data: products, error } = await query;
                
                if (error) throw error;
                
                elements.customerProductsGrid.innerHTML = '';
                
                if (!products || products.length === 0) {
                    elements.customerProductsGrid.innerHTML = `
                        <div class="empty-state" style="grid-column: 1 / -1;">
                            <i class="fas fa-search"></i>
                            <h3>No Products Found</h3>
                            <p>Try adjusting your search criteria.</p>
                        </div>
                    `;
                    return;
                }
                
                products.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';
                    
                    // Determine stock status
                    let stockStatus = 'stock-high';
                    let stockText = 'In Stock';
                    if (product.stock < 5) {
                        stockStatus = 'stock-low';
                        stockText = 'Low Stock';
                    } else if (product.stock < 15) {
                        stockStatus = 'stock-medium';
                        stockText = 'Limited Stock';
                    }
                    
                    productCard.innerHTML = `
                        <div class="product-image" style="background-image: url('${product.image_url || 'https://images.unsplash.com/photo-1542838132-92c53300491e?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'}')">
                            <div style="position: relative; z-index: 2; text-align: center;">
                                <i class="fas fa-box" style="font-size: 48px; margin-bottom: 10px;"></i>
                                <div>${product.category}</div>
                            </div>
                            <div class="product-badge">${stockText}</div>
                        </div>
                        <div class="product-info">
                            <h4>${product.name}</h4>
                            <p>${product.description}</p>
                            <div class="product-rating">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i>
                                <span>(24)</span>
                            </div>
                            <div class="product-price">KSh ${product.price.toLocaleString()}</div>
                            <div class="product-stock ${stockStatus}">${product.stock} items available</div>
                            <div class="customer-product-actions" style="margin-top: 15px;">
                                <button class="btn btn-primary btn-sm add-to-cart-btn" data-product-id="${product.id}">
                                    <i class="fas fa-cart-plus"></i> Add to Cart
                                </button>
                            </div>
                        </div>
                    `;
                    
                    elements.customerProductsGrid.appendChild(productCard);
                });
                
                // Add event listeners to add to cart buttons
                document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const productId = this.getAttribute('data-product-id');
                        addToCart(productId);
                    });
                });
            } catch (error) {
                console.error('Error filtering products:', error);
            }
        }

        // Load customer cart
        async function loadCustomerCart() {
            try {
                const { data: cartItems, error } = await supabase
                    .from('cart_items')
                    .select(`
                        *,
                        products (*)
                    `)
                    .eq('user_id', currentUser.id);
                
                if (error) throw error;
                
                elements.customerCartItems.innerHTML = '';
                
                if (!cartItems || cartItems.length === 0) {
                    elements.customerCartItems.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-shopping-cart"></i>
                            <h3>Your Cart is Empty</h3>
                            <p>Add some products to your cart to get started.</p>
                            <button class="btn btn-primary" style="margin-top: 20px;" onclick="switchDashboardSection('products')">
                                <i class="fas fa-shopping-bag"></i> Browse Products
                            </button>
                        </div>
                    `;
                    elements.customerCartSummary.innerHTML = '';
                    return;
                }
                
                let total = 0;
                
                cartItems.forEach(item => {
                    const product = item.products;
                    const itemTotal = product.price * item.quantity;
                    total += itemTotal;
                    
                    const cartItem = document.createElement('div');
                    cartItem.className = 'cart-item';
                    cartItem.innerHTML = `
                        <div class="cart-item-info">
                            <h4>${product.name}</h4>
                            <p>KSh ${product.price.toLocaleString()} each</p>
                        </div>
                        <div class="cart-item-actions">
                            <div class="quantity-controls">
                                <button class="quantity-btn decrease-quantity" data-cart-item-id="${item.id}">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <span style="margin: 0 10px; font-weight: bold;">${item.quantity}</span>
                                <button class="quantity-btn increase-quantity" data-cart-item-id="${item.id}">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <button class="btn btn-outline btn-sm remove-from-cart" data-cart-item-id="${item.id}" style="margin-left: 15px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="cart-item-total">
                            <strong>KSh ${itemTotal.toLocaleString()}</strong>
                        </div>
                    `;
                    
                    elements.customerCartItems.appendChild(cartItem);
                });
                
                // Add event listeners to cart controls
                document.querySelectorAll('.decrease-quantity').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const cartItemId = this.getAttribute('data-cart-item-id');
                        updateCartQuantity(cartItemId, -1);
                    });
                });
                
                document.querySelectorAll('.increase-quantity').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const cartItemId = this.getAttribute('data-cart-item-id');
                        updateCartQuantity(cartItemId, 1);
                    });
                });
                
                document.querySelectorAll('.remove-from-cart').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const cartItemId = this.getAttribute('data-cart-item-id');
                        removeFromCart(cartItemId);
                    });
                });
                
                // Update cart summary
                const deliveryFee = 150;
                const grandTotal = total + deliveryFee;
                
                elements.customerCartSummary.innerHTML = `
                    <div class="order-total" style="text-align: right; padding: 20px; background: var(--glass); border-radius: 15px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Subtotal:</span>
                            <span>KSh ${total.toLocaleString()}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Delivery Fee:</span>
                            <span>KSh ${deliveryFee.toLocaleString()}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: bold; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 10px;">
                            <span>Total:</span>
                            <span>KSh ${grandTotal.toLocaleString()}</span>
                        </div>
                    </div>
                    <button class="btn btn-primary btn-large" id="checkoutBtn" style="width: 100%;">
                        <i class="fas fa-lock"></i> Proceed to Checkout
                    </button>
                `;
                
                // Add checkout event listener
                document.getElementById('checkoutBtn').addEventListener('click', handleCheckout);
            } catch (error) {
                console.error('Error loading customer cart:', error);
                showNotification('Error', 'Failed to load cart', 'error');
            }
        }

        // Load customer orders
        async function loadCustomerOrders(filter = 'all') {
            try {
                let query = supabase
                    .from('orders')
                    .select('*')
                    .eq('customer_id', currentUser.id)
                    .order('created_at', { ascending: false });
                
                // Apply filter
                if (filter !== 'all') {
                    query = query.eq('status', filter);
                }
                
                const { data: orders, error } = await query;
                
                if (error) throw error;
                
                elements.customerOrdersList.innerHTML = '';
                
                if (!orders || orders.length === 0) {
                    elements.customerOrdersList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-clipboard-list"></i>
                            <h3>No Orders Yet</h3>
                            <p>Your orders will appear here once you place them.</p>
                            <button class="btn btn-primary" style="margin-top: 20px;" onclick="switchDashboardSection('products')">
                                <i class="fas fa-shopping-bag"></i> Browse Products
                            </button>
                        </div>
                    `;
                    return;
                }
                
                // Get order items for each order
                for (const order of orders) {
                    const { data: orderItems, error: itemsError } = await supabase
                        .from('order_items')
                        .select(`
                            *,
                            products (*)
                        `)
                        .eq('order_id', order.id);
                    
                    if (itemsError) throw itemsError;
                    
                    // Calculate order total
                    let orderTotal = 0;
                    if (orderItems) {
                        orderItems.forEach(item => {
                            orderTotal += item.price * item.quantity;
                        });
                    }
                    
                    const orderCard = document.createElement('div');
                    orderCard.className = 'order-card';
                    orderCard.innerHTML = `
                        <div class="order-card-header">
                            <div>
                                <h4>Order #${order.id.substring(0, 8)}</h4>
                                <p>Placed on ${new Date(order.created_at).toLocaleDateString()}</p>
                            </div>
                            <span class="delivery-status status-${order.status}">${order.status}</span>
                        </div>
                        <div class="order-items">
                            ${orderItems ? orderItems.map(item => `
                                <div class="order-item">
                                    <div>${item.products.name} x${item.quantity}</div>
                                    <div>KSh ${(item.price * item.quantity).toLocaleString()}</div>
                                </div>
                            `).join('') : ''}
                            <div class="order-item">
                                <div>Delivery Fee</div>
                                <div>KSh 150</div>
                            </div>
                            <div class="order-item" style="border-top: 1px solid rgba(255,255,255,0.2); padding-top: 10px;">
                                <div><strong>Total</strong></div>
                                <div><strong>KSh ${(orderTotal + 150).toLocaleString()}</strong></div>
                            </div>
                        </div>
                        <div class="order-card-actions">
                            <button class="btn btn-outline btn-sm view-order-details" data-order-id="${order.id}">
                                <i class="fas fa-eye"></i> View Details
                            </button>
                            ${order.status === 'delivered' ? `
                            <button class="btn btn-primary btn-sm reorder-btn" data-order-id="${order.id}">
                                <i class="fas fa-redo"></i> Reorder
                            </button>
                            ` : ''}
                        </div>
                    `;
                    
                    elements.customerOrdersList.appendChild(orderCard);
                }
                
                // Add event listeners to order actions
                document.querySelectorAll('.view-order-details').forEach(button => {
                    button.addEventListener('click', function() {
                        const orderId = this.getAttribute('data-order-id');
                        viewOrderDetails(orderId);
                    });
                });
                
                document.querySelectorAll('.reorder-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const orderId = this.getAttribute('data-order-id');
                        reorderItems(orderId);
                    });
                });
            } catch (error) {
                console.error('Error loading customer orders:', error);
                showNotification('Error', 'Failed to load orders', 'error');
            }
        }

        // Load customer tracking
        async function loadCustomerTracking() {
            try {
                // Get active orders with deliveries
                const { data: orders, error } = await supabase
                    .from('orders')
                    .select(`
                        *,
                        deliveries (*)
                    `)
                    .eq('customer_id', currentUser.id)
                    .in('status', ['accepted', 'picked_up', 'in_transit'])
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                elements.activeDeliveryTracking.innerHTML = '';
                
                if (!orders || orders.length === 0) {
                    elements.activeDeliveryTracking.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-truck"></i>
                            <h3>No Active Deliveries</h3>
                            <p>You don't have any active deliveries at the moment.</p>
                        </div>
                    `;
                    return;
                }
                
                // Set up real-time tracking for active deliveries
                setupDeliveryTracking(orders);
                
                orders.forEach(order => {
                    const delivery = order.deliveries && order.deliveries.length > 0 ? order.deliveries[0] : null;
                    
                    if (delivery) {
                        const trackingCard = document.createElement('div');
                        trackingCard.className = 'order-card';
                        trackingCard.innerHTML = `
                            <div class="order-card-header">
                                <h4>Order #${order.id.substring(0, 8)}</h4>
                                <span class="delivery-status status-${delivery.status}">${delivery.status}</span>
                            </div>
                            <p>Estimated delivery: ${calculateETA(delivery)}</p>
                            
                            <div class="tracking-progress">
                                <div class="progress-step ${delivery.status === 'pending' || delivery.status === 'accepted' || delivery.status === 'picked_up' || delivery.status === 'in_transit' || delivery.status === 'delivered' ? 'completed' : ''}">
                                    <div class="step-icon">ðŸ“¦</div>
                                    <div class="step-label">Order Received</div>
                                </div>
                                <div class="progress-step ${delivery.status === 'accepted' || delivery.status === 'picked_up' || delivery.status === 'in_transit' || delivery.status === 'delivered' ? 'completed' : ''}">
                                    <div class="step-icon">ðŸš´</div>
                                    <div class="step-label">Rider Assigned</div>
                                </div>
                                <div class="progress-step ${delivery.status === 'picked_up' || delivery.status === 'in_transit' || delivery.status === 'delivered' ? 'completed' : ''}">
                                    <div class="step-icon">ðŸ“±</div>
                                    <div class="step-label">Picked Up</div>
                                </div>
                                <div class="progress-step ${delivery.status === 'in_transit' || delivery.status === 'delivered' ? 'active' : ''} ${delivery.status === 'delivered' ? 'completed' : ''}">
                                    <div class="step-icon">ðŸšš</div>
                                    <div class="step-label">On the Way</div>
                                </div>
                                <div class="progress-step ${delivery.status === 'delivered' ? 'completed' : ''}">
                                    <div class="step-icon">âœ…</div>
                                    <div class="step-label">Delivered</div>
                                </div>
                            </div>
                            
                            <div class="delivery-info">
                                <div class="delivery-info-item">
                                    <div class="delivery-info-icon">
                                        <i class="fas fa-store"></i>
                                    </div>
                                    <div>
                                        <strong>Pickup Location</strong>
                                        <p>${delivery.pickup_address || 'N/A'}</p>
                                    </div>
                                </div>
                                <div class="delivery-info-item">
                                    <div class="delivery-info-icon">
                                        <i class="fas fa-home"></i>
                                    </div>
                                    <div>
                                        <strong>Delivery Address</strong>
                                        <p>${delivery.delivery_address || 'N/A'}</p>
                                    </div>
                                </div>
                            </div>
                            
                            ${delivery.rider_id ? `
                            <div class="rider-info" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; margin: 15px 0;">
                                <h4 style="margin-bottom: 10px;">Your Rider</h4>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div class="user-avatar" style="width: 40px; height: 40px; font-size: 14px;" id="riderAvatar-${delivery.id}">R</div>
                                    <div>
                                        <div id="riderName-${delivery.id}">Loading...</div>
                                        <div style="font-size: 12px; opacity: 0.7;">Contact: <span id="riderPhone-${delivery.id}">Loading...</span></div>
                                    </div>
                                </div>
                            </div>
                            ` : ''}
                            
                            <div class="order-card-actions">
                                <button class="btn btn-primary btn-sm contact-rider-btn" data-delivery-id="${delivery.id}">
                                    <i class="fas fa-phone"></i> Contact Rider
                                </button>
                                <button class="btn btn-outline btn-sm track-on-map-btn" data-delivery-id="${delivery.id}">
                                    <i class="fas fa-map-marker-alt"></i> Track on Map
                                </button>
                            </div>
                        `;
                        
                        elements.activeDeliveryTracking.appendChild(trackingCard);
                        
                        // Load rider information if available
                        if (delivery.rider_id) {
                            loadRiderInfo(delivery.rider_id, delivery.id);
                        }
                    }
                });
                
                // Add event listeners to tracking actions
                document.querySelectorAll('.contact-rider-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const deliveryId = this.getAttribute('data-delivery-id');
                        contactRider(deliveryId);
                    });
                });
                
                document.querySelectorAll('.track-on-map-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const deliveryId = this.getAttribute('data-delivery-id');
                        trackOnMap(deliveryId);
                    });
                });
            } catch (error) {
                console.error('Error loading customer tracking:', error);
                showNotification('Error', 'Failed to load tracking information', 'error');
            }
        }

        // Setup delivery tracking with real-time updates
        function setupDeliveryTracking(orders) {
            // Unsubscribe from previous subscriptions
            if (deliverySubscription) {
                supabase.removeChannel(deliverySubscription);
            }
            
            // Subscribe to delivery updates
            deliverySubscription = supabase
                .channel('delivery-updates')
                .on(
                    'postgres_changes',
                    {
                        event: '*',
                        schema: 'public',
                        table: 'deliveries'
                    },
                    (payload) => {
                        // Check if this delivery is for one of the user's orders
                        const affectedOrder = orders.find(order => 
                            order.deliveries && order.deliveries.some(d => d.id === payload.new.id)
                        );
                        
                        if (affectedOrder) {
                            // Refresh the tracking view
                            loadCustomerTracking();
                            showNotification('Delivery Update', `Your delivery status has been updated to: ${payload.new.status}`, 'info');
                        }
                    }
                )
                .subscribe();
        }

        // Load rider information
        async function loadRiderInfo(riderId, deliveryId) {
            try {
                const { data: rider, error } = await supabase
                    .from('profiles')
                    .select('name, phone, avatar_url')
                    .eq('id', riderId)
                    .single();
                
                if (error) throw error;
                
                const riderAvatar = document.getElementById(`riderAvatar-${deliveryId}`);
                const riderName = document.getElementById(`riderName-${deliveryId}`);
                const riderPhone = document.getElementById(`riderPhone-${deliveryId}`);
                
                if (riderAvatar && riderName && riderPhone) {
                    updateUserAvatar(riderAvatar, rider.avatar_url, rider.name);
                    riderName.textContent = rider.name;
                    riderPhone.textContent = rider.phone || 'N/A';
                }
            } catch (error) {
                console.error('Error loading rider info:', error);
            }
        }

        // Calculate ETA for delivery
        function calculateETA(delivery) {
            if (delivery.status === 'delivered') {
                return 'Delivered';
            }
            
            // Simple ETA calculation based on status
            const now = new Date();
            const deliveryTime = new Date(now);
            
            if (delivery.status === 'accepted') {
                deliveryTime.setMinutes(deliveryTime.getMinutes() + 30); // 30 minutes after acceptance
            } else if (delivery.status === 'picked_up') {
                deliveryTime.setMinutes(deliveryTime.getMinutes() + 20); // 20 minutes after pickup
            } else if (delivery.status === 'in_transit') {
                deliveryTime.setMinutes(deliveryTime.getMinutes() + 10); // 10 minutes if in transit
            } else {
                return 'Calculating...';
            }
            
            return deliveryTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        // Contact rider
        function contactRider(deliveryId) {
            // In a real app, this would initiate a call or chat with the rider
            showNotification('Info', 'This would initiate contact with your delivery rider', 'info');
        }

        // Track on map
        function trackOnMap(deliveryId) {
            // In a real app, this would show the rider's location on a map
            showNotification('Info', 'This would show real-time tracking on a map', 'info');
        }

        // View order details
        async function viewOrderDetails(orderId) {
            try {
                // Get order details
                const { data: order, error } = await supabase
                    .from('orders')
                    .select(`
                        *,
                        order_items (
                            *,
                            products (*)
                        ),
                        deliveries (*)
                    `)
                    .eq('id', orderId)
                    .single();
                
                if (error) throw error;
                
                // Show order details in a modal or detailed view
                let orderDetails = `Order #${order.id.substring(0, 8)}\n\n`;
                orderDetails += `Status: ${order.status}\n`;
                orderDetails += `Order Date: ${new Date(order.created_at).toLocaleDateString()}\n\n`;
                orderDetails += 'Items:\n';
                
                if (order.order_items) {
                    order.order_items.forEach(item => {
                        orderDetails += `- ${item.products.name} x${item.quantity} - KSh ${(item.price * item.quantity).toLocaleString()}\n`;
                    });
                }
                
                orderDetails += `\nTotal: KSh ${order.total.toLocaleString()}`;
                
                if (order.deliveries && order.deliveries.length > 0) {
                    const delivery = order.deliveries[0];
                    orderDetails += `\n\nDelivery Information:\n`;
                    orderDetails += `Status: ${delivery.status}\n`;
                    orderDetails += `Pickup: ${delivery.pickup_address || 'N/A'}\n`;
                    orderDetails += `Delivery: ${delivery.delivery_address || 'N/A'}\n`;
                    
                    if (delivery.rider_id) {
                        // Get rider info
                        const { data: rider } = await supabase
                            .from('profiles')
                            .select('name, phone')
                            .eq('id', delivery.rider_id)
                            .single();
                        
                        if (rider) {
                            orderDetails += `Rider: ${rider.name} (${rider.phone || 'N/A'})`;
                        }
                    }
                }
                
                alert(orderDetails);
            } catch (error) {
                console.error('Error viewing order details:', error);
                showNotification('Error', 'Failed to load order details', 'error');
            }
        }

        // Reorder items
        async function reorderItems(orderId) {
            try {
                // Get order items
                const { data: orderItems, error } = await supabase
                    .from('order_items')
                    .select(`
                        *,
                        products (*)
                    `)
                    .eq('order_id', orderId);
                
                if (error) throw error;
                
                // Add items to cart
                for (const item of orderItems) {
                    await addToCart(item.product_id, item.quantity);
                }
                
                showNotification('Success', 'Items added to cart!', 'success');
                switchDashboardSection('cart');
            } catch (error) {
                console.error('Error reordering items:', error);
                showNotification('Error', 'Failed to reorder items', 'error');
            }
        }

        // Load customer profile
        async function loadCustomerProfile() {
            try {
                const { data: profile, error } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();
                
                if (error) throw error;
                
                document.getElementById('customerProfileName').value = profile.name || '';
                document.getElementById('customerProfileEmail').value = currentUser.email;
                document.getElementById('customerProfilePhone').value = profile.phone || '';
                document.getElementById('customerProfileAddress').value = profile.address || '';
                document.getElementById('deliveryInstructions').value = profile.delivery_instructions || '';
                document.getElementById('preferredTime').value = profile.preferred_delivery_time || 'any';
                
                // Update avatar if exists
                updateUserAvatar(elements.customerAvatar, profile.avatar_url, profile.name || currentUser.email);
            } catch (error) {
                console.error('Error loading customer profile:', error);
            }
        }

        // Save customer profile
        async function saveCustomerProfile() {
            const name = document.getElementById('customerProfileName').value;
            const phone = document.getElementById('customerProfilePhone').value;
            const address = document.getElementById('customerProfileAddress').value;
            
            try {
                const { data, error } = await supabase
                    .from('profiles')
                    .update({
                        name,
                        phone,
                        address
                    })
                    .eq('id', currentUser.id)
                    .select()
                    .single();
                
                if (error) throw error;
                
                elements.customerName.textContent = name;
                elements.customerWelcomeName.textContent = name;
                updateUserAvatar(elements.customerAvatar, data.avatar_url, name);
                
                showNotification('Success', 'Profile updated successfully!', 'success');
            } catch (error) {
                showNotification('Error', 'Failed to update profile: ' + error.message, 'error');
            }
        }

        // Update customer preferences
        async function updateCustomerPreferences() {
            const instructions = document.getElementById('deliveryInstructions').value;
            const preferredTime = document.getElementById('preferredTime').value;
            
            try {
                const { data, error } = await supabase
                    .from('profiles')
                    .update({
                        delivery_instructions: instructions,
                        preferred_delivery_time: preferredTime
                    })
                    .eq('id', currentUser.id)
                    .select()
                    .single();
                
                if (error) throw error;
                
                showNotification('Success', 'Delivery preferences updated successfully!', 'success');
            } catch (error) {
                showNotification('Error', 'Failed to update preferences: ' + error.message, 'error');
            }
        }

        // Handle customer photo upload
        async function handleCustomerPhotoUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            await uploadUserPhoto(file, 'customer');
        }

        // Upload user photo
        async function uploadUserPhoto(file, userType) {
            try {
                showLoading();
                
                // Upload file to Supabase Storage
                const fileExt = file.name.split('.').pop();
                const fileName = `${currentUser.id}-${Math.random()}.${fileExt}`;
                const filePath = `${userType}-photos/${fileName}`;
                
                const { error: uploadError } = await supabase.storage
                    .from('avatars')
                    .upload(filePath, file);
                
                if (uploadError) throw uploadError;
                
                // Get public URL
                const { data: { publicUrl } } = supabase.storage
                    .from('avatars')
                    .getPublicUrl(filePath);
                
                // Update user profile with photo URL
                const { data, error } = await supabase
                    .from('profiles')
                    .update({ avatar_url: publicUrl })
                    .eq('id', currentUser.id)
                    .select()
                    .single();
                
                if (error) throw error;
                
                // Update avatar in UI
                const avatarElement = userType === 'customer' ? elements.customerAvatar : 
                                    userType === 'seller' ? elements.sellerAvatar : elements.riderAvatar;
                
                updateUserAvatar(avatarElement, publicUrl, data.name || currentUser.email);
                
                hideLoading();
                showNotification('Success', 'Profile photo updated successfully!', 'success');
            } catch (error) {
                hideLoading();
                showNotification('Error', 'Failed to upload photo: ' + error.message, 'error');
            }
        }

        // Add to cart
        async function addToCart(productId, quantity = 1) {
            try {
                // Check if product exists
                const { data: product, error: productError } = await supabase
                    .from('products')
                    .select('name, price, stock')
                    .eq('id', productId)
                    .single();

                if (productError) throw productError;

                if (product.stock < quantity) {
                    showNotification('Error', 'Product is out of stock!', 'error');
                    return;
                }

                // Check if product is already in cart
                const { data: existingItem, error: checkError } = await supabase
                    .from('cart_items')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .eq('product_id', productId)
                    .single();

                if (checkError && checkError.code !== 'PGRST116') {
                    throw checkError;
                }

                if (existingItem) {
                    // Update quantity
                    const newQuantity = existingItem.quantity + quantity;
                    const { error } = await supabase
                        .from('cart_items')
                        .update({ quantity: newQuantity })
                        .eq('id', existingItem.id);

                    if (error) throw error;
                } else {
                    // Insert new item
                    const { error } = await supabase
                        .from('cart_items')
                        .insert([
                            {
                                user_id: currentUser.id,
                                product_id: productId,
                                quantity: quantity
                            }
                        ]);

                    if (error) throw error;
                }

                updateCustomerStats();
                showNotification('Success', `${product.name} added to cart!`, 'success');
            } catch (error) {
                showNotification('Error', 'Failed to add to cart: ' + error.message, 'error');
            }
        }

        // Update cart quantity
        async function updateCartQuantity(cartItemId, change) {
            try {
                const { data: cartItem, error } = await supabase
                    .from('cart_items')
                    .select('quantity')
                    .eq('id', cartItemId)
                    .single();
                
                if (error) throw error;
                
                const newQuantity = cartItem.quantity + change;
                
                if (newQuantity <= 0) {
                    await removeFromCart(cartItemId);
                } else {
                    const { error } = await supabase
                        .from('cart_items')
                        .update({ quantity: newQuantity })
                        .eq('id', cartItemId);
                    
                    if (error) throw error;
                }
                
                loadCustomerCart();
                updateCustomerStats();
            } catch (error) {
                showNotification('Error', 'Failed to update cart', 'error');
            }
        }

        // Remove from cart
        async function removeFromCart(cartItemId) {
            try {
                const { error } = await supabase
                    .from('cart_items')
                    .delete()
                    .eq('id', cartItemId);
                
                if (error) throw error;
                
                loadCustomerCart();
                updateCustomerStats();
                showNotification('Success', 'Item removed from cart', 'success');
            } catch (error) {
                showNotification('Error', 'Failed to remove item', 'error');
            }
        }

        // Handle checkout
        async function handleCheckout() {
            try {
                // Get cart items
                const { data: cartItems, error } = await supabase
                    .from('cart_items')
                    .select(`
                        *,
                        products (*)
                    `)
                    .eq('user_id', currentUser.id);
                
                if (error) throw error;
                
                if (!cartItems || cartItems.length === 0) {
                    showNotification('Error', 'Your cart is empty', 'error');
                    return;
                }
                
                // Calculate total
                let total = 0;
                cartItems.forEach(item => {
                    total += item.products.price * item.quantity;
                });
                
                // Get customer address
                const { data: profile } = await supabase
                    .from('profiles')
                    .select('address')
                    .eq('id', currentUser.id)
                    .single();
                
                // Create order
                const { data: order, error: orderError } = await supabase
                    .from('orders')
                    .insert([
                        {
                            customer_id: currentUser.id,
                            total: total,
                            status: 'pending',
                            delivery_address: profile?.address || 'Nairobi, Kenya'
                        }
                    ])
                    .select()
                    .single();
                
                if (orderError) throw orderError;
                
                // Create order items
                const orderItems = cartItems.map(item => ({
                    order_id: order.id,
                    product_id: item.product_id,
                    quantity: item.quantity,
                    price: item.products.price
                }));
                
                const { error: itemsError } = await supabase
                    .from('order_items')
                    .insert(orderItems);
                
                if (itemsError) throw itemsError;
                
                // Clear cart
                const { error: clearError } = await supabase
                    .from('cart_items')
                    .delete()
                    .eq('user_id', currentUser.id);
                
                if (clearError) throw clearError;
                
                // Update product stock
                for (const item of cartItems) {
                    const newStock = item.products.stock - item.quantity;
                    const { error: stockError } = await supabase
                        .from('products')
                        .update({ stock: newStock })
                        .eq('id', item.product_id);
                    
                    if (stockError) throw stockError;
                }
                
                // Create delivery record
                await createDelivery(order.id, profile?.address || 'Nairobi, Kenya');
                
                showNotification('Success', 'Order placed successfully!', 'success');
                loadCustomerCart();
                updateCustomerStats();
                switchDashboardSection('orders');
            } catch (error) {
                showNotification('Error', 'Failed to place order: ' + error.message, 'error');
            }
        }

        // Create delivery record
        async function createDelivery(orderId, deliveryAddress) {
            try {
                // Calculate delivery fee based on distance (simplified)
                const deliveryFee = 150; // Fixed fee for now
                
                const { data: delivery, error } = await supabase
                    .from('deliveries')
                    .insert([
                        {
                            order_id: orderId,
                            pickup_address: 'Central Warehouse, Nairobi', // This would come from seller in real app
                            delivery_address: deliveryAddress,
                            delivery_fee: deliveryFee,
                            status: 'pending'
                        }
                    ])
                    .select()
                    .single();
                
                if (error) throw error;
                
                return delivery;
            } catch (error) {
                console.error('Error creating delivery:', error);
                throw error;
            }
        }

        // Load seller data
        async function loadSellerData() {
            await updateSellerStats();
            await loadSellerProducts();
            await loadSellerRecentOrders();
        }

        // Update seller stats
        async function updateSellerStats() {
            try {
                // Get seller products
                const { data: products, error } = await supabase
                    .from('products')
                    .select('*')
                    .eq('seller_id', currentUser.id);
                
                if (error) throw error;
                
                // Get seller orders
                const { data: orders, error: ordersError } = await supabase
                    .from('orders')
                    .select(`
                        *,
                        order_items (
                            *,
                            products (
                                seller_id
                            )
                        )
                    `);
                
                if (ordersError) throw ordersError;
                
                // Filter orders for this seller
                const sellerOrders = orders ? orders.filter(order => 
                    order.order_items.some(item => item.products.seller_id === currentUser.id)
                ) : [];
                
                const pendingOrders = sellerOrders.filter(order => order.status === 'pending' || order.status === 'accepted').length;
                
                // Calculate low stock products
                const lowStock = products ? products.filter(product => product.stock < 10).length : 0;
                
                // Calculate revenue
                let totalRevenue = 0;
                let monthlyRevenue = 0;
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                
                sellerOrders.forEach(order => {
                    const orderDate = new Date(order.created_at);
                    if (orderDate.getMonth() === currentMonth && orderDate.getFullYear() === currentYear) {
                        monthlyRevenue += order.total;
                    }
                    totalRevenue += order.total;
                });
                
                const avgOrder = sellerOrders.length > 0 ? totalRevenue / sellerOrders.length : 0;
                const conversion = products && products.length > 0 ? (sellerOrders.length / products.length * 100).toFixed(1) : 0;
                
                elements.sellerTotalProducts.textContent = products ? products.length : 0;
                elements.sellerLowStock.textContent = lowStock;
                elements.sellerTotalOrders.textContent = sellerOrders.length;
                elements.sellerPendingOrders.textContent = pendingOrders;
                elements.sellerTotalRevenue.textContent = Math.round(totalRevenue).toLocaleString();
                elements.sellerMonthlyRevenue.textContent = Math.round(monthlyRevenue).toLocaleString();
                elements.sellerAvgOrder.textContent = Math.round(avgOrder).toLocaleString();
                elements.sellerConversion.textContent = conversion + '%';
            } catch (error) {
                console.error('Error updating seller stats:', error);
            }
        }

        // Load seller recent orders
        async function loadSellerRecentOrders() {
            try {
                const { data: orders, error } = await supabase
                    .from('orders')
                    .select(`
                        *,
                        order_items (
                            *,
                            products (
                                seller_id
                            )
                        )
                    `)
                    .order('created_at', { ascending: false })
                    .limit(3);
                
                if (error) throw error;
                
                // Filter orders for this seller
                const sellerOrders = orders ? orders.filter(order => 
                    order.order_items.some(item => item.products.seller_id === currentUser.id)
                ) : [];
                
                elements.sellerRecentOrders.innerHTML = '';
                
                if (sellerOrders.length === 0) {
                    elements.sellerRecentOrders.innerHTML = `
                        <div class="empty-state" style="padding: 20px;">
                            <i class="fas fa-clipboard-list"></i>
                            <p>No recent orders</p>
                        </div>
                    `;
                    return;
                }
                
                sellerOrders.forEach(order => {
                    let icon = 'fas fa-shopping-cart';
                    let title = 'New Order';
                    let description = `Order #${order.id.substring(0, 8)} received`;
                    
                    if (order.status === 'delivered') {
                        icon = 'fas fa-check-circle';
                        title = 'Order Delivered';
                        description = `Order #${order.id.substring(0, 8)} delivered`;
                    } else if (order.status === 'accepted' || order.status === 'picked_up') {
                        icon = 'fas fa-truck';
                        title = 'Order in Transit';
                        description = `Order #${order.id.substring(0, 8)} is being delivered`;
                    }
                    
                    const activityItem = document.createElement('div');
                    activityItem.className = 'timeline-item';
                    activityItem.innerHTML = `
                        <div class="timeline-icon">
                            <i class="${icon}"></i>
                        </div>
                        <div class="timeline-content">
                            <h4>${title}</h4>
                            <p>${description}</p>
                            <div class="timeline-time">${formatTimeAgo(order.created_at)}</div>
                        </div>
                    `;
                    
                    elements.sellerRecentOrders.appendChild(activityItem);
                });
            } catch (error) {
                console.error('Error loading seller recent orders:', error);
            }
        }

        // Load seller products
        async function loadSellerProducts() {
            try {
                const { data: products, error } = await supabase
                    .from('products')
                    .select('*')
                    .eq('seller_id', currentUser.id)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                elements.sellerProductsGrid.innerHTML = '';
                
                if (!products || products.length === 0) {
                    elements.sellerProductsGrid.innerHTML = `
                        <div class="empty-state" style="grid-column: 1 / -1;">
                            <i class="fas fa-box-open"></i>
                            <h3>No Products Yet</h3>
                            <p>Add your first product to start selling.</p>
                            <button class="btn btn-primary" style="margin-top: 20px;" onclick="switchDashboardSection('addProduct')">
                                <i class="fas fa-plus"></i> Add Product
                            </button>
                        </div>
                    `;
                    return;
                }
                
                products.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';
                    
                    // Determine stock status
                    let stockStatus = 'stock-high';
                    let stockText = 'In Stock';
                    if (product.stock < 5) {
                        stockStatus = 'stock-low';
                        stockText = 'Low Stock';
                    } else if (product.stock < 15) {
                        stockStatus = 'stock-medium';
                        stockText = 'Limited Stock';
                    }
                    
                    productCard.innerHTML = `
                        <div class="product-image" style="background-image: url('${product.image_url || 'https://images.unsplash.com/photo-1542838132-92c53300491e?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'}')">
                            <div style="position: relative; z-index: 2; text-align: center;">
                                <i class="fas fa-box" style="font-size: 48px; margin-bottom: 10px;"></i>
                                <div>${product.category}</div>
                            </div>
                            <div class="product-badge">${stockText}</div>
                        </div>
                        <div class="product-info">
                            <h4>${product.name}</h4>
                            <p>${product.description}</p>
                            <div class="product-price">KSh ${product.price.toLocaleString()}</div>
                            <div class="product-stock ${stockStatus}">${product.stock} items available</div>
                            <div class="seller-product-actions" style="margin-top: 15px; display: flex; gap: 10px;">
                                <button class="btn btn-outline btn-sm edit-product-btn" data-product-id="${product.id}">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-outline btn-sm delete-product-btn" data-product-id="${product.id}">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                    `;
                    
                    elements.sellerProductsGrid.appendChild(productCard);
                });
                
                // Add event listeners to product actions
                document.querySelectorAll('.edit-product-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const productId = this.getAttribute('data-product-id');
                        editProduct(productId);
                    });
                });
                
                document.querySelectorAll('.delete-product-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const productId = this.getAttribute('data-product-id');
                        deleteProduct(productId);
                    });
                });
            } catch (error) {
                console.error('Error loading seller products:', error);
                showNotification('Error', 'Failed to load products', 'error');
            }
        }

        // Handle add product
        async function handleAddProduct(e) {
            e.preventDefault();
            
            const name = document.getElementById('productName').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            const category = document.getElementById('productCategory').value;
            const stock = parseInt(document.getElementById('productStock').value);
            const description = document.getElementById('productDescription').value;
            
            if (!name || !price || !category || !stock || !description) {
                showNotification('Error', 'Please fill in all required fields', 'error');
                return;
            }
            
            if (price < 0) {
                showNotification('Error', 'Price must be a positive number', 'error');
                return;
            }
            
            if (stock < 0) {
                showNotification('Error', 'Stock must be a positive number', 'error');
                return;
            }
            
            showLoading();
            
            try {
                const productData = {
                    name,
                    price,
                    category,
                    stock,
                    description,
                    seller_id: currentUser.id
                };
                
                // Handle product image if uploaded
                const productImageFile = elements.productImageInput.files[0];
                if (productImageFile) {
                    const imageUrl = await uploadProductImage(productImageFile);
                    productData.image_url = imageUrl;
                }
                
                const { data, error } = await supabase
                    .from('products')
                    .insert([productData])
                    .select()
                    .single();
                
                if (error) throw error;
                
                hideLoading();
                showNotification('Success', 'Product added successfully!', 'success');
                document.getElementById('addProductForm').reset();
                loadSellerProducts();
                updateSellerStats();
                switchDashboardSection('sellerProducts');
            } catch (error) {
                hideLoading();
                showNotification('Error', 'Failed to add product: ' + error.message, 'error');
            }
        }

        // Upload product image
        async function uploadProductImage(file) {
            try {
                const fileExt = file.name.split('.').pop();
                const fileName = `${currentUser.id}-${Date.now()}.${fileExt}`;
                const filePath = `product-images/${fileName}`;
                
                const { error: uploadError } = await supabase.storage
                    .from('products')
                    .upload(filePath, file);
                
                if (uploadError) throw uploadError;
                
                const { data: { publicUrl } } = supabase.storage
                    .from('products')
                    .getPublicUrl(filePath);
                
                return publicUrl;
            } catch (error) {
                console.error('Error uploading product image:', error);
                throw error;
            }
        }

        // Handle product image upload
        async function handleProductImageUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            // Preview image
            const reader = new FileReader();
            reader.onload = function(e) {
                elements.productImageUpload.innerHTML = `
                    <img src="${e.target.result}" style="max-width: 100%; max-height: 200px; border-radius: 10px;">
                    <div class="upload-text">Click to change image</div>
                `;
            };
            reader.readAsDataURL(file);
        }

        // Edit product
        async function editProduct(productId) {
            // In a real app, you would show a modal with the product details to edit
            showNotification('Info', 'Edit functionality would open a form to modify the product', 'info');
        }

        // Delete product
        async function deleteProduct(productId) {
            if (!confirm('Are you sure you want to delete this product?')) {
                return;
            }
            
            showLoading();
            
            try {
                const { error } = await supabase
                    .from('products')
                    .delete()
                    .eq('id', productId)
                    .eq('seller_id', currentUser.id);
                
                if (error) throw error;
                
                hideLoading();
                showNotification('Success', 'Product deleted successfully!', 'success');
                loadSellerProducts();
                updateSellerStats();
            } catch (error) {
                hideLoading();
                showNotification('Error', 'Failed to delete product: ' + error.message, 'error');
            }
        }

        // Load seller orders
        async function loadSellerOrders() {
            try {
                const { data: orders, error } = await supabase
                    .from('orders')
                    .select(`
                        *,
                        order_items (
                            *,
                            products (
                                seller_id,
                                name
                            )
                        )
                    `)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                // Filter orders for this seller
                const sellerOrders = orders ? orders.filter(order => 
                    order.order_items.some(item => item.products.seller_id === currentUser.id)
                ) : [];
                
                elements.sellerOrdersList.innerHTML = '';
                
                if (sellerOrders.length === 0) {
                    elements.sellerOrdersList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-clipboard-list"></i>
                            <h3>No Orders Yet</h3>
                            <p>Orders from your products will appear here.</p>
                        </div>
                    `;
                    return;
                }
                
                sellerOrders.forEach(order => {
                    // Calculate total for this seller's products in the order
                    let sellerTotal = 0;
                    const sellerItems = order.order_items.filter(item => item.products.seller_id === currentUser.id);
                    
                    sellerItems.forEach(item => {
                        sellerTotal += item.price * item.quantity;
                    });
                    
                    const orderCard = document.createElement('div');
                    orderCard.className = 'order-card';
                    orderCard.innerHTML = `
                        <div class="order-card-header">
                            <div>
                                <h4>Order #${order.id.substring(0, 8)}</h4>
                                <p>Placed on ${new Date(order.created_at).toLocaleDateString()}</p>
                            </div>
                            <span class="delivery-status status-${order.status}">${order.status}</span>
                        </div>
                        <div class="order-items">
                            <div class="order-item">
                                <div>Your Products Total</div>
                                <div>KSh ${sellerTotal.toLocaleString()}</div>
                            </div>
                        </div>
                        <div class="order-card-actions">
                            <button class="btn btn-outline btn-sm view-order-details" data-order-id="${order.id}">
                                <i class="fas fa-eye"></i> View Details
                            </button>
                            <button class="btn btn-primary btn-sm update-order-status" data-order-id="${order.id}">
                                <i class="fas fa-truck"></i> Update Status
                            </button>
                        </div>
                    `;
                    
                    elements.sellerOrdersList.appendChild(orderCard);
                });
                
                // Add event listeners to order actions
                document.querySelectorAll('.view-order-details').forEach(button => {
                    button.addEventListener('click', function() {
                        const orderId = this.getAttribute('data-order-id');
                        viewSellerOrderDetails(orderId);
                    });
                });
                
                document.querySelectorAll('.update-order-status').forEach(button => {
                    button.addEventListener('click', function() {
                        const orderId = this.getAttribute('data-order-id');
                        updateOrderStatus(orderId);
                    });
                });
            } catch (error) {
                console.error('Error loading seller orders:', error);
                showNotification('Error', 'Failed to load orders', 'error');
            }
        }

        // View seller order details
        async function viewSellerOrderDetails(orderId) {
            try {
                // Get order details
                const { data: order, error } = await supabase
                    .from('orders')
                    .select(`
                        *,
                        order_items (
                            *,
                            products (*)
                        )
                    `)
                    .eq('id', orderId)
                    .single();
                
                if (error) throw error;
                
                // Filter items for this seller
                const sellerItems = order.order_items.filter(item => item.products.seller_id === currentUser.id);
                
                let orderDetails = `Order #${order.id.substring(0, 8)}\n\n`;
                orderDetails += `Status: ${order.status}\n`;
                orderDetails += `Order Date: ${new Date(order.created_at).toLocaleDateString()}\n\n`;
                orderDetails += 'Your Products:\n';
                
                sellerItems.forEach(item => {
                    orderDetails += `- ${item.products.name} x${item.quantity} - KSh ${(item.price * item.quantity).toLocaleString()}\n`;
                });
                
                const sellerTotal = sellerItems.reduce((total, item) => total + (item.price * item.quantity), 0);
                orderDetails += `\nYour Total: KSh ${sellerTotal.toLocaleString()}`;
                
                alert(orderDetails);
            } catch (error) {
                console.error('Error viewing order details:', error);
                showNotification('Error', 'Failed to load order details', 'error');
            }
        }

        // Update order status
        async function updateOrderStatus(orderId) {
            // In a real app, this would show a modal to update order status
            showNotification('Info', 'This would allow you to update the order status', 'info');
        }

        // Load seller analytics
        async function loadSellerAnalytics() {
            // This would typically load more detailed analytics data
            // For now, we'll just update the stats which are already loaded
            updateSellerStats();
        }

        // Load seller profile
        async function loadSellerProfile() {
            try {
                const { data: profile, error } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();
                
                if (error) throw error;
                
                document.getElementById('sellerProfileName').value = profile.name || '';
                document.getElementById('sellerProfileEmail').value = currentUser.email;
                document.getElementById('sellerProfilePhone').value = profile.phone || '';
                document.getElementById('sellerProfileAddress').value = profile.address || '';
                document.getElementById('sellerBusinessType').value = profile.business_type || '';
                
                // Update avatar if exists
                updateUserAvatar(elements.sellerAvatar, profile.avatar_url, profile.name || currentUser.email);
                
                // Load verification status
                loadSellerVerificationStatus(profile);
            } catch (error) {
                console.error('Error loading seller profile:', error);
            }
        }

        // Load seller verification status
        function loadSellerVerificationStatus(profile) {
            let statusHTML = '';
            
            if (profile.verification_status === 'approved') {
                statusHTML = `
                    <div class="verification-status verification-approved">
                        <i class="fas fa-check-circle"></i>
                        Verified Seller
                    </div>
                    <p style="margin-top: 10px; color: rgba(255,255,255,0.7);">Your account has been verified and is fully active.</p>
                `;
            } else if (profile.verification_status === 'pending') {
                statusHTML = `
                    <div class="verification-status verification-pending">
                        <i class="fas fa-clock"></i>
                        Verification Pending
                    </div>
                    <p style="margin-top: 10px; color: rgba(255,255,255,0.7);">Your verification is being reviewed. This usually takes 1-2 business days.</p>
                    
                    <div class="verification-steps">
                        <div class="verification-step ${profile.business_type ? 'completed' : ''}">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Business Information</h4>
                                <p>Provide your business details</p>
                            </div>
                        </div>
                        <div class="verification-step ${profile.business_document_url ? 'completed' : ''}">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Business Document</h4>
                                <p>Upload business registration document</p>
                            </div>
                        </div>
                        <div class="verification-step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Verification Review</h4>
                                <p>Our team will review your application</p>
                            </div>
                        </div>
                    </div>
                `;
            } else if (profile.verification_status === 'rejected') {
                statusHTML = `
                    <div class="verification-status verification-rejected">
                        <i class="fas fa-times-circle"></i>
                        Verification Rejected
                    </div>
                    <p style="margin-top: 10px; color: rgba(255,255,255,0.7);">Your verification was rejected. Please check your email for details.</p>
                    <button class="btn btn-primary" style="margin-top: 15px;">Reapply for Verification</button>
                `;
            } else {
                statusHTML = `
                    <div class="verification-status verification-pending">
                        <i class="fas fa-exclamation-circle"></i>
                        Not Verified
                    </div>
                    <p style="margin-top: 10px; color: rgba(255,255,255,0.7);">Complete your profile to apply for verification.</p>
                `;
            }
            
            elements.sellerVerificationStatus.innerHTML = statusHTML;
        }

        // Handle seller photo upload
        async function handleSellerPhotoUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            await uploadUserPhoto(file, 'seller');
        }

        // Handle business document upload
        async function handleBusinessDocUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            try {
                showLoading();
                
                // Upload file to Supabase Storage
                const fileExt = file.name.split('.').pop();
                const fileName = `${currentUser.id}-business-doc.${fileExt}`;
                const filePath = `business-docs/${fileName}`;
                
                const { error: uploadError } = await supabase.storage
                    .from('documents')
                    .upload(filePath, file);
                
                if (uploadError) throw uploadError;
                
                // Get public URL
                const { data: { publicUrl } } = supabase.storage
                    .from('documents')
                    .getPublicUrl(filePath);
                
                // Update user profile with document URL
                const { data, error } = await supabase
                    .from('profiles')
                    .update({ business_document_url: publicUrl })
                    .eq('id', currentUser.id)
                    .select()
                    .single();
                
                if (error) throw error;
                
                hideLoading();
                showNotification('Success', 'Business document uploaded successfully!', 'success');
                
                // Refresh verification status
                loadSellerVerificationStatus(data);
            } catch (error) {
                hideLoading();
                showNotification('Error', 'Failed to upload document: ' + error.message, 'error');
            }
        }

        // Save seller profile
        async function saveSellerProfile() {
            const name = document.getElementById('sellerProfileName').value;
            const phone = document.getElementById('sellerProfilePhone').value;
            const address = document.getElementById('sellerProfileAddress').value;
            const businessType = document.getElementById('sellerBusinessType').value;
            
            try {
                const profileData = {
                    name,
                    phone,
                    address,
                    business_type: businessType
                };
                
                // If this is the first time setting business type, set verification status to pending
                if (businessType && !profileData.verification_status) {
                    profileData.verification_status = 'pending';
                }
                
                const { data, error } = await supabase
                    .from('profiles')
                    .update(profileData)
                    .eq('id', currentUser.id)
                    .select()
                    .single();
                
                if (error) throw error;
                
                elements.sellerName.textContent = name;
                updateUserAvatar(elements.sellerAvatar, data.avatar_url, name);
                
                // Refresh verification status
                loadSellerVerificationStatus(data);
                
                showNotification('Success', 'Profile updated successfully!', 'success');
            } catch (error) {
                showNotification('Error', 'Failed to update profile: ' + error.message, 'error');
            }
        }

        // Load rider data
        async function loadRiderData() {
            await updateRiderStats();
            await loadAvailableDeliveries();
            await loadRiderRecentDeliveries();
        }

        // Update rider stats
        async function updateRiderStats() {
            try {
                // Get rider's deliveries
                const { data: deliveries, error } = await supabase
                    .from('deliveries')
                    .select('*')
                    .eq('rider_id', currentUser.id);
                
                if (error) throw error;
                
                // Get available deliveries (not assigned to any rider)
                const { data: availableDeliveries, error: availableError } = await supabase
                    .from('deliveries')
                    .select('*')
                    .is('rider_id', null)
                    .in('status', ['pending', 'accepted']);
                
                if (availableError) throw availableError;
                
                const available = availableDeliveries ? availableDeliveries.length : 0;
                const active = deliveries ? deliveries.filter(d => d.status === 'accepted' || d.status === 'picked_up' || d.status === 'in_transit').length : 0;
                const completedToday = deliveries ? deliveries.filter(d => {
                    const deliveryDate = new Date(d.updated_at);
                    const today = new Date();
                    return d.status === 'delivered' && 
                           deliveryDate.getDate() === today.getDate() &&
                           deliveryDate.getMonth() === today.getMonth() &&
                           deliveryDate.getFullYear() === today.getFullYear();
                }).length : 0;
                
                // Calculate earnings
                let todayEarnings = 0;
                let weekEarnings = 0;
                let monthEarnings = 0;
                const today = new Date();
                const weekStart = new Date(today);
                weekStart.setDate(today.getDate() - today.getDay());
                const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
                
                if (deliveries) {
                    deliveries.forEach(delivery => {
                        if (delivery.status === 'delivered') {
                            const deliveryDate = new Date(delivery.updated_at);
                            
                            if (deliveryDate.toDateString() === today.toDateString()) {
                                todayEarnings += delivery.delivery_fee || 0;
                            }
                            
                            if (deliveryDate >= weekStart) {
                                weekEarnings += delivery.delivery_fee || 0;
                            }
                            
                            if (deliveryDate >= monthStart) {
                                monthEarnings += delivery.delivery_fee || 0;
                            }
                        }
                    });
                }
                
                // Calculate rating (mock data for now)
                const rating = '4.8';
                
                elements.availableDeliveries.textContent = available;
                elements.activeDeliveries.textContent = active;
                elements.completedDeliveries.textContent = completedToday;
                elements.riderRating.textContent = rating;
                elements.todayEarnings.textContent = todayEarnings.toLocaleString();
                elements.weekEarnings.textContent = weekEarnings.toLocaleString();
                elements.monthEarnings.textContent = monthEarnings.toLocaleString();
                elements.totalDeliveries.textContent = deliveries ? deliveries.length : 0;
            } catch (error) {
                console.error('Error updating rider stats:', error);
            }
        }

        // Load rider recent deliveries
        async function loadRiderRecentDeliveries() {
            try {
                const { data: deliveries, error } = await supabase
                    .from('deliveries')
                    .select(`
                        *,
                        orders (
                            customer_id,
                            total
                        )
                    `)
                    .eq('rider_id', currentUser.id)
                    .order('updated_at', { ascending: false })
                    .limit(3);
                
                if (error) throw error;
                
                elements.riderRecentDeliveries.innerHTML = '';
                
                if (!deliveries || deliveries.length === 0) {
                    elements.riderRecentDeliveries.innerHTML = `
                        <div class="empty-state" style="padding: 20px;">
                            <i class="fas fa-truck"></i>
                            <p>No recent deliveries</p>
                        </div>
                    `;
                    return;
                }
                
                deliveries.forEach(delivery => {
                    let icon = 'fas fa-truck';
                    let title = 'Delivery Assigned';
                    let description = `Delivery #${delivery.id.substring(0, 8)} assigned to you`;
                    
                    if (delivery.status === 'delivered') {
                        icon = 'fas fa-check-circle';
                        title = 'Delivery Completed';
                        description = `Delivery #${delivery.id.substring(0, 8)} completed`;
                    } else if (delivery.status === 'picked_up') {
                        icon = 'fas fa-box';
                        title = 'Package Picked Up';
                        description = `Picked up delivery #${delivery.id.substring(0, 8)}`;
                    } else if (delivery.status === 'in_transit') {
                        icon = 'fas fa-shipping-fast';
                        title = 'In Transit';
                        description = `Delivery #${delivery.id.substring(0, 8)} is in transit`;
                    }
                    
                    const activityItem = document.createElement('div');
                    activityItem.className = 'timeline-item';
                    activityItem.innerHTML = `
                        <div class="timeline-icon">
                            <i class="${icon}"></i>
                        </div>
                        <div class="timeline-content">
                            <h4>${title}</h4>
                            <p>${description}</p>
                            <div class="timeline-time">${formatTimeAgo(delivery.updated_at)}</div>
                        </div>
                    `;
                    
                    elements.riderRecentDeliveries.appendChild(activityItem);
                });
            } catch (error) {
                console.error('Error loading rider recent deliveries:', error);
            }
        }

        // Load available deliveries
        async function loadAvailableDeliveries() {
            try {
                // Get deliveries that need a rider
                const { data: deliveries, error } = await supabase
                    .from('deliveries')
                    .select(`
                        *,
                        orders (
                            customer_id,
                            total
                        )
                    `)
                    .is('rider_id', null)
                    .in('status', ['pending', 'accepted'])
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                elements.availableDeliveriesList.innerHTML = '';
                
                if (!deliveries || deliveries.length === 0) {
                    elements.availableDeliveriesList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-truck"></i>
                            <h3>No Available Deliveries</h3>
                            <p>Check back later for new delivery requests.</p>
                        </div>
                    `;
                    return;
                }
                
                deliveries.forEach(delivery => {
                    const deliveryCard = document.createElement('div');
                    deliveryCard.className = 'delivery-card';
                    deliveryCard.innerHTML = `
                        <div class="delivery-header">
                            <h4>Delivery #${delivery.id.substring(0, 8)}</h4>
                            <span class="delivery-status status-${delivery.status}">${delivery.status}</span>
                        </div>
                        <div class="delivery-info">
                            <div class="delivery-info-item">
                                <div class="delivery-info-icon">
                                    <i class="fas fa-store"></i>
                                </div>
                                <div>
                                    <strong>Pickup</strong>
                                    <p>${delivery.pickup_address || 'N/A'}</p>
                                </div>
                            </div>
                            <div class="delivery-info-item">
                                <div class="delivery-info-icon">
                                    <i class="fas fa-home"></i>
                                </div>
                                <div>
                                    <strong>Delivery</strong>
                                    <p>${delivery.delivery_address || 'N/A'}</p>
                                </div>
                            </div>
                        </div>
                        <div class="delivery-info">
                            <div class="delivery-info-item">
                                <div class="delivery-info-icon">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                                <div>
                                    <strong>Delivery Fee</strong>
                                    <p>KSh ${delivery.delivery_fee || 0}</p>
                                </div>
                            </div>
                            <div class="delivery-info-item">
                                <div class="delivery-info-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div>
                                    <strong>Created</strong>
                                    <p>${formatTimeAgo(delivery.created_at)}</p>
                                </div>
                            </div>
                        </div>
                        <div class="delivery-actions" style="margin-top: 15px;">
                            <button class="btn btn-primary btn-sm accept-delivery-btn" data-delivery-id="${delivery.id}">
                                <i class="fas fa-check"></i> Accept Delivery
                            </button>
                        </div>
                    `;
                    
                    elements.availableDeliveriesList.appendChild(deliveryCard);
                });
                
                // Add event listeners to accept delivery buttons
                document.querySelectorAll('.accept-delivery-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const deliveryId = this.getAttribute('data-delivery-id');
                        acceptDelivery(deliveryId);
                    });
                });
            } catch (error) {
                console.error('Error loading available deliveries:', error);
                showNotification('Error', 'Failed to load available deliveries', 'error');
            }
        }

        // Accept delivery
        async function acceptDelivery(deliveryId) {
            try {
                const { data, error } = await supabase
                    .from('deliveries')
                    .update({
                        rider_id: currentUser.id,
                        status: 'accepted',
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', deliveryId)
                    .select()
                    .single();
                
                if (error) throw error;
                
                showNotification('Success', 'Delivery accepted successfully!', 'success');
                loadAvailableDeliveries();
                updateRiderStats();
                switchDashboardSection('myDeliveries');
            } catch (error) {
                showNotification('Error', 'Failed to accept delivery: ' + error.message, 'error');
            }
        }

        // Load my deliveries
        async function loadMyDeliveries() {
            try {
                const { data: deliveries, error } = await supabase
                    .from('deliveries')
                    .select(`
                        *,
                        orders (
                            customer_id,
                            total
                        )
                    `)
                    .eq('rider_id', currentUser.id)
                    .in('status', ['accepted', 'picked_up', 'in_transit'])
                    .order('updated_at', { ascending: false });
                
                if (error) throw error;
                
                elements.myDeliveriesList.innerHTML = '';
                
                if (!deliveries || deliveries.length === 0) {
                    elements.myDeliveriesList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-truck"></i>
                            <h3>No Active Deliveries</h3>
                            <p>You don't have any active deliveries at the moment.</p>
                        </div>
                    `;
                    return;
                }
                
                deliveries.forEach(delivery => {
                    const deliveryCard = document.createElement('div');
                    deliveryCard.className = 'delivery-card';
                    deliveryCard.innerHTML = `
                        <div class="delivery-header">
                            <h4>Delivery #${delivery.id.substring(0, 8)}</h4>
                            <span class="delivery-status status-${delivery.status}">${delivery.status}</span>
                        </div>
                        <div class="delivery-info">
                            <div class="delivery-info-item">
                                <div class="delivery-info-icon">
                                    <i class="fas fa-store"></i>
                                </div>
                                <div>
                                    <strong>Pickup</strong>
                                    <p>${delivery.pickup_address || 'N/A'}</p>
                                </div>
                            </div>
                            <div class="delivery-info-item">
                                <div class="delivery-info-icon">
                                    <i class="fas fa-home"></i>
                                </div>
                                <div>
                                    <strong>Delivery</strong>
                                    <p>${delivery.delivery_address || 'N/A'}</p>
                                </div>
                            </div>
                        </div>
                        <div class="delivery-info">
                            <div class="delivery-info-item">
                                <div class="delivery-info-icon">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                                <div>
                                    <strong>Delivery Fee</strong>
                                    <p>KSh ${delivery.delivery_fee || 0}</p>
                                </div>
                            </div>
                            <div class="delivery-info-item">
                                <div class="delivery-info-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div>
                                    <strong>Status</strong>
                                    <p>${delivery.status}</p>
                                </div>
                            </div>
                        </div>
                        <div class="delivery-actions" style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                            ${delivery.status === 'accepted' ? `
                            <button class="btn btn-primary btn-sm pickup-delivery-btn" data-delivery-id="${delivery.id}">
                                <i class="fas fa-box"></i> Mark as Picked Up
                            </button>
                            ` : ''}
                            ${delivery.status === 'picked_up' ? `
                            <button class="btn btn-primary btn-sm transit-delivery-btn" data-delivery-id="${delivery.id}">
                                <i class="fas fa-shipping-fast"></i> Mark as In Transit
                            </button>
                            ` : ''}
                            ${delivery.status === 'in_transit' ? `
                            <button class="btn btn-success btn-sm complete-delivery-btn" data-delivery-id="${delivery.id}">
                                <i class="fas fa-check"></i> Mark as Delivered
                            </button>
                            ` : ''}
                            <button class="btn btn-outline btn-sm view-delivery-details-btn" data-delivery-id="${delivery.id}">
                                <i class="fas fa-eye"></i> View Details
                            </button>
                        </div>
                    `;
                    
                    elements.myDeliveriesList.appendChild(deliveryCard);
                });
                
                // Add event listeners to delivery action buttons
                document.querySelectorAll('.pickup-delivery-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const deliveryId = this.getAttribute('data-delivery-id');
                        updateDeliveryStatus(deliveryId, 'picked_up');
                    });
                });
                
                document.querySelectorAll('.transit-delivery-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const deliveryId = this.getAttribute('data-delivery-id');
                        updateDeliveryStatus(deliveryId, 'in_transit');
                    });
                });
                
                document.querySelectorAll('.complete-delivery-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const deliveryId = this.getAttribute('data-delivery-id');
                        updateDeliveryStatus(deliveryId, 'delivered');
                    });
                });
                
                document.querySelectorAll('.view-delivery-details-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const deliveryId = this.getAttribute('data-delivery-id');
                        viewDeliveryDetails(deliveryId);
                    });
                });
            } catch (error) {
                console.error('Error loading my deliveries:', error);
                showNotification('Error', 'Failed to load your deliveries', 'error');
            }
        }

        // Update delivery status
        async function updateDeliveryStatus(deliveryId, status) {
            try {
                const { data, error } = await supabase
                    .from('deliveries')
                    .update({
                        status: status,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', deliveryId)
                    .select()
                    .single();
                
                if (error) throw error;
                
                showNotification('Success', `Delivery status updated to ${status}!`, 'success');
                loadMyDeliveries();
                updateRiderStats();
            } catch (error) {
                showNotification('Error', 'Failed to update delivery status: ' + error.message, 'error');
            }
        }

        // View delivery details
        async function viewDeliveryDetails(deliveryId) {
            try {
                const { data: delivery, error } = await supabase
                    .from('deliveries')
                    .select(`
                        *,
                        orders (
                            customer_id,
                            total
                        )
                    `)
                    .eq('id', deliveryId)
                    .single();
                
                if (error) throw error;
                
                let details = `Delivery #${delivery.id.substring(0, 8)}\n\n`;
                details += `Status: ${delivery.status}\n`;
                details += `Pickup Address: ${delivery.pickup_address || 'N/A'}\n`;
                details += `Delivery Address: ${delivery.delivery_address || 'N/A'}\n`;
                details += `Delivery Fee: KSh ${delivery.delivery_fee || 0}\n`;
                details += `Created: ${new Date(delivery.created_at).toLocaleString()}\n`;
                details += `Last Updated: ${new Date(delivery.updated_at).toLocaleString()}`;
                
                alert(details);
            } catch (error) {
                console.error('Error viewing delivery details:', error);
                showNotification('Error', 'Failed to load delivery details', 'error');
            }
        }

        // Load rider earnings
        async function loadRiderEarnings() {
            try {
                const { data: deliveries, error } = await supabase
                    .from('deliveries')
                    .select('*')
                    .eq('rider_id', currentUser.id)
                    .eq('status', 'delivered')
                    .order('updated_at', { ascending: false });
                
                if (error) throw error;
                
                elements.riderEarningsHistory.innerHTML = '';
                
                if (!deliveries || deliveries.length === 0) {
                    elements.riderEarningsHistory.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-money-bill-wave"></i>
                            <h3>No Earnings Yet</h3>
                            <p>Your earnings will appear here once you complete deliveries.</p>
                        </div>
                    `;
                    return;
                }
                
                let totalEarnings = 0;
                
                deliveries.forEach(delivery => {
                    totalEarnings += delivery.delivery_fee || 0;
                    
                    const earningItem = document.createElement('div');
                    earningItem.className = 'order-item';
                    earningItem.innerHTML = `
                        <div class="order-item-info">
                            <h4>Delivery #${delivery.id.substring(0, 8)}</h4>
                            <p>Completed on ${new Date(delivery.updated_at).toLocaleDateString()}</p>
                        </div>
                        <div class="order-item-actions">
                            <span style="font-weight: bold; color: var(--success);">KSh ${(delivery.delivery_fee || 0).toLocaleString()}</span>
                        </div>
                    `;
                    
                    elements.riderEarningsHistory.appendChild(earningItem);
                });
                
                // Add total earnings summary
                const totalEarningsElement = document.createElement('div');
                totalEarningsElement.className = 'order-item';
                totalEarningsElement.style.borderTop = '2px solid rgba(255,255,255,0.2)';
                totalEarningsElement.style.paddingTop = '15px';
                totalEarningsElement.style.marginTop = '15px';
                totalEarningsElement.innerHTML = `
                    <div class="order-item-info">
                        <h4 style="color: var(--success);">Total Earnings</h4>
                    </div>
                    <div class="order-item-actions">
                        <span style="font-weight: bold; font-size: 1.2rem; color: var(--success);">KSh ${totalEarnings.toLocaleString()}</span>
                    </div>
                `;
                
                elements.riderEarningsHistory.appendChild(totalEarningsElement);
            } catch (error) {
                console.error('Error loading rider earnings:', error);
                showNotification('Error', 'Failed to load earnings', 'error');
            }
        }

        // Load rider profile
        async function loadRiderProfile() {
            try {
                const { data: profile, error } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();
                
                if (error) throw error;
                
                document.getElementById('riderProfileName').value = profile.name || '';
                document.getElementById('riderProfileEmail').value = currentUser.email;
                document.getElementById('riderProfilePhone').value = profile.phone || '';
                document.getElementById('riderIdNumber').value = profile.id_number || '';
                document.getElementById('riderVehicle').value = profile.vehicle_type || 'motorcycle';
                document.getElementById('riderLicense').value = profile.license_number || '';
                document.getElementById('riderVehicleReg').value = profile.vehicle_registration || '';
                document.getElementById('emergencyContactName').value = profile.emergency_contact_name || '';
                document.getElementById('emergencyContactPhone').value = profile.emergency_contact_phone || '';
                document.getElementById('emergencyContactRelation').value = profile.emergency_contact_relation || '';
                
                // Update avatar if exists
                updateUserAvatar(elements.riderAvatar, profile.avatar_url, profile.name || currentUser.email);
                
                // Load verification status
                loadRiderVerificationStatus(profile);
            } catch (error) {
                console.error('Error loading rider profile:', error);
            }
        }

        // Load rider verification status
        function loadRiderVerificationStatus(profile) {
            let statusHTML = '';
            
            if (profile.verification_status === 'approved') {
                statusHTML = `
                    <div class="verification-status verification-approved">
                        <i class="fas fa-check-circle"></i>
                        Verified Rider
                    </div>
                    <p style="margin-top: 10px; color: rgba(255,255,255,0.7);">Your account has been verified and is fully active.</p>
                `;
            } else if (profile.verification_status === 'pending') {
                statusHTML = `
                    <div class="verification-status verification-pending">
                        <i class="fas fa-clock"></i>
                        Verification Pending
                    </div>
                    <p style="margin-top: 10px; color: rgba(255,255,255,0.7);">Your verification is being reviewed. This usually takes 1-2 business days.</p>
                    
                    <div class="verification-steps">
                        <div class="verification-step ${profile.id_number ? 'completed' : ''}">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Personal Information</h4>
                                <p>Provide your personal details</p>
                            </div>
                        </div>
                        <div class="verification-step ${profile.license_number ? 'completed' : ''}">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>License Information</h4>
                                <p>Provide your license details</p>
                            </div>
                        </div>
                        <div class="verification-step ${profile.vehicle_registration ? 'completed' : ''}">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Vehicle Information</h4>
                                <p>Provide your vehicle details</p>
                            </div>
                        </div>
                        <div class="verification-step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h4>Verification Review</h4>
                                <p>Our team will review your application</p>
                            </div>
                        </div>
                    </div>
                `;
            } else if (profile.verification_status === 'rejected') {
                statusHTML = `
                    <div class="verification-status verification-rejected">
                        <i class="fas fa-times-circle"></i>
                        Verification Rejected
                    </div>
                    <p style="margin-top: 10px; color: rgba(255,255,255,0.7);">Your verification was rejected. Please check your email for details.</p>
                    <button class="btn btn-primary" style="margin-top: 15px;">Reapply for Verification</button>
                `;
            } else {
                statusHTML = `
                    <div class="verification-status verification-pending">
                        <i class="fas fa-exclamation-circle"></i>
                        Not Verified
                    </div>
                    <p style="margin-top: 10px; color: rgba(255,255,255,0.7);">Complete your profile to apply for verification.</p>
                `;
            }
            
            elements.riderVerificationStatus.innerHTML = statusHTML;
        }

        // Handle rider photo upload
        async function handleRiderPhotoUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            await uploadUserPhoto(file, 'rider');
        }

        // Handle license photo upload
        async function handleLicensePhotoUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            // In a real app, you would upload this to Supabase storage
            showNotification('Info', 'License photo would be uploaded and saved to your profile', 'info');
        }

        // Handle vehicle photo upload
        async function handleVehiclePhotoUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            // In a real app, you would upload this to Supabase storage
            showNotification('Info', 'Vehicle photo would be uploaded and saved to your profile', 'info');
        }

        // Save rider profile
        async function saveRiderProfile() {
            const name = document.getElementById('riderProfileName').value;
            const phone = document.getElementById('riderProfilePhone').value;
            const idNumber = document.getElementById('riderIdNumber').value;
            const vehicleType = document.getElementById('riderVehicle').value;
            const license = document.getElementById('riderLicense').value;
            const vehicleReg = document.getElementById('riderVehicleReg').value;
            const emergencyName = document.getElementById('emergencyContactName').value;
            const emergencyPhone = document.getElementById('emergencyContactPhone').value;
            const emergencyRelation = document.getElementById('emergencyContactRelation').value;
            
            try {
                const profileData = {
                    name,
                    phone,
                    id_number: idNumber,
                    vehicle_type: vehicleType,
                    license_number: license,
                    vehicle_registration: vehicleReg,
                    emergency_contact_name: emergencyName,
                    emergency_contact_phone: emergencyPhone,
                    emergency_contact_relation: emergencyRelation
                };
                
                // If this is the first time setting required fields, set verification status to pending
                if (idNumber && license && vehicleReg && !profileData.verification_status) {
                    profileData.verification_status = 'pending';
                }
                
                const { data, error } = await supabase
                    .from('profiles')
                    .update(profileData)
                    .eq('id', currentUser.id)
                    .select()
                    .single();
                
                if (error) throw error;
                
                elements.riderName.textContent = name;
                updateUserAvatar(elements.riderAvatar, data.avatar_url, name);
                
                // Refresh verification status
                loadRiderVerificationStatus(data);
                
                showNotification('Success', 'Profile updated successfully!', 'success');
            } catch (error) {
                showNotification('Error', 'Failed to update profile: ' + error.message, 'error');
            }
        }

        // Handle emergency button
        function handleEmergency() {
            // In a real app, this would trigger an emergency alert to the support team
            showNotification('Emergency', 'Emergency alert sent to support team! Help is on the way.', 'error');
            
            // You could also send an email, SMS, or push notification here
        }

        // Handle contact form
        function handleContactForm(e) {
            e.preventDefault();
            showNotification('Success', 'Your message has been sent! We will get back to you soon.', 'success');
            e.target.reset();
        }

        // Show loading spinner
        function showLoading() {
            elements.loadingSpinner.style.display = 'flex';
        }

        // Hide loading spinner
        function hideLoading() {
            elements.loadingSpinner.style.display = 'none';
        }

        // Show notification
        function showNotification(title, message, type = 'success') {
            const notification = elements.notification;
            const notificationTitle = elements.notificationTitle;
            const notificationMessage = elements.notificationMessage;
            
            // Set notification content
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            
            // Set notification type
            notification.className = 'notification';
            notification.classList.add(`notification-${type}`);
            
            // Update icon based on type
            const icon = notification.querySelector('i');
            icon.className = type === 'success' ? 'fas fa-check-circle' :
                            type === 'error' ? 'fas fa-exclamation-circle' :
                            type === 'info' ? 'fas fa-info-circle' : 'fas fa-check-circle';
            
            // Show notification
            notification.classList.add('show');
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // Utility function to handle file uploads (placeholder)
        async function handleFileUpload(file, path) {
            // In a real app, you would upload the file to Supabase storage
            // and return the public URL
            return 'https://example.com/uploaded-file.jpg';
        }
    </script>
</body>
</html>




