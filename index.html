<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPATE Deliveries - Fast Nairobi Delivery</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸšš</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary: #FF6B00;
            --secondary: #00A859;
            --accent: #FFD700;
            --dark: #1A1A1A;
            --light: #F5F5F5;
            --gray: #E0E0E0;
            --shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            --success: #00B894;
            --warning: #FBC531;
            --danger: #E84118;
            --info: #0984e3;
            --glass: rgba(255, 255, 255, 0.25);
            --blur: blur(10px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Glass Effect */
        .glass {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border: 1px solid rgba(255, 255, 255, 0.18);
            border-radius: 20px;
        }

        .glass-dark {
            background: rgba(0, 0, 0, 0.25);
            backdrop-filter: var(--blur);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
        }

        /* Header Styles */
        header {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-bottom: 1px solid rgba(255, 255, 255, 0.18);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            color: var(--primary);
            font-size: 28px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .logo-text {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-links {
            display: flex;
            gap: 30px;
        }

        .nav-links a {
            text-decoration: none;
            color: white;
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 12px;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-links a:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .auth-buttons {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #FF8C00);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 0, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 107, 0, 0.4);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-3px);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), #00C853);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 168, 89, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 168, 89, 0.4);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 12px;
        }

        .btn-block {
            width: 100%;
        }

        .btn-large {
            padding: 16px 32px;
            font-size: 16px;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: white;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.9), rgba(118, 75, 162, 0.9));
            color: white;
            padding: 120px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('https://images.unsplash.com/photo-1556740711-2d67d1252f8f?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80') center/cover;
            opacity: 0.1;
            z-index: -1;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            font-weight: 800;
            text-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .hero p {
            font-size: 1.3rem;
            max-width: 700px;
            margin: 0 auto 40px;
            opacity: 0.9;
        }

        .hero-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        /* Features Section */
        .features {
            padding: 100px 0;
            background: transparent;
        }

        .section-title {
            text-align: center;
            margin-bottom: 60px;
            font-size: 2.5rem;
            color: white;
            font-weight: 700;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
        }

        .feature-card {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.18);
            color: white;
        }

        .feature-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .feature-icon {
            font-size: 48px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            padding: 40px;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.18);
            color: white;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: white;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: var(--primary);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .auth-tab {
            padding: 15px 30px;
            cursor: pointer;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.3s;
        }

        .auth-tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: white;
        }

        .form-control {
            width: 100%;
            padding: 15px 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 0, 0.1);
        }

        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        /* Dashboard Styles */
        .dashboard {
            min-height: 100vh;
            padding-top: 80px;
        }

        .dashboard-header {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-bottom: 1px solid rgba(255, 255, 255, 0.18);
            padding: 20px 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .dashboard-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .dashboard-content {
            padding: 40px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.18);
            color: white;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.8);
            font-weight: 600;
        }

        /* Products Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        .product-card {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: white;
        }

        .product-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .product-image {
            height: 200px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .product-image::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8));
        }

        .product-info {
            padding: 25px;
        }

        .product-price {
            font-size: 1.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 15px 0;
        }

        /* Footer Styles */
        footer {
            background: var(--glass-dark);
            backdrop-filter: var(--blur);
            color: white;
            padding: 60px 0 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }

        .footer-logo {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .footer-links h4 {
            margin-bottom: 20px;
            font-size: 18px;
            color: white;
        }

        .footer-links ul {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 12px;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .footer-links a:hover {
            color: var(--primary);
            transform: translateX(5px);
        }

        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .social-link {
            width: 45px;
            height: 45px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .social-link:hover {
            background: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 107, 0, 0.3);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 20px 25px;
            border-radius: 15px;
            background: var(--glass);
            backdrop-filter: var(--blur);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 3000;
            transform: translateX(150%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 400px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            color: white;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-success {
            border-left: 5px solid var(--success);
        }

        .notification-error {
            border-left: 5px solid var(--danger);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .nav-links, .auth-buttons {
                display: none;
            }

            .mobile-menu-btn {
                display: block;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .hero p {
                font-size: 1.1rem;
            }

            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }

            .products-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Page Styles */
        .page {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dashboard Navigation */
        .dashboard-nav-links {
            display: flex;
            gap: 15px;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .dashboard-nav-link {
            padding: 12px 24px;
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 12px;
            text-decoration: none;
            color: white;
            font-weight: 600;
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: all 0.3s;
        }

        .dashboard-nav-link:hover, .dashboard-nav-link.active {
            background: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 0, 0.3);
        }

        /* Order Cards */
        .order-card {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            margin-bottom: 20px;
            border-left: 5px solid var(--primary);
            color: white;
            transition: transform 0.3s;
        }

        .order-card:hover {
            transform: translateY(-5px);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .order-status {
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-pending { background: var(--warning); color: white; }
        .status-accepted { background: var(--primary); color: white; }
        .status-ready { background: var(--secondary); color: white; }
        .status-assigned { background: var(--info); color: white; }
        .status-picked { background: #9C27B0; color: white; }
        .status-delivered { background: var(--success); color: white; }
        .status-cancelled { background: var(--danger); color: white; }

        .order-items {
            margin: 20px 0;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .order-total {
            font-weight: 800;
            font-size: 1.3rem;
            text-align: right;
            margin-top: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Cart Styles */
        .cart-items {
            margin: 25px 0;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .cart-item-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .cart-item-image {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 12px;
        }

        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .quantity-btn {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            transition: all 0.3s;
        }

        .quantity-btn:hover {
            background: var(--primary);
            transform: scale(1.1);
        }

        /* Rider Dashboard Specific */
        .status-toggle {
            display: flex;
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            margin-bottom: 30px;
            align-items: center;
            justify-content: space-between;
            color: white;
        }

        .toggle-container {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.2);
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background: var(--success);
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        /* Loading Spinner */
        .loading-spinner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 80px 30px;
            color: rgba(255, 255, 255, 0.7);
        }

        .empty-state i {
            font-size: 80px;
            margin-bottom: 25px;
            opacity: 0.5;
        }

        /* Form Validation */
        .error-message {
            color: var(--danger);
            font-size: 14px;
            margin-top: 8px;
            display: none;
        }

        .form-control.error {
            border-color: var(--danger);
        }

        /* MPESA Payment Styles */
        .mpesa-payment-container {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            color: white;
        }

        .mpesa-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }

        .mpesa-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: rgba(255, 255, 255, 0.2);
            z-index: 1;
        }

        .mpesa-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .mpesa-step.active .step-number {
            background: var(--primary);
            box-shadow: 0 4px 15px rgba(255, 107, 0, 0.4);
        }

        .step-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
        }

        .mpesa-step.active .step-label {
            color: white;
            font-weight: bold;
        }

        .mpesa-form {
            display: none;
        }

        .mpesa-form.active {
            display: block;
        }

        .mpesa-phone-input {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }

        .mpesa-phone-input select {
            flex: 0 0 80px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .mpesa-phone-input input {
            flex: 1;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .mpesa-payment-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .mpesa-payment-actions .btn {
            flex: 1;
        }

        .payment-success {
            text-align: center;
            padding: 40px 0;
            display: none;
        }

        .payment-success i {
            font-size: 80px;
            color: var(--success);
            margin-bottom: 25px;
        }

        .payment-success h3 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: white;
        }

        /* Additional Styles for New Pages */
        .content-page {
            padding: 100px 0;
            min-height: 100vh;
        }
        
        .content-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px;
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            color: white;
        }
        
        .content-container h1 {
            font-size: 2.5rem;
            margin-bottom: 30px;
            text-align: center;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .content-container h2 {
            font-size: 1.8rem;
            margin: 40px 0 20px;
            color: var(--primary);
        }
        
        .content-container h3 {
            font-size: 1.4rem;
            margin: 30px 0 15px;
            color: var(--secondary);
        }
        
        .content-container p {
            margin-bottom: 20px;
            line-height: 1.7;
        }
        
        .content-container ul, .content-container ol {
            margin: 20px 0;
            padding-left: 30px;
        }
        
        .content-container li {
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 30px;
            color: white;
            text-decoration: none;
            font-weight: 600;
            padding: 10px 20px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }
        
        .back-button:hover {
            background: var(--primary);
            transform: translateY(-2px);
        }
        
        /* Enhanced Learn More Section */
        .learn-more-section {
            padding: 100px 0;
            background: transparent;
        }
        
        .learn-more-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 40px;
            margin-top: 50px;
        }
        
        .learn-more-card {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: all 0.3s;
            color: white;
        }
        
        .learn-more-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        
        .learn-more-card h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .learn-more-card i {
            font-size: 40px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .process-steps {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin: 40px 0;
        }
        
        .process-step {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }
        
        .step-number {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .step-content h4 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        /* Testimonials Section */
        .testimonials {
            padding: 100px 0;
            background: transparent;
        }
        
        .testimonials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 50px;
        }
        
        .testimonial-card {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            color: white;
            position: relative;
        }
        
        .testimonial-card::before {
            content: '"';
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 60px;
            color: var(--primary);
            opacity: 0.3;
            font-family: Georgia, serif;
        }
        
        .testimonial-content {
            margin-bottom: 20px;
            font-style: italic;
            line-height: 1.6;
        }
        
        .testimonial-author {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .author-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }
        
        .author-info h4 {
            margin-bottom: 5px;
            color: white;
        }
        
        .author-info p {
            margin: 0;
            opacity: 0.8;
            font-size: 0.9rem;
        }
        
        /* FAQ Section */
        .faq-section {
            padding: 100px 0;
            background: transparent;
        }
        
        .faq-container {
            max-width: 800px;
            margin: 50px auto 0;
        }
        
        .faq-item {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            overflow: hidden;
        }
        
        .faq-question {
            padding: 20px 25px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: white;
            transition: all 0.3s;
        }
        
        .faq-question:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .faq-question i {
            transition: transform 0.3s;
        }
        
        .faq-answer {
            padding: 0 25px;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .faq-item.active .faq-answer {
            padding: 0 25px 25px;
            max-height: 500px;
        }
        
        .faq-item.active .faq-question i {
            transform: rotate(180deg);
        }
    </style>
</head>
<body>
    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
        <p>Processing your request...</p>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <div>
            <h4 id="notificationTitle">Success</h4>
            <p id="notificationMessage">Operation completed successfully</p>
        </div>
    </div>

    <!-- Landing Page -->
    <div class="page active" id="landingPage">
        <!-- Header -->
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <i class="fas fa-truck-fast logo-icon"></i>
                        <span class="logo-text">IPATE Deliveries</span>
                    </div>
                    <nav class="nav-links">
                        <a href="#features">Features</a>
                        <a href="#" id="aboutLink">About</a>
                        <a href="#" id="contactLink">Contact</a>
                        <a href="#" id="learnMoreLink">Learn More</a>
                    </nav>
                    <div class="auth-buttons">
                        <button class="btn btn-outline" id="loginBtn">Login</button>
                        <button class="btn btn-primary" id="signupBtn">Sign Up</button>
                    </div>
                    <button class="mobile-menu-btn" id="mobileMenuBtn">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Hero Section -->
        <section class="hero">
            <div class="container">
                <h1>Fast & Reliable Deliveries in Nairobi</h1>
                <p>Get your goods delivered quickly and safely with our trusted network of riders. From food to documents, we've got you covered.</p>
                <div class="hero-buttons">
                    <button class="btn btn-primary btn-large" id="getStartedBtn">
                        <i class="fas fa-rocket"></i> Get Started Now
                    </button>
                    <button class="btn btn-outline btn-large" id="learnMoreBtn">
                        <i class="fas fa-play-circle"></i> Learn More
                    </button>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section class="features" id="features">
            <div class="container">
                <h2 class="section-title">Why Choose IPATE Deliveries?</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <i class="fas fa-bolt feature-icon"></i>
                        <h3>Lightning Fast</h3>
                        <p>Our riders are strategically located across Nairobi to ensure your deliveries arrive in record time.</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-shield-alt feature-icon"></i>
                        <h3>Secure & Safe</h3>
                        <p>All our riders are verified and your items are insured for complete peace of mind.</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-map-marker-alt feature-icon"></i>
                        <h3>Real-Time Tracking</h3>
                        <p>Track your delivery in real-time from pickup to drop-off with our advanced tracking system.</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-money-bill-wave feature-icon"></i>
                        <h3>Affordable Pricing</h3>
                        <p>Competitive pricing with no hidden fees. Pay only for the distance your delivery travels.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Testimonials Section -->
        <section class="testimonials">
            <div class="container">
                <h2 class="section-title">What Our Customers Say</h2>
                <div class="testimonials-grid">
                    <div class="testimonial-card">
                        <div class="testimonial-content">
                            "IPATE Deliveries has revolutionized how I run my small business. My products reach customers faster than ever before!"
                        </div>
                        <div class="testimonial-author">
                            <div class="author-avatar">S</div>
                            <div class="author-info">
                                <h4>Sarah Kimani</h4>
                                <p>Small Business Owner</p>
                            </div>
                        </div>
                    </div>
                    <div class="testimonial-card">
                        <div class="testimonial-content">
                            "As a rider, I love the flexibility and fair earnings. The app makes it easy to manage deliveries and track my income."
                        </div>
                        <div class="testimonial-author">
                            <div class="author-avatar">J</div>
                            <div class="author-info">
                                <h4>John Otieno</h4>
                                <p>Delivery Rider</p>
                            </div>
                        </div>
                    </div>
                    <div class="testimonial-card">
                        <div class="testimonial-content">
                            "The real-time tracking feature gives me peace of mind. I always know exactly when my delivery will arrive."
                        </div>
                        <div class="testimonial-author">
                            <div class="author-avatar">M</div>
                            <div class="author-info">
                                <h4>Mary Wanjiku</h4>
                                <p>Regular Customer</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- FAQ Section -->
        <section class="faq-section">
            <div class="container">
                <h2 class="section-title">Frequently Asked Questions</h2>
                <div class="faq-container">
                    <div class="faq-item">
                        <div class="faq-question">
                            How fast can I get my delivery?
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="faq-answer">
                            Most deliveries within Nairobi are completed within 1-3 hours, depending on distance and traffic conditions. We offer express delivery options for urgent packages.
                        </div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question">
                            What areas do you serve?
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="faq-answer">
                            We currently serve all major areas in Nairobi including CBD, Westlands, Karen, Lang'ata, Kileleshwa, Kilimani, Lavington, Parklands, and many more. We're continuously expanding our coverage.
                        </div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question">
                            How do I become a rider?
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="faq-answer">
                            To become a rider, sign up for a rider account, complete the verification process, provide your vehicle details and license information, and complete our orientation. Once approved, you can start accepting delivery requests.
                        </div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question">
                            What payment methods do you accept?
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="faq-answer">
                            We primarily accept M-PESA payments for seamless transactions. We're working on adding more payment options including credit/debit cards in the near future.
                        </div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question">
                            Are my items insured during delivery?
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="faq-answer">
                            Yes, all items are covered by our basic insurance during transit. For high-value items, we recommend additional insurance coverage which can be arranged through our customer service.
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer>
            <div class="container">
                <div class="footer-grid">
                    <div class="footer-logo">
                        <i class="fas fa-truck-fast"></i>
                        IPATE Deliveries
                    </div>
                    <div class="footer-links">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href="#features"><i class="fas fa-chevron-right"></i> Features</a></li>
                            <li><a href="#" id="aboutLinkFooter"><i class="fas fa-chevron-right"></i> About Us</a></li>
                            <li><a href="#" id="contactLinkFooter"><i class="fas fa-chevron-right"></i> Contact</a></li>
                            <li><a href="#" id="learnMoreLinkFooter"><i class="fas fa-chevron-right"></i> Learn More</a></li>
                        </ul>
                    </div>
                    <div class="footer-links">
                        <h4>Legal</h4>
                        <ul>
                            <li><a href="#" id="privacyLinkFooter"><i class="fas fa-chevron-right"></i> Privacy Policy</a></li>
                            <li><a href="#" id="termsLinkFooter"><i class="fas fa-chevron-right"></i> Terms of Service</a></li>
                        </ul>
                    </div>
                    <div class="footer-links">
                        <h4>Contact Info</h4>
                        <ul>
                            <li><a href="tel:+254700000000"><i class="fas fa-phone"></i> +254 748 894 671</a></li>
                            <li><a href="mailto:info@ipatedeliveries.com"><i class="fas fa-envelope"></i> info@ipatedeliveries.com</a></li>
                            <li><a href="#"><i class="fas fa-map-marker-alt"></i> Nairobi, Kenya</a></li>
                        </ul>
                        <div class="social-links">
                            <a href="#" class="social-link"><i class="fab fa-facebook-f"></i></a>
                            <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
                            <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
                            <a href="#" class="social-link"><i class="fab fa-linkedin-in"></i></a>
                        </div>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p>&copy; 2025 IPATE Deliveries. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Learn More Page -->
    <div class="page content-page" id="learnMorePage">
        <div class="container">
            <a href="#" class="back-button" id="backFromLearnMore">
                <i class="fas fa-arrow-left"></i> Back to Home
            </a>
            <div class="content-container">
                <h1>Learn More About IPATE Deliveries</h1>
                
                <h2>Our Story</h2>
                <p>IPATE Deliveries was founded in 2023 with a simple mission: to revolutionize delivery services in Nairobi by providing fast, reliable, and affordable solutions for both individuals and businesses. We understand the challenges of urban logistics and have built a platform that connects customers with verified riders for seamless delivery experiences.</p>
                
                <h2>How It Works</h2>
                <div class="process-steps">
                    <div class="process-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>Place Your Order</h4>
                            <p>Browse our products or request a custom delivery. Add items to your cart and proceed to checkout.</p>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>Secure Payment</h4>
                            <p>Pay securely via M-PESA or other payment methods. Your payment is protected until delivery is completed.</p>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>Rider Assignment</h4>
                            <p>Our system automatically assigns the nearest available rider to handle your delivery efficiently.</p>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>Real-Time Tracking</h4>
                            <p>Track your delivery in real-time from pickup to your doorstep with live updates.</p>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h4>Safe Delivery</h4>
                            <p>Your items are delivered safely and securely. Confirm receipt and rate your experience.</p>
                        </div>
                    </div>
                </div>
                
                <h2>Our Services</h2>
                <div class="learn-more-content">
                    <div class="learn-more-card">
                        <i class="fas fa-utensils"></i>
                        <h3>Food Delivery</h3>
                        <p>Get your favorite meals from restaurants across Nairobi delivered hot and fresh to your location.</p>
                    </div>
                    <div class="learn-more-card">
                        <i class="fas fa-shopping-bag"></i>
                        <h3>Grocery Delivery</h3>
                        <p>Shop from local supermarkets and have your groceries delivered to your doorstep within hours.</p>
                    </div>
                    <div class="learn-more-card">
                        <i class="fas fa-file-contract"></i>
                        <h3>Document Delivery</h3>
                        <p>Important documents delivered securely and on time to businesses and individuals across Nairobi.</p>
                    </div>
                    <div class="learn-more-card">
                        <i class="fas fa-gift"></i>
                        <h3>Package Delivery</h3>
                        <p>Send and receive packages of all sizes with our reliable and affordable delivery service.</p>
                    </div>
                    <div class="learn-more-card">
                        <i class="fas fa-store"></i>
                        <h3>Business Solutions</h3>
                        <p>Custom delivery solutions for businesses looking to streamline their logistics operations.</p>
                    </div>
                    <div class="learn-more-card">
                        <i class="fas fa-clock"></i>
                        <h3>Express Delivery</h3>
                        <p>Need it fast? Our express service ensures your items are delivered within the shortest time possible.</p>
                    </div>
                </div>
                
                <h2>Why Choose Us?</h2>
                <p>At IPATE Deliveries, we're committed to excellence in every aspect of our service:</p>
                <ul>
                    <li><strong>Verified Riders:</strong> All our delivery personnel undergo thorough background checks and training.</li>
                    <li><strong>Real-Time Tracking:</strong> Know exactly where your delivery is at all times.</li>
                    <li><strong>Insurance Coverage:</strong> Your items are insured against loss or damage during transit.</li>
                    <li><strong>24/7 Customer Support:</strong> Our support team is always available to assist you.</li>
                    <li><strong>Competitive Pricing:</strong> Transparent pricing with no hidden fees.</li>
                    <li><strong>Eco-Friendly Options:</strong> We offer bicycle and walking delivery options to reduce our carbon footprint.</li>
                </ul>
                
                <h2>Delivery Areas</h2>
                <p>We currently serve all major areas in Nairobi including:</p>
                <ul>
                    <li>Central Business District</li>
                    <li>Westlands</li>
                    <li>Karen</li>
                    <li>Lang'ata</li>
                    <li>Kileleshwa</li>
                    <li>Kilimani</li>
                    <li>Lavington</li>
                    <li>Parklands</li>
                    <li>And many more areas across the city</li>
                </ul>
                <p>We're continuously expanding our coverage to serve more areas in and around Nairobi.</p>
                
                <div style="text-align: center; margin-top: 50px;">
                    <button class="btn btn-primary btn-large" id="getStartedFromLearnMore">
                        <i class="fas fa-rocket"></i> Get Started Today
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy Policy Page -->
    <div class="page content-page" id="privacyPolicyPage">
        <div class="container">
            <a href="#" class="back-button" id="backFromPrivacy">
                <i class="fas fa-arrow-left"></i> Back to Home
            </a>
            <div class="content-container">
                <h1>Privacy Policy</h1>
                <p><strong>Last Updated: January 2025</strong></p>
                
                <p>At IPATE Deliveries, we are committed to protecting your privacy and ensuring the security of your personal information. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our delivery services, website, and mobile application.</p>
                
                <h2>Information We Collect</h2>
                
                <h3>Personal Information</h3>
                <p>When you create an account or use our services, we may collect:</p>
                <ul>
                    <li>Name, email address, and phone number</li>
                    <li>Delivery addresses and location data</li>
                    <li>Payment information (processed securely through our payment partners)</li>
                    <li>Profile information for riders and sellers</li>
                </ul>
                
                <h3>Usage Information</h3>
                <p>We automatically collect information about your interaction with our services, including:</p>
                <ul>
                    <li>Device information (IP address, browser type, operating system)</li>
                    <li>Log data (pages visited, features used, time spent)</li>
                    <li>Location data (with your permission, to facilitate deliveries)</li>
                    <li>Cookies and similar tracking technologies</li>
                </ul>
                
                <h3>Delivery Information</h3>
                <p>When you place a delivery order, we collect:</p>
                <ul>
                    <li>Pickup and delivery addresses</li>
                    <li>Item descriptions and special instructions</li>
                    <li>Recipient information (if different from your account)</li>
                    <li>Delivery status and tracking information</li>
                </ul>
                
                <h2>How We Use Your Information</h2>
                <p>We use the information we collect to:</p>
                <ul>
                    <li>Provide, maintain, and improve our delivery services</li>
                    <li>Process transactions and send related information</li>
                    <li>Facilitate communication between customers, riders, and sellers</li>
                    <li>Send you technical notices, updates, and security alerts</li>
                    <li>Respond to your comments, questions, and customer service requests</li>
                    <li>Monitor and analyze trends, usage, and activities</li>
                    <li>Personalize and improve your experience with our services</li>
                    <li>Detect, investigate, and prevent fraudulent transactions and other illegal activities</li>
                </ul>
                
                <h2>Information Sharing and Disclosure</h2>
                
                <h3>Service Providers</h3>
                <p>We may share your information with third-party vendors, service providers, and partners who need access to such information to carry out work on our behalf, such as:</p>
                <ul>
                    <li>Payment processors</li>
                    <li>Cloud storage providers</li>
                    <li>Analytics services</li>
                    <li>Customer support platforms</li>
                </ul>
                
                <h3>For Legal Reasons</h3>
                <p>We may disclose information about you:</p>
                <ul>
                    <li>If required to do so by law or legal process</li>
                    <li>To law enforcement authorities or other government officials</li>
                    <li>When we believe disclosure is necessary to prevent physical harm or financial loss</li>
                    <li>In connection with an investigation of suspected or actual illegal activity</li>
                </ul>
                
                <h3>With Your Consent</h3>
                <p>We may share your information with third parties when we have your consent to do so.</p>
                
                <h2>Data Security</h2>
                <p>We implement appropriate technical and organizational security measures designed to protect your personal information against accidental or unlawful destruction, loss, alteration, unauthorized disclosure, or access. However, no internet transmission is ever completely secure or error-free.</p>
                
                <h2>Data Retention</h2>
                <p>We retain personal information for as long as necessary to fulfill the purposes for which we collected it, including to satisfy any legal, accounting, or reporting requirements. When we no longer need to use your information, we will remove it from our systems and records or take steps to anonymize it.</p>
                
                <h2>Your Rights and Choices</h2>
                <p>Depending on your location, you may have certain rights regarding your personal information, including:</p>
                <ul>
                    <li><strong>Access:</strong> You can request access to the personal information we hold about you.</li>
                    <li><strong>Correction:</strong> You can request that we correct inaccurate or incomplete information.</li>
                    <li><strong>Deletion:</strong> You can request deletion of your personal information.</li>
                    <li><strong>Restriction:</strong> You can request that we restrict the processing of your information.</li>
                    <li><strong>Portability:</strong> You can request a copy of your information in a structured, machine-readable format.</li>
                    <li><strong>Objection:</strong> You can object to our processing of your information.</li>
                </ul>
                <p>To exercise these rights, please contact us using the information provided in the "Contact Us" section.</p>
                
                <h2>Cookies and Similar Technologies</h2>
                <p>We use cookies and similar tracking technologies to track activity on our service and hold certain information. Cookies are files with a small amount of data that may include an anonymous unique identifier. You can instruct your browser to refuse all cookies or to indicate when a cookie is being sent.</p>
                
                <h2>Children's Privacy</h2>
                <p>Our services are not intended for individuals under the age of 18. We do not knowingly collect personal information from children under 18. If we become aware that we have collected personal information from a child under 18, we will take steps to delete such information.</p>
                
                <h2>Changes to This Privacy Policy</h2>
                <p>We may update our Privacy Policy from time to time. We will notify you of any changes by posting the new Privacy Policy on this page and updating the "Last Updated" date. You are advised to review this Privacy Policy periodically for any changes.</p>
                
                <h2>Contact Us</h2>
                <p>If you have any questions about this Privacy Policy, please contact us:</p>
                <ul>
                    <li>By email: privacy@ipatedeliveries.com</li>
                    <li>By phone: +254 748 894 671</li>
                    <li>By mail: IPATE Deliveries, Nairobi, Kenya</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Terms of Service Page -->
    <div class="page content-page" id="termsOfServicePage">
        <div class="container">
            <a href="#" class="back-button" id="backFromTerms">
                <i class="fas fa-arrow-left"></i> Back to Home
            </a>
            <div class="content-container">
                <h1>Terms of Service</h1>
                <p><strong>Last Updated: January 2025</strong></p>
                
                <p>Welcome to IPATE Deliveries. These Terms of Service ("Terms") govern your access to and use of our website, services, and applications (collectively, the "Services"). Please read these Terms carefully before using our Services.</p>
                
                <h2>Acceptance of Terms</h2>
                <p>By accessing or using our Services, you agree to be bound by these Terms and our Privacy Policy. If you do not agree to these Terms, you may not access or use our Services.</p>
                
                <h2>Eligibility</h2>
                <p>You must be at least 18 years old to use our Services. By using our Services, you represent and warrant that you are at least 18 years old and have the legal capacity to enter into these Terms.</p>
                
                <h2>Account Registration</h2>
                <p>To access certain features of our Services, you must register for an account. You agree to:</p>
                <ul>
                    <li>Provide accurate, current, and complete information during registration</li>
                    <li>Maintain and promptly update your account information</li>
                    <li>Maintain the security of your password and accept all risks of unauthorized access</li>
                    <li>Notify us immediately of any unauthorized use of your account</li>
                    <li>Take responsibility for all activities that occur under your account</li>
                </ul>
                
                <h2>Services Description</h2>
                <p>IPATE Deliveries provides a platform that connects customers with delivery riders for the transportation of goods within Nairobi. We act as an intermediary between customers and riders but are not a party to any agreement between them.</p>
                
                <h2>User Responsibilities</h2>
                
                <h3>Customer Responsibilities</h3>
                <p>As a customer, you agree to:</p>
                <ul>
                    <li>Provide accurate pickup and delivery information</li>
                    <li>Ensure items are properly packaged and ready for pickup</li>
                    <li>Not request delivery of prohibited items (see Prohibited Items section)</li>
                    <li>Be available to receive deliveries or provide alternative instructions</li>
                    <li>Pay for services rendered in a timely manner</li>
                </ul>
                
                <h3>Rider Responsibilities</h3>
                <p>As a rider, you agree to:</p>
                <ul>
                    <li>Provide reliable and timely delivery services</li>
                    <li>Handle items with care and follow delivery instructions</li>
                    <li>Maintain appropriate insurance and licenses as required</li>
                    <li>Comply with all traffic laws and regulations</li>
                    <li>Treat customers and their property with respect</li>
                </ul>
                
                <h2>Prohibited Items</h2>
                <p>You may not use our Services to transport the following prohibited items:</p>
                <ul>
                    <li>Illegal substances or drugs</li>
                    <li>Weapons, firearms, or ammunition</li>
                    <li>Hazardous materials</li>
                    <li>Live animals (except service animals with proper documentation)</li>
                    <li>Human remains or body parts</li>
                    <li>Stolen property</li>
                    <li>Counterfeit or pirated goods</li>
                    <li>Perishable items requiring special handling (unless specifically agreed)</li>
                    <li>Any items prohibited by law</li>
                </ul>
                <p>We reserve the right to refuse service for any item we deem inappropriate or unsafe.</p>
                
                <h2>Payment Terms</h2>
                <p>Payment for delivery services is due at the time of order placement. We accept various payment methods including M-PESA and credit/debit cards. All prices are in Kenyan Shillings (KSh) and include applicable taxes unless otherwise stated.</p>
                
                <h2>Cancellation and Refund Policy</h2>
                
                <h3>Cancellation by Customer</h3>
                <p>You may cancel an order before a rider has been assigned without charge. If a rider has already been assigned, a cancellation fee may apply.</p>
                
                <h3>Cancellation by Rider</h3>
                <p>If a rider cancels an accepted delivery, we will automatically assign a new rider. If no rider is available, we will cancel the order and issue a full refund.</p>
                
                <h3>Refunds</h3>
                <p>Refunds may be issued in the following circumstances:</p>
                <ul>
                    <li>Service not rendered due to our unavailability</li>
                    <li>Significant delay not caused by the customer</li>
                    <li>Damaged or lost items (subject to our claims process)</li>
                </ul>
                
                <h2>Liability and Insurance</h2>
                <p>IPATE Deliveries provides limited insurance coverage for items during transit. This coverage is subject to certain limitations and exclusions. For high-value items, we recommend obtaining additional insurance.</p>
                <p>Our liability for any claim related to our Services is limited to the lesser of: (a) the amount paid for the specific delivery, or (b) KSh 10,000.</p>
                
                <h2>Intellectual Property</h2>
                <p>All content, features, and functionality of our Services, including but not limited to text, graphics, logos, and software, are the exclusive property of IPATE Deliveries and are protected by copyright, trademark, and other laws.</p>
                
                <h2>Termination</h2>
                <p>We may suspend or terminate your access to our Services at any time for any reason, including if you violate these Terms. You may terminate your account at any time by contacting us.</p>
                
                <h2>Dispute Resolution</h2>
                <p>Any disputes arising from these Terms or your use of our Services shall be resolved through negotiation in good faith. If negotiation fails, disputes shall be submitted to mediation in Nairobi, Kenya.</p>
                
                <h2>Governing Law</h2>
                <p>These Terms shall be governed by and construed in accordance with the laws of Kenya, without regard to its conflict of law provisions.</p>
                
                <h2>Changes to Terms</h2>
                <p>We reserve the right to modify these Terms at any time. We will notify you of material changes by posting the updated Terms on our website. Your continued use of our Services after such changes constitutes acceptance of the updated Terms.</p>
                
                <h2>Contact Information</h2>
                <p>If you have any questions about these Terms, please contact us:</p>
                <ul>
                    <li>By email: legal@ipatedeliveries.com</li>
                    <li>By phone: +254 748 894 671</li>
                    <li>By mail: IPATE Deliveries, Nairobi, Kenya</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Customer Dashboard -->
    <div class="page dashboard" id="customerDashboard">
        <div class="dashboard-header">
            <div class="container">
                <div class="dashboard-nav">
                    <div class="logo">
                        <i class="fas fa-truck-fast logo-icon"></i>
                        <span class="logo-text">IPATE Deliveries</span>
                    </div>
                    <div class="user-info">
                        <div class="user-avatar" id="customerAvatar">U</div>
                        <div>
                            <div id="customerName">User</div>
                            <div style="font-size: 12px; opacity: 0.8;">Customer</div>
                        </div>
                        <button class="btn btn-outline btn-sm" id="customerLogoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="dashboard-content">
                <h2 style="color: white; margin-bottom: 30px;">Welcome back, <span id="customerWelcomeName">User</span>!</h2>
                
                <div class="dashboard-nav-links">
                    <a href="#" class="dashboard-nav-link active" data-section="products">Products</a>
                    <a href="#" class="dashboard-nav-link" data-section="cart">My Cart</a>
                    <a href="#" class="dashboard-nav-link" data-section="orders">My Orders</a>
                    <a href="#" class="dashboard-nav-link" data-section="profile">Profile</a>
                </div>

                <!-- Products Section -->
                <div class="dashboard-section active" id="productsSection">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="customerTotalOrders">0</div>
                            <div class="stat-label">Total Orders</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="customerPendingOrders">0</div>
                            <div class="stat-label">Pending Orders</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="customerDeliveredOrders">0</div>
                            <div class="stat-label">Delivered Orders</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="customerCartItems">0</div>
                            <div class="stat-label">Items in Cart</div>
                        </div>
                    </div>

                    <h3 style="color: white; margin-bottom: 20px;">Available Products</h3>
                    <div class="products-grid" id="customerProductsGrid">
                        <!-- Products will be loaded here -->
                    </div>
                </div>

                <!-- Cart Section -->
                <div class="dashboard-section" id="cartSection">
                    <h3 style="color: white; margin-bottom: 20px;">My Cart</h3>
                    <div class="cart-items" id="customerCartItems">
                        <!-- Cart items will be loaded here -->
                    </div>
                    <div class="cart-summary" id="customerCartSummary">
                        <!-- Cart summary will be loaded here -->
                    </div>
                </div>

                <!-- Orders Section -->
                <div class="dashboard-section" id="ordersSection">
                    <h3 style="color: white; margin-bottom: 20px;">My Orders</h3>
                    <div class="orders-list" id="customerOrdersList">
                        <!-- Orders will be loaded here -->
                    </div>
                </div>

                <!-- Profile Section -->
                <div class="dashboard-section" id="profileSection">
                    <h3 style="color: white; margin-bottom: 20px;">My Profile</h3>
                    <div class="profile-form">
                        <div class="form-group">
                            <label for="customerProfileName">Full Name</label>
                            <input type="text" id="customerProfileName" class="form-control" placeholder="Enter your full name" autocomplete="name">
                        </div>
                        <div class="form-group">
                            <label for="customerProfileEmail">Email</label>
                            <input type="email" id="customerProfileEmail" class="form-control" placeholder="Enter your email" readonly autocomplete="email">
                        </div>
                        <div class="form-group">
                            <label for="customerProfilePhone">Phone Number</label>
                            <input type="tel" id="customerProfilePhone" class="form-control" placeholder="Enter your phone number" autocomplete="tel">
                        </div>
                        <div class="form-group">
                            <label for="customerProfileAddress">Delivery Address</label>
                            <textarea id="customerProfileAddress" class="form-control" placeholder="Enter your delivery address" rows="3" autocomplete="street-address"></textarea>
                        </div>
                        <button class="btn btn-primary" id="customerProfileSaveBtn">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Seller Dashboard -->
    <div class="page dashboard" id="sellerDashboard">
        <div class="dashboard-header">
            <div class="container">
                <div class="dashboard-nav">
                    <div class="logo">
                        <i class="fas fa-truck-fast logo-icon"></i>
                        <span class="logo-text">IPATE Deliveries</span>
                    </div>
                    <div class="user-info">
                        <div class="user-avatar" id="sellerAvatar">S</div>
                        <div>
                            <div id="sellerName">Seller</div>
                            <div style="font-size: 12px; opacity: 0.8;">Seller</div>
                        </div>
                        <button class="btn btn-outline btn-sm" id="sellerLogoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="dashboard-content">
                <h2 style="color: white; margin-bottom: 30px;">Seller Dashboard</h2>
                
                <div class="dashboard-nav-links">
                    <a href="#" class="dashboard-nav-link active" data-section="products">Products</a>
                    <a href="#" class="dashboard-nav-link" data-section="orders">Orders</a>
                    <a href="#" class="dashboard-nav-link" data-section="profile">Profile</a>
                </div>

                <!-- Products Section -->
                <div class="dashboard-section active" id="sellerProductsSection">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="sellerTotalProducts">0</div>
                            <div class="stat-label">Total Products</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="sellerTotalOrders">0</div>
                            <div class="stat-label">Total Orders</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="sellerPendingOrders">0</div>
                            <div class="stat-label">Pending Orders</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="sellerRevenue">KSh 0</div>
                            <div class="stat-label">Total Revenue</div>
                        </div>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center; margin: 30px 0;">
                        <h3 style="color: white;">My Products</h3>
                        <button class="btn btn-primary" id="addProductBtn">
                            <i class="fas fa-plus"></i> Add Product
                        </button>
                    </div>

                    <div class="products-grid" id="sellerProductsGrid">
                        <!-- Seller products will be loaded here -->
                    </div>
                </div>

                <!-- Orders Section -->
                <div class="dashboard-section" id="sellerOrdersSection">
                    <h3 style="color: white; margin-bottom: 20px;">Recent Orders</h3>
                    <div class="orders-list" id="sellerOrdersList">
                        <!-- Seller orders will be loaded here -->
                    </div>
                </div>

                <!-- Profile Section -->
                <div class="dashboard-section" id="sellerProfileSection">
                    <h3 style="color: white; margin-bottom: 20px;">Seller Profile</h3>
                    <div class="profile-form">
                        <div class="form-group">
                            <label for="sellerProfileName">Business Name</label>
                            <input type="text" id="sellerProfileName" class="form-control" placeholder="Enter your business name" autocomplete="organization">
                        </div>
                        <div class="form-group">
                            <label for="sellerProfileEmail">Email</label>
                            <input type="email" id="sellerProfileEmail" class="form-control" placeholder="Enter your email" readonly autocomplete="email">
                        </div>
                        <div class="form-group">
                            <label for="sellerProfilePhone">Phone Number</label>
                            <input type="tel" id="sellerProfilePhone" class="form-control" placeholder="Enter your phone number" autocomplete="tel">
                        </div>
                        <div class="form-group">
                            <label for="sellerProfileAddress">Business Address</label>
                            <textarea id="sellerProfileAddress" class="form-control" placeholder="Enter your business address" rows="3" autocomplete="street-address"></textarea>
                        </div>
                        <button class="btn btn-primary" id="sellerProfileSaveBtn">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Rider Dashboard -->
    <div class="page dashboard" id="riderDashboard">
        <div class="dashboard-header">
            <div class="container">
                <div class="dashboard-nav">
                    <div class="logo">
                        <i class="fas fa-truck-fast logo-icon"></i>
                        <span class="logo-text">IPATE Deliveries</span>
                    </div>
                    <div class="user-info">
                        <div class="user-avatar" id="riderAvatar">R</div>
                        <div>
                            <div id="riderName">Rider</div>
                            <div style="font-size: 12px; opacity: 0.8;">Rider</div>
                        </div>
                        <button class="btn btn-outline btn-sm" id="riderLogoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="dashboard-content">
                <h2 style="color: white; margin-bottom: 30px;">Rider Dashboard</h2>
                
                <div class="dashboard-nav-links">
                    <a href="#" class="dashboard-nav-link active" data-section="active">Active Deliveries</a>
                    <a href="#" class="dashboard-nav-link" data-section="history">Delivery History</a>
                    <a href="#" class="dashboard-nav-link" data-section="earnings">Earnings</a>
                    <a href="#" class="dashboard-nav-link" data-section="profile">Profile</a>
                </div>

                <!-- Active Deliveries Section -->
                <div class="dashboard-section active" id="activeSection">
                    <div class="status-toggle">
                        <div>
                            <h3 style="color: white; margin-bottom: 10px;">Availability Status</h3>
                            <p style="color: rgba(255, 255, 255, 0.8);">Toggle your availability to receive delivery requests</p>
                        </div>
                        <div class="toggle-container">
                            <span id="riderStatusText" style="font-weight: bold;">Offline</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="riderAvailabilityToggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="riderTodayDeliveries">0</div>
                            <div class="stat-label">Today's Deliveries</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="riderActiveDeliveries">0</div>
                            <div class="stat-label">Active Deliveries</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="riderCompletedDeliveries">0</div>
                            <div class="stat-label">Completed Deliveries</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="riderTodayEarnings">KSh 0</div>
                            <div class="stat-label">Today's Earnings</div>
                        </div>
                    </div>

                    <h3 style="color: white; margin: 30px 0 20px;">Active Deliveries</h3>
                    <div class="orders-list" id="riderActiveDeliveriesList">
                        <!-- Active deliveries will be loaded here -->
                    </div>
                </div>

                <!-- History Section -->
                <div class="dashboard-section" id="historySection">
                    <h3 style="color: white; margin-bottom: 20px;">Delivery History</h3>
                    <div class="orders-list" id="riderDeliveryHistory">
                        <!-- Delivery history will be loaded here -->
                    </div>
                </div>

                <!-- Earnings Section -->
                <div class="dashboard-section" id="earningsSection">
                    <h3 style="color: white; margin-bottom: 20px;">Earnings Overview</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="riderTotalEarnings">KSh 0</div>
                            <div class="stat-label">Total Earnings</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="riderThisWeekEarnings">KSh 0</div>
                            <div class="stat-label">This Week</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="riderThisMonthEarnings">KSh 0</div>
                            <div class="stat-label">This Month</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="riderAvgDeliveryEarnings">KSh 0</div>
                            <div class="stat-label">Avg. per Delivery</div>
                        </div>
                    </div>
                </div>

                <!-- Profile Section -->
                <div class="dashboard-section" id="riderProfileSection">
                    <h3 style="color: white; margin-bottom: 20px;">Rider Profile</h3>
                    <div class="profile-form">
                        <div class="form-group">
                            <label for="riderProfileName">Full Name</label>
                            <input type="text" id="riderProfileName" class="form-control" placeholder="Enter your full name" autocomplete="name">
                        </div>
                        <div class="form-group">
                            <label for="riderProfileEmail">Email</label>
                            <input type="email" id="riderProfileEmail" class="form-control" placeholder="Enter your email" readonly autocomplete="email">
                        </div>
                        <div class="form-group">
                            <label for="riderProfilePhone">Phone Number</label>
                            <input type="tel" id="riderProfilePhone" class="form-control" placeholder="Enter your phone number" autocomplete="tel">
                        </div>
                        <div class="form-group">
                            <label for="riderProfileVehicle">Vehicle Type</label>
                            <select id="riderProfileVehicle" class="form-control">
                                <option value="motorcycle">Motorcycle</option>
                                <option value="bicycle">Bicycle</option>
                                <option value="car">Car</option>
                                <option value="walking">Walking</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="riderProfileLicense">License Number</label>
                            <input type="text" id="riderProfileLicense" class="form-control" placeholder="Enter your license number">
                        </div>
                        <button class="btn btn-primary" id="riderProfileSaveBtn">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <span class="close-modal" id="closeAuthModal">&times;</span>
            <div class="auth-tabs">
                <div class="auth-tab active" id="loginTab">Login</div>
                <div class="auth-tab" id="signupTab">Sign Up</div>
            </div>
            <form class="auth-form active" id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" class="form-control" placeholder="Enter your email" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" class="form-control" placeholder="Enter your password" required autocomplete="current-password">
                </div>
                <button type="submit" class="btn btn-primary btn-block">Login</button>
            </form>
            <form class="auth-form" id="signupForm">
                <div class="form-group">
                    <label for="signupName">Full Name</label>
                    <input type="text" id="signupName" class="form-control" placeholder="Enter your full name" required autocomplete="name">
                </div>
                <div class="form-group">
                    <label for="signupEmail">Email</label>
                    <input type="email" id="signupEmail" class="form-control" placeholder="Enter your email" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" class="form-control" placeholder="Create a password" required autocomplete="new-password">
                </div>
                <div class="form-group">
                    <label for="userRole">Account Type</label>
                    <select id="userRole" class="form-control" required>
                        <option value="">Select account type</option>
                        <option value="customer">Customer</option>
                        <option value="seller">Seller</option>
                        <option value="rider">Rider</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Create Account</button>
            </form>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div class="modal" id="addProductModal">
        <div class="modal-content">
            <span class="close-modal" id="closeAddProductModal">&times;</span>
            <h3 style="color: white; margin-bottom: 25px;">Add New Product</h3>
            <form id="addProductForm">
                <div class="form-group">
                    <label for="productName">Product Name</label>
                    <input type="text" id="productName" class="form-control" placeholder="Enter product name" required>
                </div>
                <div class="form-group">
                    <label for="productDescription">Description</label>
                    <textarea id="productDescription" class="form-control" placeholder="Enter product description" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label for="productPrice">Price (KSh)</label>
                    <input type="number" id="productPrice" class="form-control" placeholder="Enter product price" min="1" required>
                </div>
                <div class="form-group">
                    <label for="productCategory">Category</label>
                    <select id="productCategory" class="form-control" required>
                        <option value="">Select category</option>
                        <option value="food">Food</option>
                        <option value="electronics">Electronics</option>
                        <option value="clothing">Clothing</option>
                        <option value="books">Books</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="productStock">Stock Quantity</label>
                    <input type="number" id="productStock" class="form-control" placeholder="Enter stock quantity" min="1" required>
                </div>
                <div class="form-group" style="margin-top: 25px;">
                    <button type="submit" class="btn btn-primary btn-block">Add Product</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div class="modal" id="checkoutModal">
        <div class="modal-content">
            <span class="close-modal" id="closeCheckoutModal">&times;</span>
            <h3 style="color: white; margin-bottom: 25px;">Checkout</h3>
            <div class="checkout-summary" id="checkoutSummary">
                <!-- Checkout summary will be loaded here -->
            </div>
            <div class="mpesa-payment-container">
                <div class="mpesa-steps">
                    <div class="mpesa-step active">
                        <div class="step-number">1</div>
                        <div class="step-label">Details</div>
                    </div>
                    <div class="mpesa-step">
                        <div class="step-number">2</div>
                        <div class="step-label">Payment</div>
                    </div>
                    <div class="mpesa-step">
                        <div class="step-number">3</div>
                        <div class="step-label">Confirm</div>
                    </div>
                </div>

                <form class="mpesa-form active" id="mpesaDetailsForm">
                    <div class="form-group">
                        <label for="deliveryAddress">Delivery Address</label>
                        <textarea id="deliveryAddress" class="form-control" placeholder="Enter your delivery address" rows="3" required autocomplete="street-address"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="deliveryInstructions">Delivery Instructions (Optional)</label>
                        <textarea id="deliveryInstructions" class="form-control" placeholder="Any special instructions for the rider?" rows="2"></textarea>
                    </div>
                    <div class="mpesa-payment-actions">
                        <button type="button" class="btn btn-outline" id="backToCartBtn">Back to Cart</button>
                        <button type="button" class="btn btn-primary" id="proceedToPaymentBtn">Proceed to Payment</button>
                    </div>
                </form>

                <form class="mpesa-form" id="mpesaPaymentForm">
                    <div class="form-group">
                        <label for="mpesaPhone">M-PESA Phone Number</label>
                        <div class="mpesa-phone-input">
                            <select id="mpesaCountryCode">
                                <option value="+254">+254</option>
                            </select>
                            <input type="tel" id="mpesaPhone" class="form-control" placeholder="7XX XXX XXX" required autocomplete="tel">
                        </div>
                        <p style="font-size: 14px; color: rgba(255, 255, 255, 0.7); margin-top: 10px;">
                            You will receive a prompt on your phone to complete the payment.
                        </p>
                    </div>
                    <div class="mpesa-payment-actions">
                        <button type="button" class="btn btn-outline" id="backToDetailsBtn">Back</button>
                        <button type="submit" class="btn btn-primary">Pay with M-PESA</button>
                    </div>
                </form>

                <div class="payment-success" id="paymentSuccess">
                    <i class="fas fa-check-circle"></i>
                    <h3>Payment Successful!</h3>
                    <p>Your order has been placed successfully.</p>
                    <p>Order ID: <strong id="successOrderId">#12345</strong></p>
                    <div class="mpesa-payment-actions" style="margin-top: 30px;">
                        <button type="button" class="btn btn-primary" id="viewOrderBtn">View Order</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://xbwvsswycdskxkorharu.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhid3Zzc3d5Y2Rza3hrb3JoYXJ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIyNDI4MjcsImV4cCI6MjA3NzgxODgyN30.8PWNCjErZ4194dBT48ph4PyMWTO0EqLsZIDK8j2O1yc';
        
        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Global State
        let currentUser = null;
        let userRole = null;
        
        // DOM Elements
        const elements = {
            // Pages
            landingPage: document.getElementById('landingPage'),
            customerDashboard: document.getElementById('customerDashboard'),
            sellerDashboard: document.getElementById('sellerDashboard'),
            riderDashboard: document.getElementById('riderDashboard'),
            learnMorePage: document.getElementById('learnMorePage'),
            privacyPolicyPage: document.getElementById('privacyPolicyPage'),
            termsOfServicePage: document.getElementById('termsOfServicePage'),
            
            // Authentication
            authModal: document.getElementById('authModal'),
            loginTab: document.getElementById('loginTab'),
            signupTab: document.getElementById('signupTab'),
            loginForm: document.getElementById('loginForm'),
            signupForm: document.getElementById('signupForm'),
            closeAuthModal: document.getElementById('closeAuthModal'),
            loginBtn: document.getElementById('loginBtn'),
            signupBtn: document.getElementById('signupBtn'),
            getStartedBtn: document.getElementById('getStartedBtn'),
            
            // Customer Dashboard
            customerProductsGrid: document.getElementById('customerProductsGrid'),
            customerCartItems: document.getElementById('customerCartItems'),
            customerCartSummary: document.getElementById('customerCartSummary'),
            customerOrdersList: document.getElementById('customerOrdersList'),
            customerLogoutBtn: document.getElementById('customerLogoutBtn'),
            customerWelcomeName: document.getElementById('customerWelcomeName'),
            customerName: document.getElementById('customerName'),
            customerAvatar: document.getElementById('customerAvatar'),
            customerTotalOrders: document.getElementById('customerTotalOrders'),
            customerPendingOrders: document.getElementById('customerPendingOrders'),
            customerDeliveredOrders: document.getElementById('customerDeliveredOrders'),
            customerCartItemsCount: document.getElementById('customerCartItems'),
            customerProfileSaveBtn: document.getElementById('customerProfileSaveBtn'),
            
            // Seller Dashboard
            sellerProductsGrid: document.getElementById('sellerProductsGrid'),
            sellerOrdersList: document.getElementById('sellerOrdersList'),
            sellerLogoutBtn: document.getElementById('sellerLogoutBtn'),
            sellerName: document.getElementById('sellerName'),
            sellerAvatar: document.getElementById('sellerAvatar'),
            sellerTotalProducts: document.getElementById('sellerTotalProducts'),
            sellerTotalOrders: document.getElementById('sellerTotalOrders'),
            sellerPendingOrders: document.getElementById('sellerPendingOrders'),
            sellerRevenue: document.getElementById('sellerRevenue'),
            addProductBtn: document.getElementById('addProductBtn'),
            sellerProfileSaveBtn: document.getElementById('sellerProfileSaveBtn'),
            
            // Rider Dashboard
            riderActiveDeliveriesList: document.getElementById('riderActiveDeliveriesList'),
            riderDeliveryHistory: document.getElementById('riderDeliveryHistory'),
            riderLogoutBtn: document.getElementById('riderLogoutBtn'),
            riderName: document.getElementById('riderName'),
            riderAvatar: document.getElementById('riderAvatar'),
            riderTodayDeliveries: document.getElementById('riderTodayDeliveries'),
            riderActiveDeliveries: document.getElementById('riderActiveDeliveries'),
            riderCompletedDeliveries: document.getElementById('riderCompletedDeliveries'),
            riderTodayEarnings: document.getElementById('riderTodayEarnings'),
            riderAvailabilityToggle: document.getElementById('riderAvailabilityToggle'),
            riderStatusText: document.getElementById('riderStatusText'),
            riderTotalEarnings: document.getElementById('riderTotalEarnings'),
            riderThisWeekEarnings: document.getElementById('riderThisWeekEarnings'),
            riderThisMonthEarnings: document.getElementById('riderThisMonthEarnings'),
            riderAvgDeliveryEarnings: document.getElementById('riderAvgDeliveryEarnings'),
            riderProfileSaveBtn: document.getElementById('riderProfileSaveBtn'),
            
            // Modals
            addProductModal: document.getElementById('addProductModal'),
            closeAddProductModal: document.getElementById('closeAddProductModal'),
            addProductForm: document.getElementById('addProductForm'),
            checkoutModal: document.getElementById('checkoutModal'),
            closeCheckoutModal: document.getElementById('closeCheckoutModal'),
            checkoutSummary: document.getElementById('checkoutSummary'),
            
            // MPESA Payment
            mpesaDetailsForm: document.getElementById('mpesaDetailsForm'),
            mpesaPaymentForm: document.getElementById('mpesaPaymentForm'),
            paymentSuccess: document.getElementById('paymentSuccess'),
            backToCartBtn: document.getElementById('backToCartBtn'),
            proceedToPaymentBtn: document.getElementById('proceedToPaymentBtn'),
            backToDetailsBtn: document.getElementById('backToDetailsBtn'),
            viewOrderBtn: document.getElementById('viewOrderBtn'),
            
            // Loading Spinner
            loadingSpinner: document.getElementById('loadingSpinner'),
            
            // Notification
            notification: document.getElementById('notification'),
            notificationTitle: document.getElementById('notificationTitle'),
            notificationMessage: document.getElementById('notificationMessage')
        };
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            checkAuthState();
        });
        
        // Initialize the application
        async function initializeApp() {
            await initializeSampleData();
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Authentication
            elements.loginBtn.addEventListener('click', () => showAuthModal('login'));
            elements.signupBtn.addEventListener('click', () => showAuthModal('signup'));
            elements.getStartedBtn.addEventListener('click', () => showAuthModal('signup'));
            elements.closeAuthModal.addEventListener('click', () => hideAuthModal());
            elements.loginTab.addEventListener('click', () => switchAuthTab('login'));
            elements.signupTab.addEventListener('click', () => switchAuthTab('signup'));
            elements.loginForm.addEventListener('submit', handleLogin);
            elements.signupForm.addEventListener('submit', handleSignup);
            
            // Dashboard Navigation
            document.querySelectorAll('.dashboard-nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    switchDashboardSection(section);
                });
            });
            
            // Logout buttons
            elements.customerLogoutBtn.addEventListener('click', handleLogout);
            elements.sellerLogoutBtn.addEventListener('click', handleLogout);
            elements.riderLogoutBtn.addEventListener('click', handleLogout);
            
            // Product Management
            elements.addProductBtn.addEventListener('click', () => showAddProductModal());
            elements.closeAddProductModal.addEventListener('click', () => hideAddProductModal());
            elements.addProductForm.addEventListener('submit', handleAddProduct);
            
            // MPESA Payment
            elements.proceedToPaymentBtn.addEventListener('click', proceedToPayment);
            elements.backToDetailsBtn.addEventListener('click', backToDetails);
            elements.backToCartBtn.addEventListener('click', backToCart);
            elements.mpesaPaymentForm.addEventListener('submit', handleMpesaPayment);
            elements.viewOrderBtn.addEventListener('click', viewOrderAfterPayment);
            
            // Rider Availability Toggle
            elements.riderAvailabilityToggle.addEventListener('change', toggleRiderAvailability);
            
            // Profile Save Buttons
            elements.customerProfileSaveBtn.addEventListener('click', saveCustomerProfile);
            elements.sellerProfileSaveBtn.addEventListener('click', saveSellerProfile);
            elements.riderProfileSaveBtn.addEventListener('click', saveRiderProfile);
            
            // Page Navigation
            document.getElementById('learnMoreBtn').addEventListener('click', showLearnMorePage);
            document.getElementById('learnMoreLink').addEventListener('click', showLearnMorePage);
            document.getElementById('learnMoreLinkFooter').addEventListener('click', showLearnMorePage);
            document.getElementById('privacyLinkFooter').addEventListener('click', showPrivacyPolicyPage);
            document.getElementById('termsLinkFooter').addEventListener('click', showTermsOfServicePage);
            
            // Back buttons
            document.getElementById('backFromLearnMore').addEventListener('click', function(e) {
                e.preventDefault();
                showLandingPage();
            });
            
            document.getElementById('backFromPrivacy').addEventListener('click', function(e) {
                e.preventDefault();
                showLandingPage();
            });
            
            document.getElementById('backFromTerms').addEventListener('click', function(e) {
                e.preventDefault();
                showLandingPage();
            });
            
            // Get started from learn more page
            document.getElementById('getStartedFromLearnMore').addEventListener('click', function() {
                showLandingPage();
                document.getElementById('getStartedBtn').click();
            });
            
            // FAQ functionality
            setupFAQ();
        }
        
        // Check authentication state
        async function checkAuthState() {
            try {
                const { data: { user } } = await supabase.auth.getUser();
                
                if (user) {
                    currentUser = user;
                    
                    // Get user profile from database
                    const { data: profile, error } = await supabase
                        .from('profiles')
                        .select('*')
                        .eq('id', user.id)
                        .single();
                    
                    if (error) {
                        console.error('Error fetching user profile:', error);
                        // Create profile if it doesn't exist
                        await createUserProfile(user);
                        userRole = 'customer'; // Default role
                    } else {
                        userRole = profile.role;
                    }
                    
                    // Update UI based on role
                    switch (userRole) {
                        case 'customer':
                            showCustomerDashboard();
                            elements.customerWelcomeName.textContent = profile?.name || user.email;
                            elements.customerName.textContent = profile?.name || user.email;
                            elements.customerAvatar.textContent = (profile?.name || user.email).charAt(0).toUpperCase();
                            loadCustomerData();
                            break;
                        case 'seller':
                            showSellerDashboard();
                            elements.sellerName.textContent = profile?.name || user.email;
                            elements.sellerAvatar.textContent = (profile?.name || user.email).charAt(0).toUpperCase();
                            loadSellerData();
                            break;
                        case 'rider':
                            showRiderDashboard();
                            elements.riderName.textContent = profile?.name || user.email;
                            elements.riderAvatar.textContent = (profile?.name || user.email).charAt(0).toUpperCase();
                            loadRiderData();
                            break;
                    }
                }
            } catch (error) {
                console.error('Error checking auth state:', error);
            }
        }
        
        // Create user profile
        async function createUserProfile(user) {
            const { data, error } = await supabase
                .from('profiles')
                .insert([
                    {
                        id: user.id,
                        name: user.user_metadata?.name || user.email,
                        email: user.email,
                        role: user.user_metadata?.role || 'customer'
                    }
                ])
                .select()
                .single();
            
            if (error) {
                console.error('Error creating user profile:', error);
            } else {
                return data;
            }
        }
        
        // Initialize sample data in Supabase
        async function initializeSampleData() {
            // Check if products already exist
            const { data: existingProducts, error } = await supabase
                .from('products')
                .select('*')
                .limit(1);
            
            if (error || existingProducts.length === 0) {
                // Create sample products
                const sampleProducts = [
                    {
                        name: 'Fresh Groceries Package',
                        description: 'A package of fresh vegetables and fruits from local farmers.',
                        price: 1500,
                        category: 'food',
                        stock: 20,
                        seller_id: '00000000-0000-0000-0000-000000000000',
                        image_url: 'https://images.unsplash.com/photo-1542838132-92c53300491e?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'
                    },
                    {
                        name: 'Smartphone',
                        description: 'Latest smartphone with advanced features and camera.',
                        price: 25000,
                        category: 'electronics',
                        stock: 10,
                        seller_id: '00000000-0000-0000-0000-000000000000',
                        image_url: 'https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'
                    },
                    {
                        name: 'Fashion T-Shirt',
                        description: 'Comfortable and stylish cotton t-shirt for everyday wear.',
                        price: 800,
                        category: 'clothing',
                        stock: 50,
                        seller_id: '00000000-0000-0000-0000-000000000000',
                        image_url: 'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'
                    }
                ];
                
                const { data, error } = await supabase
                    .from('products')
                    .insert(sampleProducts);
                
                if (error) {
                    console.error('Error creating sample products:', error);
                }
            }
        }
        
        // Show authentication modal
        function showAuthModal(tab) {
            elements.authModal.style.display = 'flex';
            switchAuthTab(tab);
        }
        
        // Hide authentication modal
        function hideAuthModal() {
            elements.authModal.style.display = 'none';
        }
        
        // Switch authentication tab
        function switchAuthTab(tab) {
            // Update tabs
            elements.loginTab.classList.toggle('active', tab === 'login');
            elements.signupTab.classList.toggle('active', tab === 'signup');
            
            // Update forms
            elements.loginForm.classList.toggle('active', tab === 'login');
            elements.signupForm.classList.toggle('active', tab === 'signup');
        }
        
        // Handle login
        async function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showNotification('Error', 'Please enter both email and password', 'error');
                return;
            }
            
            showLoading();
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email,
                    password
                });
                
                if (error) {
                    throw error;
                }
                
                currentUser = data.user;
                
                // Get user profile
                const { data: profile, error: profileError } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', data.user.id)
                    .single();
                
                if (profileError) {
                    console.error('Error fetching profile:', profileError);
                    userRole = 'customer'; // Default role
                } else {
                    userRole = profile.role;
                }
                
                hideLoading();
                hideAuthModal();
                showNotification('Success', 'Logged in successfully!', 'success');
                
                // Update UI based on role
                const userName = profile?.name || data.user.email;
                
                switch (userRole) {
                    case 'customer':
                        showCustomerDashboard();
                        elements.customerWelcomeName.textContent = userName;
                        elements.customerName.textContent = userName;
                        elements.customerAvatar.textContent = userName.charAt(0).toUpperCase();
                        loadCustomerData();
                        break;
                    case 'seller':
                        showSellerDashboard();
                        elements.sellerName.textContent = userName;
                        elements.sellerAvatar.textContent = userName.charAt(0).toUpperCase();
                        loadSellerData();
                        break;
                    case 'rider':
                        showRiderDashboard();
                        elements.riderName.textContent = userName;
                        elements.riderAvatar.textContent = userName.charAt(0).toUpperCase();
                        loadRiderData();
                        break;
                    default:
                        userRole = 'customer';
                        showCustomerDashboard();
                        elements.customerWelcomeName.textContent = userName;
                        elements.customerName.textContent = userName;
                        elements.customerAvatar.textContent = userName.charAt(0).toUpperCase();
                        loadCustomerData();
                }
                
            } catch (error) {
                hideLoading();
                showNotification('Error', error.message, 'error');
            }
        }
        
        // Handle signup
        async function handleSignup(e) {
            e.preventDefault();
            
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const role = document.getElementById('userRole').value;
            
            if (!name || !email || !password || !role) {
                showNotification('Error', 'Please fill in all fields', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Error', 'Password must be at least 6 characters', 'error');
                return;
            }
            
            showLoading();
            
            try {
                // Create user in Supabase Auth
                const { data, error } = await supabase.auth.signUp({
                    email,
                    password,
                    options: {
                        data: {
                            name,
                            role
                        }
                    }
                });
                
                if (error) {
                    throw error;
                }
                
                // Create user profile in database
                if (data.user) {
                    await createUserProfile(data.user);
                }
                
                hideLoading();
                hideAuthModal();
                
                if (data.user && data.user.identities && data.user.identities.length === 0) {
                    showNotification('Error', 'User already exists with this email', 'error');
                } else {
                    showNotification('Success', 'Account created successfully! Please check your email for verification.', 'success');
                    document.getElementById('signupForm').reset();
                }
                
            } catch (error) {
                hideLoading();
                showNotification('Error', error.message, 'error');
            }
        }
        
        // Handle logout
        async function handleLogout() {
            showLoading();
            
            try {
                const { error } = await supabase.auth.signOut();
                
                if (error) {
                    throw error;
                }
                
                currentUser = null;
                userRole = null;
                
                hideLoading();
                showPage('landingPage');
                showNotification('Success', 'Logged out successfully!', 'success');
            } catch (error) {
                hideLoading();
                showNotification('Error', error.message, 'error');
            }
        }
        
        // Show page
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show target page
            document.getElementById(pageId).classList.add('active');
        }
        
        // Show customer dashboard
        function showCustomerDashboard() {
            showPage('customerDashboard');
            switchDashboardSection('products');
        }
        
        // Show seller dashboard
        function showSellerDashboard() {
            showPage('sellerDashboard');
            switchDashboardSection('products');
        }
        
        // Show rider dashboard
        function showRiderDashboard() {
            showPage('riderDashboard');
            switchDashboardSection('active');
        }
        
        // New page navigation functions
        function showLearnMorePage(e) {
            if(e) e.preventDefault();
            hideAllPages();
            document.getElementById('learnMorePage').classList.add('active');
            window.scrollTo(0, 0);
        }
        
        function showPrivacyPolicyPage(e) {
            if(e) e.preventDefault();
            hideAllPages();
            document.getElementById('privacyPolicyPage').classList.add('active');
            window.scrollTo(0, 0);
        }
        
        function showTermsOfServicePage(e) {
            if(e) e.preventDefault();
            hideAllPages();
            document.getElementById('termsOfServicePage').classList.add('active');
            window.scrollTo(0, 0);
        }
        
        function showLandingPage() {
            hideAllPages();
            document.getElementById('landingPage').classList.add('active');
            window.scrollTo(0, 0);
        }
        
        function hideAllPages() {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
        }
        
        // FAQ functionality
        function setupFAQ() {
            const faqItems = document.querySelectorAll('.faq-item');
            
            faqItems.forEach(item => {
                const question = item.querySelector('.faq-question');
                
                question.addEventListener('click', () => {
                    // Close all other FAQ items
                    faqItems.forEach(otherItem => {
                        if (otherItem !== item) {
                            otherItem.classList.remove('active');
                        }
                    });
                    
                    // Toggle current item
                    item.classList.toggle('active');
                });
            });
        }
        
        // Switch dashboard section
        function switchDashboardSection(section) {
            // Get the parent dashboard
            const dashboard = document.querySelector('.page.active');
            
            // Hide all sections in this dashboard
            dashboard.querySelectorAll('.dashboard-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show target section
            document.getElementById(section + 'Section').classList.add('active');
            
            // Update active nav link
            const navLinks = dashboard.querySelectorAll('.dashboard-nav-link');
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-section') === section) {
                    link.classList.add('active');
                }
            });
            
            // Load section-specific data
            switch (section) {
                case 'products':
                    if (userRole === 'customer') loadCustomerProducts();
                    else if (userRole === 'seller') loadSellerProducts();
                    break;
                case 'cart':
                    if (userRole === 'customer') loadCustomerCart();
                    break;
                case 'orders':
                    if (userRole === 'customer') loadCustomerOrders();
                    else if (userRole === 'seller') loadSellerOrders();
                    break;
                case 'active':
                    if (userRole === 'rider') loadRiderActiveDeliveries();
                    break;
                case 'history':
                    if (userRole === 'rider') loadRiderHistory();
                    break;
                case 'earnings':
                    if (userRole === 'rider') loadRiderEarnings();
                    break;
                case 'profile':
                    if (userRole === 'customer') loadCustomerProfile();
                    else if (userRole === 'seller') loadSellerProfile();
                    else if (userRole === 'rider') loadRiderProfile();
                    break;
            }
        }
        
        // Show add product modal
        function showAddProductModal() {
            elements.addProductModal.style.display = 'flex';
        }
        
        // Hide add product modal
        function hideAddProductModal() {
            elements.addProductModal.style.display = 'none';
            elements.addProductForm.reset();
        }
        
        // Handle add product
        async function handleAddProduct(e) {
            e.preventDefault();
            
            const name = document.getElementById('productName').value;
            const description = document.getElementById('productDescription').value;
            const price = parseInt(document.getElementById('productPrice').value);
            const category = document.getElementById('productCategory').value;
            const stock = parseInt(document.getElementById('productStock').value);
            
            try {
                const { data, error } = await supabase
                    .from('products')
                    .insert([
                        {
                            name,
                            description,
                            price,
                            category,
                            stock,
                            seller_id: currentUser.id,
                            image_url: 'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'
                        }
                    ])
                    .select()
                    .single();
                
                if (error) throw error;
                
                hideAddProductModal();
                loadSellerProducts();
                showNotification('Success', 'Product added successfully!', 'success');
            } catch (error) {
                showNotification('Error', 'Failed to add product: ' + error.message, 'error');
            }
        }
        
        // Load customer data
        async function loadCustomerData() {
            await updateCustomerStats();
            await loadCustomerProducts();
        }
        
        // Update customer stats
        async function updateCustomerStats() {
            try {
                // Get customer orders
                const { data: orders, error } = await supabase
                    .from('orders')
                    .select('*')
                    .eq('customer_id', currentUser.id);
                
                if (error) throw error;
                
                const pendingOrders = orders.filter(order => order.status === 'pending' || order.status === 'accepted').length;
                const deliveredOrders = orders.filter(order => order.status === 'delivered').length;
                
                // Get cart items count
                const { data: cartItems, error: cartError } = await supabase
                    .from('cart_items')
                    .select('*')
                    .eq('user_id', currentUser.id);
                
                if (cartError) throw cartError;
                
                elements.customerTotalOrders.textContent = orders.length;
                elements.customerPendingOrders.textContent = pendingOrders;
                elements.customerDeliveredOrders.textContent = deliveredOrders;
                elements.customerCartItemsCount.textContent = cartItems.length;
            } catch (error) {
                console.error('Error updating customer stats:', error);
            }
        }
        
        // Load customer products
        async function loadCustomerProducts() {
            try {
                const { data: products, error } = await supabase
                    .from('products')
                    .select('*')
                    .gt('stock', 0);
                
                if (error) throw error;
                
                elements.customerProductsGrid.innerHTML = '';
                
                if (products.length === 0) {
                    elements.customerProductsGrid.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-box-open"></i>
                            <h3>No Products Available</h3>
                            <p>Check back later for new products.</p>
                        </div>
                    `;
                    return;
                }
                
                products.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';
                    productCard.innerHTML = `
                        <div class="product-image" style="background-image: url('${product.image_url}')">
                            <div style="position: relative; z-index: 2; text-align: center;">
                                <i class="fas fa-box" style="font-size: 48px; margin-bottom: 10px;"></i>
                                <div>${product.category}</div>
                            </div>
                        </div>
                        <div class="product-info">
                            <h4>${product.name}</h4>
                            <p>${product.description}</p>
                            <div class="product-price">KSh ${product.price.toLocaleString()}</div>
                            <div class="customer-product-actions">
                                <button class="btn btn-primary btn-sm add-to-cart-btn" data-product-id="${product.id}">
                                    <i class="fas fa-cart-plus"></i> Add to Cart
                                </button>
                            </div>
                        </div>
                    `;
                    
                    elements.customerProductsGrid.appendChild(productCard);
                });
                
                // Add event listeners to add to cart buttons
                document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const productId = this.getAttribute('data-product-id');
                        addToCart(productId);
                    });
                });
            } catch (error) {
                console.error('Error loading customer products:', error);
                showNotification('Error', 'Failed to load products', 'error');
            }
        }
        
        // Load customer cart
        async function loadCustomerCart() {
            try {
                const { data: cartItems, error } = await supabase
                    .from('cart_items')
                    .select(`
                        *,
                        products (*)
                    `)
                    .eq('user_id', currentUser.id);
                
                if (error) throw error;
                
                elements.customerCartItems.innerHTML = '';
                
                if (cartItems.length === 0) {
                    elements.customerCartItems.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-shopping-cart"></i>
                            <h3>Your Cart is Empty</h3>
                            <p>Add some products to your cart to get started.</p>
                            <button class="btn btn-primary" style="margin-top: 20px;" onclick="switchDashboardSection('products')">
                                <i class="fas fa-shopping-bag"></i> Browse Products
                            </button>
                        </div>
                    `;
                    elements.customerCartSummary.innerHTML = '';
                    return;
                }
                
                let total = 0;
                
                cartItems.forEach(item => {
                    const product = item.products;
                    const itemTotal = product.price * item.quantity;
                    total += itemTotal;
                    
                    const cartItem = document.createElement('div');
                    cartItem.className = 'cart-item';
                    cartItem.innerHTML = `
                        <div class="cart-item-info">
                            <div>
                                <h4>${product.name}</h4>
                                <p>KSh ${product.price.toLocaleString()} each</p>
                            </div>
                        </div>
                        <div class="cart-item-quantity">
                            <button class="quantity-btn decrease-quantity" data-cart-item-id="${item.id}">
                                <i class="fas fa-minus"></i>
                            </button>
                            <span>${item.quantity}</span>
                            <button class="quantity-btn increase-quantity" data-cart-item-id="${item.id}">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button class="btn btn-outline btn-sm remove-from-cart" data-cart-item-id="${item.id}" style="margin-left: 15px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="cart-item-total">
                            <strong>KSh ${itemTotal.toLocaleString()}</strong>
                        </div>
                    `;
                    
                    elements.customerCartItems.appendChild(cartItem);
                });
                
                // Add event listeners to quantity buttons
                document.querySelectorAll('.increase-quantity').forEach(button => {
                    button.addEventListener('click', function() {
                        const cartItemId = this.getAttribute('data-cart-item-id');
                        updateCartQuantity(cartItemId, 1);
                    });
                });
                
                document.querySelectorAll('.decrease-quantity').forEach(button => {
                    button.addEventListener('click', function() {
                        const cartItemId = this.getAttribute('data-cart-item-id');
                        updateCartQuantity(cartItemId, -1);
                    });
                });
                
                document.querySelectorAll('.remove-from-cart').forEach(button => {
                    button.addEventListener('click', function() {
                        const cartItemId = this.getAttribute('data-cart-item-id');
                        removeFromCart(cartItemId);
                    });
                });
                
                // Update cart summary
                elements.customerCartSummary.innerHTML = `
                    <div class="order-total">
                        Total: KSh ${total.toLocaleString()}
                    </div>
                    <button class="btn btn-primary btn-large" id="checkoutBtn" style="margin-top: 20px; width: 100%;">
                        <i class="fas fa-lock"></i> Proceed to Checkout
                    </button>
                `;
                
                document.getElementById('checkoutBtn').addEventListener('click', showCheckoutModal);
            } catch (error) {
                console.error('Error loading customer cart:', error);
                showNotification('Error', 'Failed to load cart', 'error');
            }
        }
        
        // Load customer orders
        async function loadCustomerOrders() {
            try {
                const { data: orders, error } = await supabase
                    .from('orders')
                    .select(`
                        *,
                        order_items (
                            *,
                            products (*)
                        )
                    `)
                    .eq('customer_id', currentUser.id)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                elements.customerOrdersList.innerHTML = '';
                
                if (orders.length === 0) {
                    elements.customerOrdersList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-clipboard-list"></i>
                            <h3>No Orders Yet</h3>
                            <p>Your orders will appear here once you place them.</p>
                            <button class="btn btn-primary" style="margin-top: 20px;" onclick="switchDashboardSection('products')">
                                <i class="fas fa-shopping-bag"></i> Browse Products
                            </button>
                        </div>
                    `;
                    return;
                }
                
                orders.forEach(order => {
                    const orderCard = document.createElement('div');
                    orderCard.className = 'order-card';
                    
                    let statusClass = '';
                    switch (order.status) {
                        case 'pending': statusClass = 'status-pending'; break;
                        case 'accepted': statusClass = 'status-accepted'; break;
                        case 'ready': statusClass = 'status-ready'; break;
                        case 'assigned': statusClass = 'status-assigned'; break;
                        case 'picked': statusClass = 'status-picked'; break;
                        case 'delivered': statusClass = 'status-delivered'; break;
                        case 'cancelled': statusClass = 'status-cancelled'; break;
                    }
                    
                    orderCard.innerHTML = `
                        <div class="order-header">
                            <div>
                                <h4>Order #${order.id.substring(0, 8)}</h4>
                                <p>Placed on ${new Date(order.created_at).toLocaleDateString()}</p>
                            </div>
                            <div class="order-status ${statusClass}">${order.status}</div>
                        </div>
                        <div class="order-items">
                            ${order.order_items.map(item => `
                                <div class="order-item">
                                    <div>${item.products.name} x ${item.quantity}</div>
                                    <div>KSh ${(item.price * item.quantity).toLocaleString()}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="order-total">
                            Total: KSh ${order.total.toLocaleString()}
                        </div>
                    `;
                    
                    elements.customerOrdersList.appendChild(orderCard);
                });
            } catch (error) {
                console.error('Error loading customer orders:', error);
                showNotification('Error', 'Failed to load orders', 'error');
            }
        }
        
        // Load customer profile
        async function loadCustomerProfile() {
            try {
                const { data: profile, error } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();
                
                if (error) throw error;
                
                document.getElementById('customerProfileName').value = profile.name || '';
                document.getElementById('customerProfileEmail').value = currentUser.email;
                document.getElementById('customerProfilePhone').value = profile.phone || '';
                document.getElementById('customerProfileAddress').value = profile.address || '';
            } catch (error) {
                console.error('Error loading customer profile:', error);
            }
        }
        
        // Save customer profile
        async function saveCustomerProfile() {
            const name = document.getElementById('customerProfileName').value;
            const phone = document.getElementById('customerProfilePhone').value;
            const address = document.getElementById('customerProfileAddress').value;
            
            try {
                const { data, error } = await supabase
                    .from('profiles')
                    .update({
                        name,
                        phone,
                        address
                    })
                    .eq('id', currentUser.id)
                    .select()
                    .single();
                
                if (error) throw error;
                
                elements.customerName.textContent = name;
                elements.customerWelcomeName.textContent = name;
                elements.customerAvatar.textContent = name.charAt(0).toUpperCase();
                
                showNotification('Success', 'Profile updated successfully!', 'success');
            } catch (error) {
                showNotification('Error', 'Failed to update profile: ' + error.message, 'error');
            }
        }
        
        // Load seller data
        async function loadSellerData() {
            await updateSellerStats();
            await loadSellerProducts();
        }
        
        // Update seller stats
        async function updateSellerStats() {
            try {
                // Get seller products
                const { data: products, error: productsError } = await supabase
                    .from('products')
                    .select('*')
                    .eq('seller_id', currentUser.id);
                
                if (productsError) throw productsError;
                
                // Get seller orders
                const { data: orders, error: ordersError } = await supabase
                    .from('orders')
                    .select(`
                        *,
                        order_items (
                            *,
                            products (*)
                        )
                    `);
                
                if (ordersError) throw ordersError;
                
                // Filter orders that contain seller's products
                const sellerOrders = orders.filter(order => 
                    order.order_items.some(item => 
                        products.some(product => product.id === item.product_id)
                    )
                );
                
                const pendingOrders = sellerOrders.filter(order => 
                    order.status === 'pending' || order.status === 'accepted'
                ).length;
                
                const revenue = sellerOrders
                    .filter(order => order.status === 'delivered')
                    .reduce((total, order) => {
                        const sellerItems = order.order_items.filter(item => 
                            products.some(product => product.id === item.product_id)
                        );
                        return total + sellerItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                    }, 0);
                
                elements.sellerTotalProducts.textContent = products.length;
                elements.sellerTotalOrders.textContent = sellerOrders.length;
                elements.sellerPendingOrders.textContent = pendingOrders;
                elements.sellerRevenue.textContent = `KSh ${revenue.toLocaleString()}`;
            } catch (error) {
                console.error('Error updating seller stats:', error);
            }
        }
        
        // Load seller products
        async function loadSellerProducts() {
            try {
                const { data: products, error } = await supabase
                    .from('products')
                    .select('*')
                    .eq('seller_id', currentUser.id)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                elements.sellerProductsGrid.innerHTML = '';
                
                if (products.length === 0) {
                    elements.sellerProductsGrid.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-box-open"></i>
                            <h3>No Products Yet</h3>
                            <p>Add your first product to start selling.</p>
                            <button class="btn btn-primary" style="margin-top: 20px;" onclick="showAddProductModal()">
                                <i class="fas fa-plus"></i> Add Product
                            </button>
                        </div>
                    `;
                    return;
                }
                
                products.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';
                    productCard.innerHTML = `
                        <div class="product-image" style="background-image: url('${product.image_url}')">
                            <div style="position: relative; z-index: 2; text-align: center;">
                                <i class="fas fa-box" style="font-size: 48px; margin-bottom: 10px;"></i>
                                <div>${product.category}</div>
                            </div>
                        </div>
                        <div class="product-info">
                            <h4>${product.name}</h4>
                            <p>${product.description}</p>
                            <div class="product-price">KSh ${product.price.toLocaleString()}</div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                                <span>Stock: ${product.stock}</span>
                                <button class="btn btn-outline btn-sm edit-product-btn" data-product-id="${product.id}">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                            </div>
                        </div>
                    `;
                    
                    elements.sellerProductsGrid.appendChild(productCard);
                });
            } catch (error) {
                console.error('Error loading seller products:', error);
                showNotification('Error', 'Failed to load products', 'error');
            }
        }
        
        // Load seller orders
        async function loadSellerOrders() {
            try {
                // Get seller products
                const { data: products, error: productsError } = await supabase
                    .from('products')
                    .select('*')
                    .eq('seller_id', currentUser.id);
                
                if (productsError) throw productsError;
                
                // Get all orders
                const { data: orders, error: ordersError } = await supabase
                    .from('orders')
                    .select(`
                        *,
                        order_items (
                            *,
                            products (*)
                        ),
                        profiles!orders_customer_id_fkey (name)
                    `)
                    .order('created_at', { ascending: false });
                
                if (ordersError) throw ordersError;
                
                // Filter orders that contain seller's products
                const sellerOrders = orders.filter(order => 
                    order.order_items.some(item => 
                        products.some(product => product.id === item.product_id)
                    )
                );
                
                elements.sellerOrdersList.innerHTML = '';
                
                if (sellerOrders.length === 0) {
                    elements.sellerOrdersList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-clipboard-list"></i>
                            <h3>No Orders Yet</h3>
                            <p>Your orders will appear here once customers place them.</p>
                        </div>
                    `;
                    return;
                }
                
                sellerOrders.forEach(order => {
                    const orderCard = document.createElement('div');
                    orderCard.className = 'order-card';
                    
                    let statusClass = '';
                    switch (order.status) {
                        case 'pending': statusClass = 'status-pending'; break;
                        case 'accepted': statusClass = 'status-accepted'; break;
                        case 'ready': statusClass = 'status-ready'; break;
                        case 'assigned': statusClass = 'status-assigned'; break;
                        case 'picked': statusClass = 'status-picked'; break;
                        case 'delivered': statusClass = 'status-delivered'; break;
                        case 'cancelled': statusClass = 'status-cancelled'; break;
                    }
                    
                    // Filter items that belong to this seller
                    const sellerItems = order.order_items.filter(item => 
                        products.some(product => product.id === item.product_id)
                    );
                    
                    const sellerTotal = sellerItems.reduce((total, item) => total + (item.price * item.quantity), 0);
                    
                    orderCard.innerHTML = `
                        <div class="order-header">
                            <div>
                                <h4>Order #${order.id.substring(0, 8)}</h4>
                                <p>Customer: ${order.profiles.name}</p>
                                <p>Placed on ${new Date(order.created_at).toLocaleDateString()}</p>
                            </div>
                            <div class="order-status ${statusClass}">${order.status}</div>
                        </div>
                        <div class="order-items">
                            ${sellerItems.map(item => `
                                <div class="order-item">
                                    <div>${item.products.name} x ${item.quantity}</div>
                                    <div>KSh ${(item.price * item.quantity).toLocaleString()}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="order-total">
                            Your Total: KSh ${sellerTotal.toLocaleString()}
                        </div>
                        <div style="margin-top: 15px;">
                            <button class="btn btn-primary btn-sm update-order-status" data-order-id="${order.id}">
                                <i class="fas fa-edit"></i> Update Status
                            </button>
                        </div>
                    `;
                    
                    elements.sellerOrdersList.appendChild(orderCard);
                });
                
                // Add event listeners to update order status buttons
                document.querySelectorAll('.update-order-status').forEach(button => {
                    button.addEventListener('click', function() {
                        const orderId = this.getAttribute('data-order-id');
                        updateOrderStatus(orderId);
                    });
                });
            } catch (error) {
                console.error('Error loading seller orders:', error);
                showNotification('Error', 'Failed to load orders', 'error');
            }
        }
        
        // Load seller profile
        async function loadSellerProfile() {
            try {
                const { data: profile, error } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();
                
                if (error) throw error;
                
                document.getElementById('sellerProfileName').value = profile.name || '';
                document.getElementById('sellerProfileEmail').value = currentUser.email;
                document.getElementById('sellerProfilePhone').value = profile.phone || '';
                document.getElementById('sellerProfileAddress').value = profile.address || '';
            } catch (error) {
                console.error('Error loading seller profile:', error);
            }
        }
        
        // Save seller profile
        async function saveSellerProfile() {
            const name = document.getElementById('sellerProfileName').value;
            const phone = document.getElementById('sellerProfilePhone').value;
            const address = document.getElementById('sellerProfileAddress').value;
            
            try {
                const { data, error } = await supabase
                    .from('profiles')
                    .update({
                        name,
                        phone,
                        address
                    })
                    .eq('id', currentUser.id)
                    .select()
                    .single();
                
                if (error) throw error;
                
                elements.sellerName.textContent = name;
                elements.sellerAvatar.textContent = name.charAt(0).toUpperCase();
                
                showNotification('Success', 'Profile updated successfully!', 'success');
            } catch (error) {
                showNotification('Error', 'Failed to update profile: ' + error.message, 'error');
            }
        }
        
        // Load rider data
        async function loadRiderData() {
            await updateRiderStats();
            await loadRiderActiveDeliveries();
        }
        
        // Update rider stats
        async function updateRiderStats() {
            try {
                const { data: orders, error } = await supabase
                    .from('orders')
                    .select('*')
                    .eq('rider_id', currentUser.id);
                
                if (error) throw error;
                
                const today = new Date().toDateString();
                const todayDeliveries = orders.filter(order => 
                    new Date(order.updated_at || order.created_at).toDateString() === today
                ).length;
                
                const activeDeliveries = orders.filter(order => 
                    order.status === 'assigned' || order.status === 'picked'
                ).length;
                
                const completedDeliveries = orders.filter(order => 
                    order.status === 'delivered'
                ).length;
                
                const todayEarnings = orders
                    .filter(order => 
                        order.status === 'delivered' && 
                        new Date(order.updated_at).toDateString() === today
                    )
                    .reduce((total, order) => total + (order.delivery_fee || 100), 0);
                
                elements.riderTodayDeliveries.textContent = todayDeliveries;
                elements.riderActiveDeliveries.textContent = activeDeliveries;
                elements.riderCompletedDeliveries.textContent = completedDeliveries;
                elements.riderTodayEarnings.textContent = `KSh ${todayEarnings.toLocaleString()}`;
            } catch (error) {
                console.error('Error updating rider stats:', error);
            }
        }
        
        // Load rider active deliveries
        async function loadRiderActiveDeliveries() {
            try {
                const { data: orders, error } = await supabase
                    .from('orders')
                    .select(`
                        *,
                        order_items (
                            *,
                            products (*)
                        ),
                        profiles!orders_customer_id_fkey (name)
                    `)
                    .eq('rider_id', currentUser.id)
                    .in('status', ['assigned', 'picked']);
                
                if (error) throw error;
                
                elements.riderActiveDeliveriesList.innerHTML = '';
                
                if (orders.length === 0) {
                    elements.riderActiveDeliveriesList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-motorcycle"></i>
                            <h3>No Active Deliveries</h3>
                            <p>You don't have any active deliveries at the moment.</p>
                        </div>
                    `;
                    return;
                }
                
                orders.forEach(order => {
                    const orderCard = document.createElement('div');
                    orderCard.className = 'order-card';
                    
                    let statusClass = '';
                    switch (order.status) {
                        case 'assigned': statusClass = 'status-assigned'; break;
                        case 'picked': statusClass = 'status-picked'; break;
                    }
                    
                    orderCard.innerHTML = `
                        <div class="order-header">
                            <div>
                                <h4>Order #${order.id.substring(0, 8)}</h4>
                                <p>Customer: ${order.profiles.name}</p>
                            </div>
                            <div class="order-status ${statusClass}">${order.status}</div>
                        </div>
                        <div class="order-items">
                            ${order.order_items.map(item => `
                                <div class="order-item">
                                    <div>${item.products.name} x ${item.quantity}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div style="margin-top: 15px;">
                            <p><strong>Delivery Address:</strong> ${order.delivery_address}</p>
                            <p><strong>Instructions:</strong> ${order.delivery_instructions || 'None'}</p>
                        </div>
                        <div class="order-total">
                            Delivery Fee: KSh ${(order.delivery_fee || 100).toLocaleString()}
                        </div>
                        <div style="margin-top: 15px; display: flex; gap: 10px;">
                            ${order.status === 'assigned' ? `
                                <button class="btn btn-primary btn-sm update-delivery-status" data-order-id="${order.id}" data-status="picked">
                                    <i class="fas fa-box"></i> Mark as Picked
                                </button>
                            ` : ''}
                            ${order.status === 'picked' ? `
                                <button class="btn btn-primary btn-sm update-delivery-status" data-order-id="${order.id}" data-status="delivered">
                                    <i class="fas fa-check"></i> Mark as Delivered
                                </button>
                            ` : ''}
                        </div>
                    `;
                    
                    elements.riderActiveDeliveriesList.appendChild(orderCard);
                });
                
                // Add event listeners to update delivery status buttons
                document.querySelectorAll('.update-delivery-status').forEach(button => {
                    button.addEventListener('click', function() {
                        const orderId = this.getAttribute('data-order-id');
                        const status = this.getAttribute('data-status');
                        updateDeliveryStatus(orderId, status);
                    });
                });
            } catch (error) {
                console.error('Error loading rider active deliveries:', error);
                showNotification('Error', 'Failed to load active deliveries', 'error');
            }
        }
        
        // Load rider history
        async function loadRiderHistory() {
            try {
                const { data: orders, error } = await supabase
                    .from('orders')
                    .select(`
                        *,
                        order_items (
                            *,
                            products (*)
                        ),
                        profiles!orders_customer_id_fkey (name)
                    `)
                    .eq('rider_id', currentUser.id)
                    .eq('status', 'delivered')
                    .order('updated_at', { ascending: false });
                
                if (error) throw error;
                
                elements.riderDeliveryHistory.innerHTML = '';
                
                if (orders.length === 0) {
                    elements.riderDeliveryHistory.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-history"></i>
                            <h3>No Delivery History</h3>
                            <p>Your completed deliveries will appear here.</p>
                        </div>
                    `;
                    return;
                }
                
                orders.forEach(order => {
                    const orderCard = document.createElement('div');
                    orderCard.className = 'order-card';
                    
                    orderCard.innerHTML = `
                        <div class="order-header">
                            <div>
                                <h4>Order #${order.id.substring(0, 8)}</h4>
                                <p>Customer: ${order.profiles.name}</p>
                                <p>Delivered on ${new Date(order.updated_at).toLocaleDateString()}</p>
                            </div>
                            <div class="order-status status-delivered">Delivered</div>
                        </div>
                        <div class="order-items">
                            ${order.order_items.map(item => `
                                <div class="order-item">
                                    <div>${item.products.name} x ${item.quantity}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div style="margin-top: 15px;">
                            <p><strong>Delivery Address:</strong> ${order.delivery_address}</p>
                        </div>
                        <div class="order-total">
                            Delivery Fee: KSh ${(order.delivery_fee || 100).toLocaleString()}
                        </div>
                    `;
                    
                    elements.riderDeliveryHistory.appendChild(orderCard);
                });
            } catch (error) {
                console.error('Error loading rider history:', error);
                showNotification('Error', 'Failed to load delivery history', 'error');
            }
        }
        
        // Load rider earnings
        async function loadRiderEarnings() {
            try {
                const { data: orders, error } = await supabase
                    .from('orders')
                    .select('*')
                    .eq('rider_id', currentUser.id)
                    .eq('status', 'delivered');
                
                if (error) throw error;
                
                const totalEarnings = orders.reduce((total, order) => total + (order.delivery_fee || 100), 0);
                
                // Calculate this week's earnings
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                const thisWeekEarnings = orders
                    .filter(order => new Date(order.updated_at) >= oneWeekAgo)
                    .reduce((total, order) => total + (order.delivery_fee || 100), 0);
                
                // Calculate this month's earnings
                const oneMonthAgo = new Date();
                oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
                const thisMonthEarnings = orders
                    .filter(order => new Date(order.updated_at) >= oneMonthAgo)
                    .reduce((total, order) => total + (order.delivery_fee || 100), 0);
                
                const avgDeliveryEarnings = orders.length > 0 ? 
                    Math.round(totalEarnings / orders.length) : 0;
                
                elements.riderTotalEarnings.textContent = `KSh ${totalEarnings.toLocaleString()}`;
                elements.riderThisWeekEarnings.textContent = `KSh ${thisWeekEarnings.toLocaleString()}`;
                elements.riderThisMonthEarnings.textContent = `KSh ${thisMonthEarnings.toLocaleString()}`;
                elements.riderAvgDeliveryEarnings.textContent = `KSh ${avgDeliveryEarnings.toLocaleString()}`;
            } catch (error) {
                console.error('Error loading rider earnings:', error);
                showNotification('Error', 'Failed to load earnings', 'error');
            }
        }
        
        // Load rider profile
        async function loadRiderProfile() {
            try {
                const { data: profile, error } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();
                
                if (error) throw error;
                
                document.getElementById('riderProfileName').value = profile.name || '';
                document.getElementById('riderProfileEmail').value = currentUser.email;
                document.getElementById('riderProfilePhone').value = profile.phone || '';
                document.getElementById('riderProfileVehicle').value = profile.vehicle || 'motorcycle';
                document.getElementById('riderProfileLicense').value = profile.license || '';
            } catch (error) {
                console.error('Error loading rider profile:', error);
            }
        }
        
        // Save rider profile
        async function saveRiderProfile() {
            const name = document.getElementById('riderProfileName').value;
            const phone = document.getElementById('riderProfilePhone').value;
            const vehicle = document.getElementById('riderProfileVehicle').value;
            const license = document.getElementById('riderProfileLicense').value;
            
            try {
                const { data, error } = await supabase
                    .from('profiles')
                    .update({
                        name,
                        phone,
                        vehicle,
                        license
                    })
                    .eq('id', currentUser.id)
                    .select()
                    .single();
                
                if (error) throw error;
                
                elements.riderName.textContent = name;
                elements.riderAvatar.textContent = name.charAt(0).toUpperCase();
                
                showNotification('Success', 'Profile updated successfully!', 'success');
            } catch (error) {
                showNotification('Error', 'Failed to update profile: ' + error.message, 'error');
            }
        }
        
        // Toggle rider availability
        function toggleRiderAvailability() {
            const isAvailable = elements.riderAvailabilityToggle.checked;
            elements.riderStatusText.textContent = isAvailable ? 'Online' : 'Offline';
            
            if (isAvailable) {
                showNotification('Success', 'You are now available for deliveries!', 'success');
            } else {
                showNotification('Info', 'You are now offline.', 'info');
            }
        }
        
        // Update delivery status
        async function updateDeliveryStatus(orderId, status) {
            try {
                const { data, error } = await supabase
                    .from('orders')
                    .update({
                        status,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', orderId)
                    .select()
                    .single();
                
                if (error) throw error;
                
                showNotification('Success', `Order marked as ${status}!`, 'success');
                
                // Reload the active deliveries
                loadRiderActiveDeliveries();
                updateRiderStats();
            } catch (error) {
                showNotification('Error', 'Failed to update delivery status: ' + error.message, 'error');
            }
        }
        
        // Update order status
        async function updateOrderStatus(orderId) {
            try {
                const { data: order, error } = await supabase
                    .from('orders')
                    .select('*')
                    .eq('id', orderId)
                    .single();
                
                if (error) throw error;
                
                // Get current status index
                const statuses = ['pending', 'accepted', 'ready', 'assigned', 'picked', 'delivered'];
                const currentIndex = statuses.indexOf(order.status);
                
                if (currentIndex < statuses.length - 1) {
                    const { data, error } = await supabase
                        .from('orders')
                        .update({
                            status: statuses[currentIndex + 1],
                            updated_at: new Date().toISOString()
                        })
                        .eq('id', orderId)
                        .select()
                        .single();
                    
                    if (error) throw error;
                    
                    showNotification('Success', `Order status updated to ${statuses[currentIndex + 1]}!`, 'success');
                    
                    // Reload seller orders
                    loadSellerOrders();
                    updateSellerStats();
                }
            } catch (error) {
                showNotification('Error', 'Failed to update order status: ' + error.message, 'error');
            }
        }
        
        // Add to cart
        async function addToCart(productId) {
            try {
                // Check if product is already in cart
                const { data: existingItem, error: checkError } = await supabase
                    .from('cart_items')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .eq('product_id', productId)
                    .single();
                
                if (checkError && checkError.code !== 'PGRST116') { // PGRST116 is "not found"
                    throw checkError;
                }
                
                if (existingItem) {
                    // Update quantity
                    const { error } = await supabase
                        .from('cart_items')
                        .update({ quantity: existingItem.quantity + 1 })
                        .eq('id', existingItem.id);
                    
                    if (error) throw error;
                } else {
                    // Insert new item
                    const { error } = await supabase
                        .from('cart_items')
                        .insert([
                            {
                                user_id: currentUser.id,
                                product_id: productId,
                                quantity: 1
                            }
                        ]);
                    
                    if (error) throw error;
                }
                
                // Get product name for notification
                const { data: product, error: productError } = await supabase
                    .from('products')
                    .select('name')
                    .eq('id', productId)
                    .single();
                
                if (productError) throw productError;
                
                updateCustomerStats();
                showNotification('Success', `${product.name} added to cart!`, 'success');
            } catch (error) {
                showNotification('Error', 'Failed to add to cart: ' + error.message, 'error');
            }
        }
        
        // Update cart quantity
        async function updateCartQuantity(cartItemId, change) {
            try {
                // Get current cart item
                const { data: cartItem, error } = await supabase
                    .from('cart_items')
                    .select('*')
                    .eq('id', cartItemId)
                    .single();
                
                if (error) throw error;
                
                const newQuantity = cartItem.quantity + change;
                
                if (newQuantity <= 0) {
                    // Remove item from cart
                    await supabase
                        .from('cart_items')
                        .delete()
                        .eq('id', cartItemId);
                } else {
                    // Update quantity
                    await supabase
                        .from('cart_items')
                        .update({ quantity: newQuantity })
                        .eq('id', cartItemId);
                }
                
                updateCustomerStats();
                
                // Reload customer cart if we're on that page
                if (document.getElementById('cartSection').classList.contains('active')) {
                    loadCustomerCart();
                }
            } catch (error) {
                showNotification('Error', 'Failed to update cart: ' + error.message, 'error');
            }
        }
        
        // Remove from cart
        async function removeFromCart(cartItemId) {
            try {
                await supabase
                    .from('cart_items')
                    .delete()
                    .eq('id', cartItemId);
                
                updateCustomerStats();
                
                // Reload customer cart if we're on that page
                if (document.getElementById('cartSection').classList.contains('active')) {
                    loadCustomerCart();
                }
                
                showNotification('Success', 'Item removed from cart!', 'success');
            } catch (error) {
                showNotification('Error', 'Failed to remove from cart: ' + error.message, 'error');
            }
        }
        
        // Show checkout modal
        async function showCheckoutModal() {
            try {
                const { data: cartItems, error } = await supabase
                    .from('cart_items')
                    .select(`
                        *,
                        products (*)
                    `)
                    .eq('user_id', currentUser.id);
                
                if (error) throw error;
                
                if (cartItems.length === 0) {
                    showNotification('Error', 'Your cart is empty!', 'error');
                    return;
                }
                
                elements.checkoutModal.style.display = 'flex';
                
                // Calculate total
                let subtotal = 0;
                cartItems.forEach(item => {
                    subtotal += item.products.price * item.quantity;
                });
                
                const deliveryFee = 100;
                const total = subtotal + deliveryFee;
                
                // Update checkout summary
                elements.checkoutSummary.innerHTML = `
                    <h4 style="margin-bottom: 20px;">Order Summary</h4>
                    ${cartItems.map(item => {
                        return `
                            <div class="order-item">
                                <div>${item.products.name} x ${item.quantity}</div>
                                <div>KSh ${(item.products.price * item.quantity).toLocaleString()}</div>
                            </div>
                        `;
                    }).join('')}
                    <div class="order-item">
                        <div>Delivery Fee</div>
                        <div>KSh ${deliveryFee.toLocaleString()}</div>
                    </div>
                    <div class="order-total">
                        Total: KSh ${total.toLocaleString()}
                    </div>
                `;
                
                // Reset MPESA steps
                document.querySelectorAll('.mpesa-step').forEach((step, index) => {
                    step.classList.toggle('active', index === 0);
                });
                
                document.querySelectorAll('.mpesa-form').forEach((form, index) => {
                    form.classList.toggle('active', index === 0);
                });
                
                elements.paymentSuccess.style.display = 'none';
            } catch (error) {
                showNotification('Error', 'Failed to load checkout: ' + error.message, 'error');
            }
        }
        
        // Proceed to payment
        function proceedToPayment() {
            const deliveryAddress = document.getElementById('deliveryAddress').value;
            
            if (!deliveryAddress) {
                showNotification('Error', 'Please enter a delivery address!', 'error');
                return;
            }
            
            // Update MPESA steps
            document.querySelectorAll('.mpesa-step').forEach((step, index) => {
                step.classList.toggle('active', index === 1);
            });
            
            document.querySelectorAll('.mpesa-form').forEach((form, index) => {
                form.classList.toggle('active', index === 1);
            });
        }
        
        // Back to details
        function backToDetails() {
            // Update MPESA steps
            document.querySelectorAll('.mpesa-step').forEach((step, index) => {
                step.classList.toggle('active', index === 0);
            });
            
            document.querySelectorAll('.mpesa-form').forEach((form, index) => {
                form.classList.toggle('active', index === 0);
            });
        }
        
        // Back to cart
        function backToCart() {
            elements.checkoutModal.style.display = 'none';
        }
        
        // Handle MPESA payment
        async function handleMpesaPayment(e) {
            e.preventDefault();
            
            const phone = document.getElementById('mpesaPhone').value;
            const countryCode = document.getElementById('mpesaCountryCode').value;
            const fullPhone = countryCode + phone.replace(/\D/g, '');
            
            if (!phone) {
                showNotification('Error', 'Please enter your phone number!', 'error');
                return;
            }
            
            showLoading();
            
            try {
                // Get cart items
                const { data: cartItems, error: cartError } = await supabase
                    .from('cart_items')
                    .select(`
                        *,
                        products (*)
                    `)
                    .eq('user_id', currentUser.id);
                
                if (cartError) throw cartError;
                
                // Calculate total
                let subtotal = 0;
                cartItems.forEach(item => {
                    subtotal += item.products.price * item.quantity;
                });
                
                const deliveryFee = 100;
                const total = subtotal + deliveryFee;
                
                // Create order
                const { data: order, error: orderError } = await supabase
                    .from('orders')
                    .insert([
                        {
                            customer_id: currentUser.id,
                            total,
                            delivery_fee: deliveryFee,
                            status: 'pending',
                            delivery_address: document.getElementById('deliveryAddress').value,
                            delivery_instructions: document.getElementById('deliveryInstructions').value,
                            payment_method: 'mpesa',
                            payment_status: 'completed'
                        }
                    ])
                    .select()
                    .single();
                
                if (orderError) throw orderError;
                
                // Create order items
                const orderItems = cartItems.map(item => ({
                    order_id: order.id,
                    product_id: item.product_id,
                    quantity: item.quantity,
                    price: item.products.price
                }));
                
                const { error: orderItemsError } = await supabase
                    .from('order_items')
                    .insert(orderItems);
                
                if (orderItemsError) throw orderItemsError;
                
                // Clear cart
                const { error: clearCartError } = await supabase
                    .from('cart_items')
                    .delete()
                    .eq('user_id', currentUser.id);
                
                if (clearCartError) throw clearCartError;
                
                hideLoading();
                
                // Show success screen
                document.querySelectorAll('.mpesa-step').forEach((step, index) => {
                    step.classList.toggle('active', index === 2);
                });
                
                document.querySelectorAll('.mpesa-form').forEach(form => {
                    form.classList.remove('active');
                });
                
                elements.paymentSuccess.style.display = 'block';
                document.getElementById('successOrderId').textContent = `#${order.id.substring(0, 8)}`;
                
                updateCustomerStats();
                showNotification('Success', 'Payment completed successfully!', 'success');
            } catch (error) {
                hideLoading();
                showNotification('Error', 'Payment failed. Please try again.', 'error');
            }
        }
        
        // View order after payment
        function viewOrderAfterPayment() {
            elements.checkoutModal.style.display = 'none';
            switchDashboardSection('orders');
        }
        
        // Show loading spinner
        function showLoading() {
            elements.loadingSpinner.style.display = 'flex';
        }
        
        // Hide loading spinner
        function hideLoading() {
            elements.loadingSpinner.style.display = 'none';
        }
        
        // Show notification
        function showNotification(title, message, type) {
            elements.notificationTitle.textContent = title;
            elements.notificationMessage.textContent = message;
            
            // Set icon based on type
            let icon = 'fa-info-circle';
            if (type === 'success') icon = 'fa-check-circle';
            if (type === 'error') icon = 'fa-exclamation-circle';
            if (type === 'warning') icon = 'fa-exclamation-triangle';
            
            elements.notification.querySelector('i').className = `fas ${icon}`;
            
            // Set color based on type
            elements.notification.classList.remove('notification-success', 'notification-error');
            if (type === 'success') elements.notification.classList.add('notification-success');
            if (type === 'error') elements.notification.classList.add('notification-error');
            
            // Show notification
            elements.notification.classList.add('show');
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                elements.notification.classList.remove('show');
            }, 5000);
        }
        
        // Add CSS for dashboard sections
        const style = document.createElement('style');
        style.textContent = `
            .dashboard-section {
                display: none;
                animation: fadeIn 0.5s ease-in-out;
            }
            .dashboard-section.active {
                display: block;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>

